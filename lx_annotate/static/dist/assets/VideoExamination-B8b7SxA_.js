import{d as _e,u as ot,s as ee,e as V,f as it,g as rt,h as y,w as j,i as dt,c as r,j as v,a as t,k as h,t as i,l as ye,v as he,F as q,m as K,n as pe,p as g,b as Ve,q as Se,x as ut,y as ct,z as W,A as G,o as l,_ as mt}from"./main-DethiONo.js";import{u as vt,f as p,g as O}from"./videoStore-ClqdABXQ.js";import"./annotationStore-DEHKjdKh.js";import{u as gt}from"./mediaTypeStore-D6KIykKn.js";import{R as ft}from"./RequirementGenerator-CeDfg9J_.js";import{T as bt}from"./Timeline-CMheelus.js";import"./patientStore-BazAFCNw.js";import"./PatientAdder-BlwvntXl.js";const yt={class:"container-fluid py-4"},ht={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},pt={key:1,class:"alert alert-success alert-dismissible fade show",role:"alert"},St={class:"row"},_t={class:"col-lg-12"},Vt={class:"card"},kt={class:"card-body"},wt={class:"mb-3"},xt=["disabled"],Tt={value:null},$t=["value"],Lt={key:0,class:"text-muted"},zt={key:1,class:"mt-2"},Ct={class:"d-flex flex-wrap gap-2 align-items-center"},Et={class:"badge bg-success"},Mt={class:"badge bg-primary"},At={class:"badge bg-secondary"},Dt={key:0,class:"text-center text-muted py-5"},Ut={key:0,class:"alert alert-info mt-2"},Pt={class:"d-flex align-items-center justify-content-center"},Nt={class:"text-start"},Rt={class:"text-muted"},Ft={key:1,class:"text-center text-muted py-5"},Bt={class:"mt-2"},It={key:2,class:"video-container"},jt=["src"],qt={key:0,class:"mt-3 p-3 rounded border video-status-card"},Kt={class:"row align-items-center"},Wt={class:"col-md-8"},Gt={class:"mb-1"},Ot={class:"status-badge-container mb-2"},Xt={key:0,class:"badge bg-info"},Ht={key:1,class:"badge bg-warning"},Zt={class:"col-md-4 text-md-end"},Jt={class:"text-muted d-block"},Qt={class:"text-muted d-block"},Yt={class:"text-muted d-block"},en={key:3,class:""},tn=["disabled"],nn={key:4,class:"timeline-wrapper mt-3"},an={key:0,class:"mt-3 d-flex gap-2"},sn=["title"],ln={key:1,class:"debug-info mt-2"},on={class:"text-muted"},rn={key:2,class:"timeline-controls mt-4"},dn={class:"d-flex align-items-center gap-3"},un={class:"d-flex align-items-center"},cn=["value"],mn={class:"d-flex align-items-center gap-2"},vn=["disabled"],gn={class:"ms-3 text-muted"},fn={key:0,class:"alert alert-info mt-2 mb-0"},bn={key:0},yn={key:1},hn={key:0,class:"mt-3"},pn={key:0,class:"alert alert-success d-flex align-items-center validation-status-alert"},Sn={class:"text-muted"},_n={key:2,class:"text-muted text-center mt-2 mb-0",style:{"font-size":"0.9rem"}},Vn={class:"col-lg-12"},kn={class:"card"},wn={class:"card-header pb-0"},xn={key:0,class:"text-muted"},Tn={key:1,class:"mt-2"},$n={class:"alert alert-info alert-sm mb-0"},Ln={class:"card-body p-0",style:{"max-height":"80vh","overflow-y":"auto"}},zn={key:1,class:"text-center text-muted py-5 px-3"},Cn={key:0,class:"card mt-3"},En={class:"card-body","data-cy":"saved-examinations"},Mn={class:"list-group list-group-flush"},An={class:"text-muted"},Dn=["onClick"],Un=["onClick"],Pn=_e({__name:"VideoExaminationAnnotation",setup(ke){const X=ot(),te=ct(),we=Number(X.query.video??"")||null,c=vt(),xe=gt(),{videoList:ne,videoStreamUrl:ae,timelineSegments:Fn}=ee(c),H=V(()=>ne.value.videos);it();const{allSegments:B}=ee(c),se=rt(),{overview:z}=ee(se),le=V(()=>[...c.labels||[]]);function oe(n){const e=z.value.find(u=>u.id===n&&u.mediaType==="video");return(e==null?void 0:e.anonymizationStatus)==="done_processing_anonymization"}const a=y(we),$=y(0),b=y(0),Te=y(50),P=y(!1),A=y([]),C=y([]),N=y(null),_=y(""),E=y(!1),$e=y(0),ie=y(null),R=y(null),F=y(null),D=y(""),I=y(""),f=y(null),Z=y(null),Le=V(()=>B.value.some(n=>n.isDirty));async function re(){if(a.value==null){c.clearVideo(),R.value=null,F.value=null;return}if(!oe(a.value)){L(`Video ${a.value} kann nicht annotiert werden, da es noch nicht anonymisiert wurde.`),a.value=null;return}J(),Q();try{await c.loadVideo(a.value),await Me(a.value),await T(Ae()),await T(De()),await T(c.fetchAllSegments(a.value)),console.log("Video fully loaded:",a.value)}catch(n){console.error("loadSelectedVideo failed",n),await T(Promise.reject(n))}}function ze(){re(),te.replace({query:{video:a.value}})}j(a,re),j(()=>X.query.video,n=>{const e=Number(n??"")||null;e!==a.value&&(a.value=e)},{immediate:!0});const k=V(()=>ne.value.videos.filter(n=>oe(n.id))),Ce=V(()=>a.value!==null&&w.value!==void 0),w=V(()=>a.value?`${window.location.origin}/api/media/videos/${a.value}/?type=processed`:void 0),U=V(()=>k.value&&k.value.length>0),de=V(()=>H.value.length===0?"Keine Videos verfÃ¼gbar. Bitte laden Sie zuerst Videos hoch.":k.value.length===0?"Keine anonymisierten Videos verfÃ¼gbar. Videos mÃ¼ssen erst anonymisiert werden.":""),x=V(()=>a.value?B.value.filter(n=>n.videoID===a.value):[]),Ee=V(()=>c.segmentsByLabel),ue=V(()=>{var n;return a.value&&(((n=R.value)==null?void 0:n.video_url)||w.value)&&_.value&&!E.value&&b.value>0});dt(async()=>{console.log("ðŸš€ [VideoExamination] Component mounted - loading data in priority order...");try{await c.fetchLabels(),console.log(`âœ… [VideoExamination] Labels loaded: ${c.labels.length}`),await se.fetchOverview(),console.log(`âœ… [VideoExamination] Anonymization status loaded: ${z.value.length} items`),await c.fetchAllVideos(),console.log(`âœ… [VideoExamination] Videos loaded: ${c.videoList.videos.length}`),console.log(`âœ… [VideoExamination] Annotatable videos: ${k.value.length}`)}catch(n){console.error("âŒ [VideoExamination] Error during initial load:",n),L("Fehler beim Laden der Daten. Bitte Seite neu laden.")}});async function T(n){var e,u,m,d;try{return await n}catch(o){const S=((u=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:u.detail)||((d=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:d.error)||(o==null?void 0:o.message)||String(o);D.value=S;return}}j(ae,n=>{console.log("Video stream URL updated:",n)}),j(a,n=>{console.log("Selected video ID changed, setting store to:",n),typeof n=="number"?(c.setCurrentVideo(n),c.fetchVideoSegments(n)):D.value="Invalid video ID"});const J=()=>{D.value=""},Q=()=>{I.value=""},M=n=>{I.value=n,setTimeout(()=>{Q()},5e3)},L=n=>{D.value=n,setTimeout(()=>{J()},1e4)},Me=async n=>{if(n)try{console.log("Loading video detail for ID:",n);const e=await W.get(G(`media/videos/${n}/`));console.log("Video detail response:",e.data),R.value={video_url:e.data.video_url},F.value={duration:Number(e.data.duration??0),fps:Number(e.data.fps??25)};const u=k.value.find(m=>m.id===n);u&&(xe.setCurrentItem(u),console.log("MediaStore updated with video:",n)),F.value.duration>0&&(b.value=F.value.duration),console.log("Video detail loaded:",R.value),console.log("Video meta loaded:",F.value),console.log("Stream source will be:",w.value)}catch(e){console.error("Error loading video detail:",e),await T(Promise.reject(e))}},Ae=async()=>{var n,e,u,m,d;if(a.value!==null)try{const o=await W.get(G(`video/${a.value}/examinations/`));C.value=o.data,A.value=o.data.map(S=>({id:`exam-${S.id}`,timestamp:S.timestamp,examination_data:S.data}))}catch(o){console.error("Error loading saved examinations:",o);const S=((e=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:e.error)||((m=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:m.detail)||(o==null?void 0:o.message)||o.toString();S.includes("darf nicht annotiert werden")||S.includes("anonymisierung")||S.includes("anonymization")?L(`Video ${a.value} darf nicht annotiert werden, solange die Anonymisierung nicht abgeschlossen ist.`):((d=o==null?void 0:o.response)==null?void 0:d.status)!==404&&await T(Promise.reject(o)),C.value=[],A.value=[]}},De=async()=>{f.value&&await new Promise(n=>{const e=f.value;e.readyState>=1?(b.value=e.duration,n()):e.addEventListener("loadedmetadata",()=>{b.value=e.duration,n()},{once:!0})})},ce=async()=>{if(a.value!==null)try{await c.fetchAllSegments(a.value),console.log("Video segments loaded for video:",a.value),console.log("Timeline segments count:",B.value.length)}catch(n){console.error("Error loading video segments:",n)}},Ue=()=>{var n;f.value&&(b.value=f.value.duration,f.value.addEventListener("play",()=>{P.value=!0}),f.value.addEventListener("pause",()=>{P.value=!1}),f.value.addEventListener("ended",()=>{P.value=!1}),console.log("ðŸŽ¥ Video loaded - Frontend"),console.log(`- Video source URL: ${w.value}`),console.log(`- Legacy stream URL: ${ae.value}`),console.log(`- Video detail URL: ${(n=R.value)==null?void 0:n.video_url}`),console.log(`- Video readyState: ${f.value.readyState}`),console.log(`- Video networkState: ${f.value.networkState}`),f.value.videoWidth&&f.value.videoHeight&&console.log(`- Video dimensions: ${f.value.videoWidth}x${f.value.videoHeight}`),b.value<10?console.warn(`âš ï¸ WARNING: Video duration seems very short (${b.value}s)`):M(`Video geladen: ${Math.round(b.value)}s Dauer`))},Pe=()=>{f.value&&($.value=f.value.currentTime)},Ne=n=>{if(!Z.value||b.value===0)return;const e=Z.value.getBoundingClientRect(),d=(n.clientX-e.left)/e.width*b.value;Y(d)},Re=(...n)=>{const[e]=n;Y(e)},Fe=(...n)=>{f.value&&(f.value.paused?f.value.play().catch(e=>{console.error("Error playing video:",e),L("Fehler beim Abspielen des Videos")}):f.value.pause())},Be=(...n)=>{const[e]=n;ie.value=e,console.log("Segment selected:",e)},Ie=(...n)=>{const[e,u,m,d,o]=n;if(!Number.isFinite(e)){console.warn("[VideoExamination] Invalid segment ID for resize:",e);return}e<0?c.patchDraftSegment(e,{startTime:u,endTime:m}):c.patchSegmentLocally(e,{startTime:u,endTime:m})},je=(...n)=>{const[e,u,m,d]=n;if(!Number.isFinite(e)){console.warn("[VideoExamination] Invalid segment ID for move:",e);return}e<0?c.patchDraftSegment(e,{startTime:u,endTime:m}):c.patchSegmentLocally(e,{startTime:u,endTime:m})},qe=(...n)=>{const[e]=n;_.value&&a.value?(console.log(`Creating segment from time selection: ${p(e.start)} - ${p(e.end)} with label: ${_.value}`),me({label:_.value,start:e.start,end:e.end})):(console.warn("Cannot create segment: no label selected or no video selected"),L("Bitte wÃ¤hlen Sie ein Label aus, bevor Sie ein Segment erstellen."))},me=(...n)=>{const[e]=n;return new Promise(async(u,m)=>{var d;try{a.value&&(await((d=c.createSegment)==null?void 0:d.call(c,a.value,e.label,e.start,e.end)),M(`Segment erstellt: ${O(e.label)}`)),u()}catch(o){await T(Promise.reject(o)),m(o)}})},Ke=(...n)=>{const[e]=n;return new Promise(async(u,m)=>{if(!e.id||typeof e.id!="number"){console.warn("Cannot delete draft or temporary segment:",e.id),u();return}try{c.removeSegment(e.id),await c.deleteSegment(e.id),M(`Segment gelÃ¶scht: ${O(e.label)}`),u()}catch(d){console.error("Segment konnte nicht gelÃ¶scht werden:",d),await T(Promise.reject(d)),m(d)}})},Y=n=>{f.value&&n>=0&&n<=b.value&&(f.value.currentTime=n,$.value=n)},We=()=>{console.log("Label selected:",_.value)},Ge=()=>{ue.value&&(E.value=!0,$e.value=$.value,c.startDraft(_.value,$.value),console.log(`Draft gestartet: ${_.value} bei ${p($.value)}`))},Oe=async()=>{if(!(!E.value||!a.value))try{c.updateDraftEnd($.value),await c.commitDraft(),E.value=!1,_.value="",await ce(),console.log("Label-Markierung abgeschlossen")}catch(n){console.error("Error finishing label marking:",n)}},Xe=()=>{c.cancelDraft(),E.value=!1,_.value="",console.log("Label-Markierung abgebrochen")},He=n=>{Y(n.timestamp),N.value=A.value.find(e=>e.id===`exam-${n.id}`)||null},Ze=async n=>{var e;try{await W.delete(G(`examinations/${n}/`)),C.value=C.value.filter(u=>u.id!==n),A.value=A.value.filter(u=>u.id!==`exam-${n}`),((e=N.value)==null?void 0:e.id)===`exam-${n}`&&(N.value=null),M(`Untersuchung ${n} gelÃ¶scht`),console.log("Examination deleted:",n)}catch(u){console.error("Error deleting examination:",u),await T(Promise.reject(u))}},Je=async()=>{var u,m;if(!a.value){L("Kein Video ausgewÃ¤hlt");return}const n=x.value.length;if(n===0){L("Keine Segmente zum Validieren vorhanden");return}if(!confirm(`MÃ¶chten Sie alle ${n} Segmente von Video ${a.value} als validiert markieren? AuÃŸerhalb-Segmente werden danach gelÃ¶scht.`))return;const e=x.value.filter(d=>typeof d.id=="number").map(d=>({id:d.id,start_time:d.startTime,end_time:d.endTime}));console.log("ðŸ”„ Sending segments to backend:",e);try{console.log(`ðŸ” Validating all segments for video ${a.value}...`);const d=await W.post(G(`media/videos/${a.value}/segments/validate-bulk/`),{segmentIds:e.map(o=>o.id),segments:e,isValidated:!0,notes:`VollstÃ¤ndige Video-Review abgeschlossen am ${new Date().toLocaleString("de-DE")}`,informationSourceName:"manual_annotation"});console.log("âœ… Validation response:",d.data),M(`Erfolgreich! ${d.data.updatedCount} von ${d.data.totalSegments??d.data.requestedCount} Segmenten validiert.`),await ce()}catch(d){console.error("âŒ Error validating video segments:",d);const o=((m=(u=d==null?void 0:d.response)==null?void 0:u.data)==null?void 0:m.error)||(d==null?void 0:d.message)||"Unbekannter Fehler";L(`Validierung fehlgeschlagen: ${o}`)}},Qe=async()=>{try{await c.persistDirtySegments(),M("Segment-Ã„nderungen gespeichert")}catch(n){console.error("Fehler beim Speichern der Segment-Ã„nderungen:",n),await T(Promise.reject(n))}},Ye=()=>{a.value&&(c.fetchVideoSegments(a.value),M("Lokale Ã„nderungen verworfen"))},et=n=>{console.error("Video loading error:",n);const e=n.target;console.error("Video error details:",{error:e.error,networkState:e.networkState,readyState:e.readyState,currentSrc:e.currentSrc}),L("Fehler beim Laden des Videos. Bitte versuchen Sie es erneut.")},tt=()=>{console.log("Video loading started for:",w.value)},nt=()=>{console.log("Video can play, loaded successfully"),M("Video erfolgreich geladen")},ve=n=>{const e=z.value.find(m=>m.id===n&&m.mediaType==="video");return e?{not_started:"â³ Wartend",processing_anonymization:"ðŸ”„ In Verarbeitung",extracting_frames:"ðŸŽ¬ Frames",done_processing_anonymization:"âœ… Anonymisiert - Validierung steht aus",validated:"ðŸ›¡ï¸ Validiert & Anonymisiert",failed:"âŒ Fehler"}[e.anonymizationStatus]||e.anonymizationStatus:""},ge=n=>z.value.filter(e=>e.mediaType==="video"&&e.anonymizationStatus===n).length,at=n=>({not_started:"bg-secondary",processing_anonymization:"bg-warning",extracting_frames:"bg-info",predicting_segments:"bg-info",done_processing_anonymization:"bg-success",validated:"bg-primary",failed:"bg-danger"})[n]||"bg-secondary",st=n=>({not_started:"Nicht gestartet",processing_anonymization:"Anonymisierung lÃ¤uft",extracting_frames:"Frames extrahieren",predicting_segments:"Segmente vorhersagen",done_processing_anonymization:"Fertig",validated:"Validiert",failed:"Fehlgeschlagen"})[n]||n;return(n,e)=>{var u,m,d,o,S,fe,be;return l(),r("div",yt,[D.value?(l(),r("div",ht,[e[3]||(e[3]=t("i",{class:"material-icons me-2"},"error",-1)),e[4]||(e[4]=t("strong",null,"Fehler:",-1)),h(" "+i(D.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:J,"aria-label":"Close"})])):v("",!0),I.value?(l(),r("div",pt,[e[5]||(e[5]=t("i",{class:"material-icons me-2"},"check_circle",-1)),e[6]||(e[6]=t("strong",null,"Erfolg:",-1)),h(" "+i(I.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:Q,"aria-label":"Close"})])):v("",!0),e[39]||(e[39]=t("div",{class:"row"},[t("div",{class:"col-12"},[t("h1",null,"Video-Untersuchung Annotation"),t("p",null,"Annotieren Sie Untersuchungen wÃ¤hrend der Videobetrachtung")])],-1)),t("div",St,[t("div",_t,[t("div",Vt,[e[31]||(e[31]=t("div",{class:"card-header pb-0"},[t("h5",{class:"mb-0"},"Video Player")],-1)),t("div",kt,[t("div",wt,[e[11]||(e[11]=t("label",{class:"form-label"},"Video auswÃ¤hlen:",-1)),ye(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),onChange:ze,class:"form-select",disabled:!U.value},[t("option",Tt,i(U.value?"Bitte Video auswÃ¤hlen...":"Keine Videos verfÃ¼gbar"),1),(l(!0),r(q,null,K(k.value,s=>(l(),r("option",{key:s.id,value:s.id}," ðŸ“¹ "+i(s.original_file_name||"Video Nr. "+s.id)+" "+i(ve(s.id))+" | Center: "+i(s.centerName||"Unbekannt")+" | Processor: "+i(s.processorName||"Unbekannt"),9,$t))),128))],40,xt),[[he,a.value,void 0,{number:!0}]]),U.value?v("",!0):(l(),r("small",Lt,i(de.value),1)),H.value.length>0?(l(),r("div",zt,[t("div",Ct,[e[10]||(e[10]=t("small",{class:"text-muted"},"Status-Ãœbersicht:",-1)),t("span",Et,[e[7]||(e[7]=t("i",{class:"fas fa-check me-1"},null,-1)),h(" "+i(ge("done_processing_anonymization"))+" Anonymisiert ",1)]),t("span",Mt,[e[8]||(e[8]=t("i",{class:"fas fa-check-double me-1"},null,-1)),h(" "+i(ge("validated"))+" Validiert ",1)]),t("span",At,[e[9]||(e[9]=t("i",{class:"fas fa-clock me-1"},null,-1)),h(" "+i(H.value.length-k.value.length)+" Ausstehend ",1)])])])):v("",!0)]),!w.value&&U.value?(l(),r("div",Dt,[e[14]||(e[14]=t("i",{class:"material-icons",style:{"font-size":"48px"}},"movie",-1)),e[15]||(e[15]=t("p",{class:"mt-2"},"Video auswÃ¤hlen, um mit der Betrachtung zu beginnen",-1)),a.value?(l(),r("div",Ut,[t("div",Pt,[e[13]||(e[13]=t("i",{class:"fas fa-info-circle me-2"},null,-1)),t("div",Nt,[t("strong",null,"Video "+i(a.value)+":",1),h(" "+i(ve(a.value)),1),e[12]||(e[12]=t("br",null,null,-1)),t("small",Rt," Stream-URL: "+i(w.value||"Wird geladen..."),1)])])])):v("",!0)])):v("",!0),U.value?v("",!0):(l(),r("div",Ft,[e[16]||(e[16]=t("i",{class:"material-icons",style:{"font-size":"48px"}},"video_library",-1)),t("p",Bt,i(de.value),1),e[17]||(e[17]=t("small",null,"Videos kÃ¶nnen Ã¼ber den Ordner Raw Videos hochgeladen werden. Sie mÃ¼ssen erst anonymisiert werden, bevor sie hier angezeigt werden.",-1))])),w.value?(l(),r("div",It,[t("video",{ref_key:"videoRef",ref:f,"data-cy":"video-player",src:w.value,onTimeupdate:Pe,onLoadedmetadata:Ue,onError:et,onLoadstart:tt,onCanplay:nt,controls:"",class:"w-100",style:{"max-height":"400px"}}," Ihr Browser unterstÃ¼tzt das Video-Element nicht. ",40,jt),a.value?(l(),r("div",qt,[t("div",Kt,[t("div",Wt,[t("h6",Gt,[e[18]||(e[18]=t("i",{class:"fas fa-video me-2 text-primary"},null,-1)),h(" "+i(((u=k.value.find(s=>s.id===a.value))==null?void 0:u.original_file_name)||`Video ${a.value}`),1)]),t("div",Ot,[t("span",{class:pe([at(((m=g(z).find(s=>s.id===a.value&&s.mediaType==="video"))==null?void 0:m.anonymizationStatus)||"not_started"),"badge"])},[e[19]||(e[19]=t("i",{class:"fas fa-shield-alt me-1"},null,-1)),h(" "+i(st(((d=g(z).find(s=>s.id===a.value&&s.mediaType==="video"))==null?void 0:d.anonymizationStatus)||"not_started")),1)],2),x.value.length>0?(l(),r("span",Xt,[e[20]||(e[20]=t("i",{class:"fas fa-cut me-1"},null,-1)),h(" "+i(x.value.length)+" Segmente ",1)])):v("",!0),C.value.length>0?(l(),r("span",Ht,[e[21]||(e[21]=t("i",{class:"fas fa-stethoscope me-1"},null,-1)),h(" "+i(C.value.length)+" Untersuchungen ",1)])):v("",!0)])]),t("div",Zt,[t("small",Jt,"Center: "+i(((o=k.value.find(s=>s.id===a.value))==null?void 0:o.centerName)||"Unbekannt"),1),t("small",Qt,"Processor: "+i(((S=k.value.find(s=>s.id===a.value))==null?void 0:S.processorName)||"Unbekannt"),1),t("small",Yt,"Dauer: "+i(g(p)(b.value)),1)])])])):v("",!0)])):v("",!0),w.value?v("",!0):(l(),r("div",en,[t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=s=>g(c).deleteVideo(a.value)),disabled:!U.value}," Video lÃ¶schen? ",8,tn)])),b.value>0?(l(),r("div",nn,[Ve(bt,{video:{duration:b.value},segments:x.value,labels:le.value,currentTime:$.value,isPlaying:P.value,activeSegmentId:ie.value,showWaveform:!1,selectionMode:!0,fps:Te.value,onSeek:Re,onPlayPause:Fe,onSegmentSelect:Be,onSegmentResize:Ie,onSegmentMove:je,onSegmentCreate:me,onSegmentDelete:Ke,onTimeSelection:qe},null,8,["video","segments","labels","currentTime","isPlaying","activeSegmentId","fps"]),a.value&&x.value.length>0?(l(),r("div",an,[t("button",{class:"btn btn-outline-secondary",onClick:Ye}," Ã„nderungen verwerfen "),t("button",{class:pe(["btn",Le.value?"btn-primary":"btn-outline-secondary"]),onClick:Qe}," SegmentÃ¤nderungen speichern ",2),t("div",{class:"simple-timeline-track mt-2",onClick:Ne,ref_key:"timelineRef",ref:Z},[t("div",{class:"progress-bar",style:Se({width:`${$.value/b.value*100}%`})},null,4),(l(!0),r(q,null,K(A.value,s=>(l(),r("div",{key:s.id,class:"examination-marker",style:Se({left:`${s.timestamp/b.value*100}%`}),title:`Untersuchung bei ${g(p)(s.timestamp)}`},null,12,sn))),128))],512)])):v("",!0),b.value>0?(l(),r("div",ln,[t("small",on," Timeline Debug: "+i(x.value.length)+" video-spezifische Segmente | "+i(g(B).length)+" total Segmente | Duration: "+i(g(p)(b.value))+" | Playing: "+i(P.value)+" | Store: "+i(Object.keys(Ee.value).length)+" Labels ",1)])):v("",!0),a.value?(l(),r("div",rn,[t("div",dn,[t("div",un,[e[23]||(e[23]=t("label",{class:"form-label mb-0 me-2"},"Neues Label setzen:",-1)),ye(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),onChange:We,class:"form-select form-select-sm control-select","data-cy":"label-select"},[e[22]||(e[22]=t("option",{value:""},"Label auswÃ¤hlen...",-1)),(l(!0),r(q,null,K(le.value,s=>(l(),r("option",{key:s.id,value:s.name},i(g(O)(s.name)),9,cn))),128))],544),[[he,_.value]])]),t("div",mn,[E.value?v("",!0):(l(),r("button",{key:0,onClick:Ge,class:"btn btn-success btn-sm control-button",disabled:!ue.value,"data-cy":"start-label-button"},[...e[24]||(e[24]=[t("i",{class:"material-icons"},"label",-1),h(" Label-Start setzen ",-1)])],8,vn)),E.value?(l(),r("button",{key:1,onClick:Oe,class:"btn btn-warning btn-sm control-button","data-cy":"finish-label-button"},[...e[25]||(e[25]=[t("i",{class:"material-icons"},"stop",-1),h(" Label-Ende setzen ",-1)])])):v("",!0),E.value?(l(),r("button",{key:2,onClick:Xe,class:"btn btn-outline-secondary btn-sm control-button"}," Abbrechen ")):v("",!0)]),t("span",gn," Zeit: "+i(g(p)($.value))+" / "+i(g(p)(b.value)),1)]),g(c).draftSegment?(l(),r("div",fn,[t("small",null,[e[26]||(e[26]=t("i",{class:"material-icons align-middle me-1",style:{"font-size":"16px"}},"info",-1)),h(' Label "'+i(g(O)(g(c).draftSegment.label))+'" ',1),g(c).draftSegment.endTime?(l(),r("span",bn," von "+i(g(p)(g(c).draftSegment.startTime))+" bis "+i(g(p)(g(c).draftSegment.endTime)),1)):(l(),r("span",yn," startet bei "+i(g(p)(g(c).draftSegment.startTime))+" - Ende beim nÃ¤chsten Klick ",1))])])):v("",!0)])):v("",!0)])):v("",!0)]),a.value&&x.value.length>0?(l(),r("div",hn,[((fe=g(z).find(s=>s.id===a.value&&s.mediaType==="video"))==null?void 0:fe.anonymizationStatus)==="validated"?(l(),r("div",pn,[e[28]||(e[28]=t("i",{class:"fas fa-check-circle fa-2x me-3 text-success"},null,-1)),t("div",null,[e[27]||(e[27]=t("h6",{class:"mb-1"},[t("i",{class:"fas fa-medal me-1"}),h(" Video bereits validiert ")],-1)),t("small",Sn," Alle "+i(x.value.length)+" Segmente wurden Ã¼berprÃ¼ft und als validiert markiert. ",1)])])):(l(),r("button",{key:1,class:"btn btn-success btn-lg w-100 d-flex align-items-center justify-content-center gap-2",onClick:Je,style:{"font-size":"1.1rem",padding:"15px"}},[e[29]||(e[29]=t("i",{class:"material-icons"},"check_circle",-1)),t("span",null,"Alle Segmente validieren ("+i(x.value.length)+")",1)])),((be=g(z).find(s=>s.id===a.value&&s.mediaType==="video"))==null?void 0:be.anonymizationStatus)!=="validated"?(l(),r("p",_n,[...e[30]||(e[30]=[t("i",{class:"material-icons",style:{"font-size":"16px","vertical-align":"middle"}},"info",-1),h(' Markiert alle Segmente als Ã¼berprÃ¼ft und setzt Video-Status auf "Validiert" ',-1)])])):v("",!0)])):v("",!0)]),t("div",Vn,[t("div",kn,[t("div",wn,[e[34]||(e[34]=t("h5",{class:"mb-0"},[t("i",{class:"fas fa-clipboard-list me-2"}),h(" Anforderungsbasierte Annotation ")],-1)),N.value?(l(),r("small",xn," Zeitpunkt: "+i(g(p)(N.value.timestamp)),1)):v("",!0),a.value?(l(),r("div",Tn,[t("div",$n,[e[32]||(e[32]=t("i",{class:"fas fa-info-circle me-1"},null,-1)),t("strong",null,"Video "+i(a.value)+":",1),e[33]||(e[33]=h(" Erweiterte Untersuchungsannotation mit Anforderungssets und Befunden ",-1))])])):v("",!0)]),t("div",Ln,[Ce.value?(l(),ut(ft,{key:0,class:"requirement-generator-embedded","data-cy":"requirement-generator"})):(l(),r("div",zn,[...e[35]||(e[35]=[t("i",{class:"fas fa-video fa-3x mb-3 text-muted"},null,-1),t("h6",null,"Video-Untersuchung",-1),t("p",{class:"mb-0"},"WÃ¤hlen Sie ein Video aus, um mit der erweiterten Annotation zu beginnen",-1),t("small",{class:"text-muted"}," Anforderungssets, Befunde und Klassifikationen werden automatisch geladen ",-1)])]))])]),C.value.length>0?(l(),r("div",Cn,[e[38]||(e[38]=t("div",{class:"card-header pb-0"},[t("h6",{class:"mb-0"},"Gespeicherte Untersuchungen")],-1)),t("div",En,[t("div",Mn,[(l(!0),r(q,null,K(C.value,s=>(l(),r("div",{key:s.id,class:"list-group-item d-flex justify-content-between align-items-center px-0"},[t("div",null,[t("small",An,i(g(p)(s.timestamp)),1),t("div",null,i(s.examination_type||"Untersuchung"),1)]),t("div",null,[t("button",{onClick:lt=>He(s),class:"btn btn-sm btn-outline-primary me-2"},[...e[36]||(e[36]=[t("i",{class:"material-icons"},"play_arrow",-1)])],8,Dn),t("button",{onClick:lt=>Ze(s.id),class:"btn btn-sm btn-outline-danger"},[...e[37]||(e[37]=[t("i",{class:"material-icons"},"delete",-1)])],8,Un)])]))),128))])])])):v("",!0)])])])])}}}),Nn=mt(Pn,[["__scopeId","data-v-3df015a9"]]),Rn={class:"container-fluid h-100 w-100 py-1 px-4"},Xn=_e({__name:"VideoExamination",setup(ke){return(X,te)=>(l(),r("div",Rn,[Ve(Nn)]))}});export{Xn as default};
