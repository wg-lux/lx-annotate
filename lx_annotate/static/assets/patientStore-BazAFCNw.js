import{O as x,h as o,e as y,z as d}from"./main-DethiONo.js";const O=x("patient",()=>{const l=o([]),u=o(null),c=o(null),p=o([]),m=o([]),i=o(!1),r=o(null),w=y(()=>l.value.length),b=y(()=>l.value.map(e=>({...e,age:e.dob?f(e.dob):null}))),F=y(()=>l.value.map(e=>({...e,displayName:`${e.firstName||""} ${e.lastName||""} (ID: ${e.id})`.trim()}))),C=async()=>{var e,t;try{i.value=!0,r.value=null;const n=await d.get("/api/patients/");l.value=n.data.results||n.data}catch(n){r.value="Fehler beim Laden der Patienten: "+(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.detail)||n.message),console.error("Fetch patients error:",n)}finally{i.value=!1}},P=async()=>{try{const e=await d.get("/api/genders/");p.value=e.data.results||e.data}catch(e){console.error("Fetch genders error:",e),r.value="Fehler beim Laden der Geschlechter"}},g=async()=>{try{const e=await d.get("/api/centers/");m.value=e.data.results||e.data}catch(e){console.error("Fetch centers error:",e),r.value="Fehler beim Laden der Zentren"}},I=async()=>{await Promise.all([P(),g()])},N=async e=>{var t,n;try{i.value=!0,r.value=null;const s=(await d.post("/api/patients/",e)).data;return l.value.push(s),s}catch(a){throw r.value=((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.detail)||"Fehler beim Erstellen des Patienten",a}finally{i.value=!1}},S=async(e,t)=>{var n,a;try{i.value=!0,r.value=null;const h=(await d.put(`/api/patients/${e}/`,t)).data,v=l.value.findIndex($=>$.id===e);return v!==-1&&(l.value[v]=h),h}catch(s){throw r.value=((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.detail)||"Fehler beim Aktualisieren des Patienten",s}finally{i.value=!1}},G=async e=>{var t,n;try{i.value=!0,r.value=null,await d.delete(`/api/patients/${e}/`),l.value=l.value.filter(a=>a.id!==e)}catch(a){throw r.value=((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.detail)||"Fehler beim Löschen des Patienten",a}finally{i.value=!1}},k=e=>l.value.find(t=>t.id===e),L=()=>{r.value=null},f=e=>{if(!e)return null;try{const t=new Date(e),n=new Date;let a=n.getFullYear()-t.getFullYear();const s=n.getMonth()-t.getMonth();return(s<0||s===0&&n.getDate()<t.getDate())&&a--,a}catch{return null}};return{patients:l,currentPatient:u,selectedPatientId:c,genders:p,centers:m,loading:i,error:r,patientCount:w,patientsWithAge:b,patientsWithDisplayName:F,fetchPatients:C,fetchGenders:P,fetchCenters:g,loadGenders:async()=>{await P()},loadCenters:async()=>{await g()},initializeLookupData:I,createPatient:N,updatePatient:S,deletePatient:G,clearError:L,getPatientById:k,calculatePatientAge:f,getGenderDisplayName:e=>{if(!e)return"Unbekannt";const t=p.value.find(n=>n.name===e);return(t==null?void 0:t.nameDe)||(t==null?void 0:t.name)||e},getCenterDisplayName:e=>{if(!e)return"Kein Zentrum";const t=m.value.find(n=>n.name===e);return(t==null?void 0:t.nameDe)||(t==null?void 0:t.name)||e},validatePatientForm:e=>{var n,a;const t=[];return(n=e.firstName)!=null&&n.trim()||t.push("Vorname ist erforderlich"),(a=e.lastName)!=null&&a.trim()||t.push("Nachname ist erforderlich"),e.dob&&new Date(e.dob)>new Date&&t.push("Geburtsdatum kann nicht in der Zukunft liegen"),e.email&&!e.email.includes("@")&&t.push("Ungültige E-Mail-Adresse"),{isValid:t.length===0,errors:t}},formatPatientForSubmission:e=>{var t,n,a,s,h,v;return{id:e.id,firstName:(t=e.firstName)==null?void 0:t.trim(),lastName:(n=e.lastName)==null?void 0:n.trim(),dob:e.dob||null,gender:e.gender||null,center:e.center||null,email:((a=e.email)==null?void 0:a.trim())||"",phone:((s=e.phone)==null?void 0:s.trim())||"",patientHash:((h=e.patientHash)==null?void 0:h.trim())||"",comments:((v=e.comments)==null?void 0:v.trim())||"",isRealPerson:e.isRealPerson??!0}},clearCurrentPatient:()=>{u.value=null},getCurrentPatient:()=>u.value,setSelectedPatientId:e=>{c.value=e},getSelectedPatientId:()=>c.value,clearSelectedPatientId:()=>{c.value=null},setCurrentPatient:e=>{u.value=e},resolveCurrentPatientId:(e,t=!0)=>{var a;const n=(e&&e>0?e:null)??((a=u.value)!=null&&a.id&&u.value.id>0?u.value.id:null)??(c.value&&c.value>0?c.value:null);if(t&&!n)throw new Error("Kein Patient ausgewählt – patientId konnte nicht ermittelt werden.");return n}}});export{O as u};
