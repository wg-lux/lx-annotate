import{z as L,A as W,d as te,h as E,e as V,i as ae,c as a,a as e,E as de,k as u,l as S,j as p,G as F,n as U,t as l,v as ee,F as J,m as Y,H as re,o as n,_ as X,I as ie,b as Q,r as ue}from"./main-DethiONo.js";import{u as se}from"./patientStore-BazAFCNw.js";async function ce(s){if(!Number.isFinite(s)||s<=0)throw new Error("UngÃ¼ltige patientId");const{data:v}=await L.post(`/api/patients/${s}/pseudonym/`);return v}const G={async getPatients(){try{const s=await L.get(W("patients/"));return Array.isArray(s.data)?s.data:s.data.results||[]}catch(s){throw console.error("Error getting patients:",s),s}},async addPatient(s){try{console.log("PatientService: Sende Patientendaten an API:",s);const v=await L.post(W("patients/"),s);return console.log("PatientService: Erfolgreiche Antwort erhalten:",v.data),v.data}catch(v){throw console.error("PatientService: Fehler beim HinzufÃ¼gen des Patienten:",v),v.response?console.error("Response Error:",{status:v.response.status,statusText:v.response.statusText,data:v.response.data}):v.request?console.error("Request Error:",v.request):console.error("General Error:",v.message),v}},async updatePatient(s,v){try{return(await L.put(W(`patients/${s}/`),v)).data}catch(b){throw console.error("Error updating patient:",b),b}},async deletePatient(s){try{await L.delete(W(`patients/${s}/`))}catch(v){throw console.error("Error deleting patient:",v),v}},async getGenders(){try{return(await L.get(W("genders/")).catch(async()=>({data:[{id:1,name:"female",nameDe:"Weiblich"},{id:2,name:"male",nameDe:"MÃ¤nnlich"},{id:3,name:"diverse",nameDe:"Divers"}],status:200,statusText:"OK",headers:{},config:{}}))).data}catch(s){return console.error("Error getting genders:",s),[{id:1,name:"female",nameDe:"Weiblich"},{id:2,name:"male",nameDe:"MÃ¤nnlich"},{id:3,name:"diverse",nameDe:"Divers"}]}},async getCenters(){try{return(await L.get(W("centers/")).catch(async()=>({data:[{id:1,name:"Hauptzentrum",nameDe:"Hauptzentrum"}],status:200,statusText:"OK",headers:{},config:{}}))).data}catch(s){return console.error("Error getting centers:",s),[{id:1,name:"Hauptzentrum",nameDe:"Hauptzentrum"}]}},formatPatientData(s){const v={firstName:s.firstName,lastName:s.lastName,dob:s.dob||null,gender:s.gender||null,center:s.center||null,email:s.email||void 0,phone:s.phone||void 0,patientHash:s.patientHash||null,isRealPerson:s.isRealPerson??!0};return Object.keys(v).forEach(b=>{v[b]===""&&delete v[b]}),v},calculateAge(s){if(!s)return null;const v=new Date,b=new Date(s);if(isNaN(b.getTime()))return null;let _=v.getFullYear()-b.getFullYear();const k=v.getMonth()-b.getMonth();return(k<0||k===0&&v.getDate()<b.getDate())&&_--,_>=0?_:null},isValidEmail(s){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)},validatePatientData(s){var b,_;const v=[];if((b=s.firstName)!=null&&b.trim()||v.push("Vorname ist erforderlich"),(_=s.lastName)!=null&&_.trim()||v.push("Nachname ist erforderlich"),s.email&&!this.isValidEmail(s.email)&&v.push("UngÃ¼ltige E-Mail-Adresse"),s.dob){const k=new Date(s.dob),c=new Date;isNaN(k.getTime())?v.push("UngÃ¼ltiges Geburtsdatum"):k>c&&v.push("Geburtsdatum kann nicht in der Zukunft liegen")}return{isValid:v.length===0,errors:v}}},me={class:"patient-create-form"},ve={class:"form-section"},fe={class:"row"},be={class:"col-md-6"},pe={class:"form-group"},ge={key:0,class:"invalid-feedback"},he={class:"col-md-6"},ye={class:"form-group"},ke={key:0,class:"invalid-feedback"},$e={class:"row"},_e={class:"col-md-6"},Pe={class:"form-group"},Ne={key:0,class:"invalid-feedback"},we={key:1,class:"form-text text-muted"},De={class:"col-md-6"},xe={class:"form-group"},Ee=["value"],Ce={key:0,class:"invalid-feedback"},Se={class:"form-section"},Re={class:"row"},Ue={class:"col-md-6"},Ae={class:"form-group"},Ve={key:0,class:"invalid-feedback"},Te={class:"col-md-6"},Fe={class:"form-group"},je={key:0,class:"invalid-feedback"},He={class:"form-section"},Me={class:"row"},Oe={class:"col-md-6"},Ge={class:"form-group"},Le=["value"],Ie={key:0,class:"invalid-feedback"},Be={class:"col-md-6"},ze={class:"form-group"},Ke={class:"form-actions"},Ze={key:0,class:"alert alert-danger w-100 mb-3"},qe=["disabled"],We={key:0,class:"spinner-border spinner-border-sm me-2"},Je={key:1,class:"fas fa-save me-2"},Ye=["disabled"],Qe=te({__name:"PatientCreateForm",emits:["patient-created","cancel"],setup(s,{emit:v}){const b=v,_=se(),k=E(!1),c=E({}),m=E({id:null,firstName:"",lastName:"",dob:null,email:"",phone:"",gender:null,center:null,patientHash:"",comments:"",isRealPerson:!0}),w=V(()=>_.genders),P=V(()=>_.centers),C=V(()=>{if(!m.value.dob)return null;try{const D=new Date(m.value.dob),r=new Date;let y=r.getFullYear()-D.getFullYear();const T=r.getMonth()-D.getMonth();return(T<0||T===0&&r.getDate()<D.getDate())&&y--,y>=0?y:null}catch{return null}}),g=V(()=>m.value.firstName.trim()!==""&&m.value.lastName.trim()!==""&&Object.keys(c.value).length===0),f=()=>{var D,r;return c.value={},(D=m.value.firstName)!=null&&D.trim()||(c.value.firstName="Vorname ist erforderlich"),(r=m.value.lastName)!=null&&r.trim()||(c.value.lastName="Nachname ist erforderlich"),m.value.dob&&new Date(m.value.dob)>new Date&&(c.value.dob="Geburtsdatum kann nicht in der Zukunft liegen"),m.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.value.email)&&(c.value.email="UngÃ¼ltige E-Mail-Adresse"),Object.keys(c.value).length===0},x=async()=>{if(console.log("=== FORM SUBMIT START ==="),console.log("handleSubmit aufgerufen!",{formValid:g.value,loading:k.value,formData:m.value}),!f()){console.log("âŒ Validierung fehlgeschlagen:",c.value);return}let D=null;try{k.value=!0,c.value={},console.log("âœ… Validation passed, sende Daten:",m.value),D=_.formatPatientForSubmission(m.value),console.log("ðŸ“‹ Formatierte Daten fÃ¼r API:",D),console.log("ðŸŒ API-Aufruf wird gestartet..."),console.log("URL:","/api/patients/"),console.log("Full URL wird zu:",`${window.location.origin}/api/patients/`);const r=await _.createPatient(D);console.log("ðŸŽ‰ Patient erfolgreich erstellt:",r),m.value={id:null,firstName:"",lastName:"",dob:null,email:"",phone:"",gender:null,center:null,patientHash:"",comments:"",isRealPerson:!0},b("patient-created",r),console.log("ðŸ“¤ Event patient-created ausgelÃ¶st mit:",r),console.log("=== FORM SUBMIT SUCCESS ===")}catch(r){console.log("=== FORM SUBMIT ERROR ==="),console.error("âŒ KOMPLETTES ERROR-OBJEKT:",r),console.error("âŒ ERROR STACK:",r.stack),console.error("âŒ ERROR NAME:",r.name),console.error("âŒ ERROR MESSAGE:",r.message),r.message&&r.message.includes("HTTP error!")?c.value.general="Server-Fehler beim Erstellen des Patienten. PrÃ¼fen Sie Ihre Verbindung.":c.value.general=r.message||"Unbekannter Fehler beim Erstellen des Patienten",console.error("ðŸ” ZusÃ¤tzliche Debug-Infos:",{errorName:r.name,errorMessage:r.message,errorStack:r.stack,formattedData:D,timestamp:new Date().toISOString()})}finally{k.value=!1,console.log("ðŸ Loading beendet, finaler Zustand:",{loading:k.value,errors:c.value,hasErrors:Object.keys(c.value).length>0})}},I=async()=>{try{if(w.value.length===0){const D=await G.getGenders();_.genders=D}if(P.value.length===0){const D=await G.getCenters();_.centers=D}}catch(D){console.error("Error loading lookup data:",D)}};return ae(()=>{I()}),(D,r)=>(n(),a("div",me,[e("form",{onSubmit:de(x,["prevent"])},[e("div",ve,[r[14]||(r[14]=e("h4",null,[e("i",{class:"fas fa-user"}),u(" Grunddaten ")],-1)),e("div",fe,[e("div",be,[e("div",pe,[r[9]||(r[9]=e("label",{for:"firstName",class:"required"},"Vorname",-1)),S(e("input",{"onUpdate:modelValue":r[0]||(r[0]=y=>m.value.firstName=y),type:"text",id:"firstName",class:U(["form-control",{"is-invalid":c.value.firstName}]),required:"",placeholder:"Vorname eingeben"},null,2),[[F,m.value.firstName]]),c.value.firstName?(n(),a("div",ge,l(c.value.firstName),1)):p("",!0)])]),e("div",he,[e("div",ye,[r[10]||(r[10]=e("label",{for:"lastName",class:"required"},"Nachname",-1)),S(e("input",{"onUpdate:modelValue":r[1]||(r[1]=y=>m.value.lastName=y),type:"text",id:"lastName",class:U(["form-control",{"is-invalid":c.value.lastName}]),required:"",placeholder:"Nachname eingeben"},null,2),[[F,m.value.lastName]]),c.value.lastName?(n(),a("div",ke,l(c.value.lastName),1)):p("",!0)])])]),e("div",$e,[e("div",_e,[e("div",Pe,[r[11]||(r[11]=e("label",{for:"dob"},"Geburtsdatum",-1)),S(e("input",{"onUpdate:modelValue":r[2]||(r[2]=y=>m.value.dob=y),type:"date",id:"dob",class:U(["form-control",{"is-invalid":c.value.dob}])},null,2),[[F,m.value.dob]]),c.value.dob?(n(),a("div",Ne,l(c.value.dob),1)):p("",!0),C.value?(n(),a("small",we," Alter: "+l(C.value)+" Jahre ",1)):p("",!0)])]),e("div",De,[e("div",xe,[r[13]||(r[13]=e("label",{for:"gender"},"Geschlecht",-1)),S(e("select",{"onUpdate:modelValue":r[3]||(r[3]=y=>m.value.gender=y),id:"gender",class:U(["form-control",{"is-invalid":c.value.gender}])},[r[12]||(r[12]=e("option",{value:""},"Bitte wÃ¤hlen",-1)),(n(!0),a(J,null,Y(w.value,y=>(n(),a("option",{key:y.id,value:y.name},l(y.nameDe||y.name),9,Ee))),128))],2),[[ee,m.value.gender]]),c.value.gender?(n(),a("div",Ce,l(c.value.gender),1)):p("",!0)])])])]),e("div",Se,[r[17]||(r[17]=e("h4",null,[e("i",{class:"fas fa-address-book"}),u(" Kontaktdaten ")],-1)),e("div",Re,[e("div",Ue,[e("div",Ae,[r[15]||(r[15]=e("label",{for:"email"},"E-Mail",-1)),S(e("input",{"onUpdate:modelValue":r[4]||(r[4]=y=>m.value.email=y),type:"email",id:"email",class:U(["form-control",{"is-invalid":c.value.email}]),placeholder:"email@beispiel.de"},null,2),[[F,m.value.email]]),c.value.email?(n(),a("div",Ve,l(c.value.email),1)):p("",!0)])]),e("div",Te,[e("div",Fe,[r[16]||(r[16]=e("label",{for:"phone"},"Telefon",-1)),S(e("input",{"onUpdate:modelValue":r[5]||(r[5]=y=>m.value.phone=y),type:"tel",id:"phone",class:U(["form-control",{"is-invalid":c.value.phone}]),placeholder:"+49 123 456789"},null,2),[[F,m.value.phone]]),c.value.phone?(n(),a("div",je,l(c.value.phone),1)):p("",!0)])])])]),e("div",He,[r[22]||(r[22]=e("h4",null,[e("i",{class:"fas fa-hospital"}),u(" Organisation ")],-1)),e("div",Me,[e("div",Oe,[e("div",Ge,[r[19]||(r[19]=e("label",{for:"center"},"Zentrum",-1)),S(e("select",{"onUpdate:modelValue":r[6]||(r[6]=y=>m.value.center=y),id:"center",class:U(["form-control",{"is-invalid":c.value.center}])},[r[18]||(r[18]=e("option",{value:""},"Bitte wÃ¤hlen",-1)),(n(!0),a(J,null,Y(P.value,y=>(n(),a("option",{key:y.id,value:y.name},l(y.nameDe||y.name),9,Le))),128))],2),[[ee,m.value.center]]),c.value.center?(n(),a("div",Ie,l(c.value.center),1)):p("",!0)])]),e("div",Be,[e("div",ze,[e("label",null,[S(e("input",{"onUpdate:modelValue":r[7]||(r[7]=y=>m.value.isRealPerson=y),type:"checkbox",class:"form-check-input me-2"},null,512),[[re,m.value.isRealPerson]]),r[20]||(r[20]=u(" Reale Person ",-1))]),r[21]||(r[21]=e("small",{class:"form-text text-muted d-block"}," Aktiviert fÃ¼r echte Patienten, deaktiviert fÃ¼r Testdaten ",-1))])])])]),e("div",Ke,[c.value.general?(n(),a("div",Ze,[r[23]||(r[23]=e("strong",null,"Fehler:",-1)),u(" "+l(c.value.general),1)])):p("",!0),e("button",{type:"submit",class:"btn btn-primary",disabled:k.value||!g.value},[k.value?(n(),a("span",We)):(n(),a("i",Je)),u(" "+l(k.value?"Wird gespeichert...":"Patient erstellen"),1)],8,qe),e("button",{type:"button",class:"btn btn-secondary ms-2",onClick:r[8]||(r[8]=y=>D.$emit("cancel")),disabled:k.value},[...r[24]||(r[24]=[e("i",{class:"fas fa-times me-2"},null,-1),u(" Abbrechen ",-1)])],8,Ye)])],32)]))}}),Xe=X(Qe,[["__scopeId","data-v-75c0175d"]]),et={class:"patient-edit-form"},tt={class:"form-grid"},st={class:"form-section"},at={class:"form-group"},nt={key:0,class:"invalid-feedback"},lt={class:"form-group"},it={key:0,class:"invalid-feedback"},ot={class:"form-group"},dt=["max"],rt={key:0,class:"invalid-feedback"},ut={class:"form-group"},ct=["value"],mt={key:0,class:"invalid-feedback"},vt={class:"form-section"},ft={class:"form-group"},bt={key:0,class:"invalid-feedback"},pt={class:"form-group"},gt={key:0,class:"invalid-feedback"},ht={class:"form-group"},yt=["value"],kt={key:0,class:"invalid-feedback"},$t={class:"form-group"},_t={class:"form-check"},Pt={key:0,class:"alert alert-danger"},Nt={class:"form-actions"},wt={class:"action-group"},Dt=["disabled"],xt=["disabled"],Et={key:0,class:"spinner-border spinner-border-sm me-2"},Ct={key:1,class:"fas fa-save me-2"},St={class:"delete-section"},Rt=["disabled"],Ut={key:0,class:"modal-overlay"},At={class:"modal-dialog"},Vt={class:"modal-content"},Tt={class:"modal-body"},Ft={key:0,class:"deletion-info"},jt={class:"mb-0"},Ht={key:0},Mt={key:1},Ot={key:2},Gt={key:3},Lt={class:"modal-footer"},It=["disabled"],Bt=["disabled"],zt={key:0,class:"spinner-border spinner-border-sm me-2"},Kt={key:1,class:"fas fa-trash me-2"},Zt=te({__name:"PatientEditForm",props:{patient:{}},emits:["patient-updated","patient-deleted","cancel"],setup(s,{emit:v}){const b=s,_=v,k=se(),c=E(!1),m=E(!1),w=E(!1),P=E(""),C=E(null),g=ie({id:b.patient.id||null,firstName:b.patient.firstName||"",lastName:b.patient.lastName||"",dob:b.patient.dob?b.patient.dob.split("T")[0]:null,gender:b.patient.gender||null,center:b.patient.center||null,email:b.patient.email||"",phone:b.patient.phone||"",patientHash:b.patient.patientHash||"",comments:"",isRealPerson:b.patient.isRealPerson??!0}),f=ie({firstName:"",lastName:"",dob:"",gender:"",center:"",email:"",phone:"",patientHash:""}),x=V(()=>k.genders),I=V(()=>k.centers),D=V(()=>new Date().toISOString().split("T")[0]),r=V(()=>g.firstName.trim()&&g.lastName.trim()&&!Object.values(f).some(N=>N)),y=()=>{Object.keys(f).forEach(i=>{f[i]=""});let N=!0;return g.firstName.trim()||(f.firstName="Vorname ist erforderlich",N=!1),g.lastName.trim()||(f.lastName="Nachname ist erforderlich",N=!1),g.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)&&(f.email="UngÃ¼ltige E-Mail-Adresse",N=!1),g.dob&&new Date(g.dob)>new Date&&(f.dob="Geburtsdatum kann nicht in der Zukunft liegen",N=!1),N},T=async()=>{var N;if(y())try{c.value=!0,P.value="";const i=G.formatPatientData(g),o=await G.updatePatient(b.patient.id,i);_("patient-updated",o)}catch(i){if(console.error("Error updating patient:",i),(N=i.response)!=null&&N.data){const o=i.response.data;typeof o=="object"&&Object.keys(o).forEach(d=>{d in f&&(f[d]=Array.isArray(o[d])?o[d][0]:o[d])}),P.value=o.detail||o.message||"Fehler beim Aktualisieren des Patienten"}else P.value=i.message||"Unbekannter Fehler beim Aktualisieren des Patienten"}finally{c.value=!1}},K=async()=>{try{m.value=!0,await G.deletePatient(b.patient.id),_("patient-deleted",b.patient.id),w.value=!1}catch(N){console.error("Error deleting patient:",N),P.value=N.message||"Fehler beim LÃ¶schen des Patienten",w.value=!1}finally{m.value=!1}},Z=async()=>{try{const N=await fetch(`/api/patients/${b.patient.id}/check_deletion_safety/`);if(N.ok){const i=await N.json();C.value=i.related_objects}}catch(N){console.error("Error loading deletion info:",N)}};return ae(()=>{Z()}),(N,i)=>(n(),a("div",et,[e("form",{onSubmit:de(T,["prevent"]),class:"edit-form"},[e("div",tt,[e("div",st,[i[17]||(i[17]=e("h5",{class:"section-title"},[e("i",{class:"fas fa-user"}),u(" Grunddaten ")],-1)),e("div",at,[i[11]||(i[11]=e("label",{for:"firstName",class:"form-label required"}," Vorname ",-1)),S(e("input",{id:"firstName","onUpdate:modelValue":i[0]||(i[0]=o=>g.firstName=o),type:"text",class:U(["form-control",{"is-invalid":f.firstName}]),required:"",maxlength:"100"},null,2),[[F,g.firstName]]),f.firstName?(n(),a("div",nt,l(f.firstName),1)):p("",!0)]),e("div",lt,[i[12]||(i[12]=e("label",{for:"lastName",class:"form-label required"}," Nachname ",-1)),S(e("input",{id:"lastName","onUpdate:modelValue":i[1]||(i[1]=o=>g.lastName=o),type:"text",class:U(["form-control",{"is-invalid":f.lastName}]),required:"",maxlength:"100"},null,2),[[F,g.lastName]]),f.lastName?(n(),a("div",it,l(f.lastName),1)):p("",!0)]),e("div",ot,[i[13]||(i[13]=e("label",{for:"dob",class:"form-label"}," Geburtsdatum ",-1)),S(e("input",{id:"dob","onUpdate:modelValue":i[2]||(i[2]=o=>g.dob=o),type:"date",class:U(["form-control",{"is-invalid":f.dob}]),max:D.value},null,10,dt),[[F,g.dob]]),f.dob?(n(),a("div",rt,l(f.dob),1)):p("",!0),i[14]||(i[14]=e("small",{class:"form-text text-muted"}," Optional - Wird zur Altersberechnung verwendet ",-1))]),e("div",ut,[i[16]||(i[16]=e("label",{for:"gender",class:"form-label"}," Geschlecht ",-1)),S(e("select",{id:"gender","onUpdate:modelValue":i[3]||(i[3]=o=>g.gender=o),class:U(["form-select",{"is-invalid":f.gender}])},[i[15]||(i[15]=e("option",{value:""},"Bitte wÃ¤hlen",-1)),(n(!0),a(J,null,Y(x.value,o=>(n(),a("option",{key:o.id,value:o.name},l(o.nameDe||o.name),9,ct))),128))],2),[[ee,g.gender]]),f.gender?(n(),a("div",mt,l(f.gender),1)):p("",!0)])]),e("div",vt,[i[23]||(i[23]=e("h5",{class:"section-title"},[e("i",{class:"fas fa-address-book"}),u(" Kontaktdaten ")],-1)),e("div",ft,[i[18]||(i[18]=e("label",{for:"email",class:"form-label"}," E-Mail-Adresse ",-1)),S(e("input",{id:"email","onUpdate:modelValue":i[4]||(i[4]=o=>g.email=o),type:"email",class:U(["form-control",{"is-invalid":f.email}]),maxlength:"254"},null,2),[[F,g.email]]),f.email?(n(),a("div",bt,l(f.email),1)):p("",!0)]),e("div",pt,[i[19]||(i[19]=e("label",{for:"phone",class:"form-label"}," Telefonnummer ",-1)),S(e("input",{id:"phone","onUpdate:modelValue":i[5]||(i[5]=o=>g.phone=o),type:"tel",class:U(["form-control",{"is-invalid":f.phone}]),maxlength:"20"},null,2),[[F,g.phone]]),f.phone?(n(),a("div",gt,l(f.phone),1)):p("",!0)]),e("div",ht,[i[21]||(i[21]=e("label",{for:"center",class:"form-label"}," Zentrum ",-1)),S(e("select",{id:"center","onUpdate:modelValue":i[6]||(i[6]=o=>g.center=o),class:U(["form-select",{"is-invalid":f.center}])},[i[20]||(i[20]=e("option",{value:""},"Kein Zentrum zugeordnet",-1)),(n(!0),a(J,null,Y(I.value,o=>(n(),a("option",{key:o.id,value:o.name},l(o.nameDe||o.name),9,yt))),128))],2),[[ee,g.center]]),f.center?(n(),a("div",kt,l(f.center),1)):p("",!0)]),e("div",$t,[e("div",_t,[S(e("input",{id:"isRealPerson","onUpdate:modelValue":i[7]||(i[7]=o=>g.isRealPerson=o),class:"form-check-input",type:"checkbox"},null,512),[[re,g.isRealPerson]]),i[22]||(i[22]=e("label",{class:"form-check-label",for:"isRealPerson"},[e("strong",null,"Realer Patient"),e("small",{class:"d-block text-muted"}," Markieren Sie dies nur fÃ¼r echte Patientendaten ")],-1))])])])]),P.value?(n(),a("div",Pt,[i[24]||(i[24]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),i[25]||(i[25]=e("strong",null,"Fehler:",-1)),u(" "+l(P.value),1)])):p("",!0),e("div",Nt,[e("div",wt,[e("button",{type:"button",class:"btn btn-secondary",onClick:i[8]||(i[8]=o=>N.$emit("cancel")),disabled:c.value},[...i[26]||(i[26]=[e("i",{class:"fas fa-times"},null,-1),u(" Abbrechen ",-1)])],8,Dt),e("button",{type:"submit",class:"btn btn-primary",disabled:c.value||!r.value},[c.value?(n(),a("span",Et)):(n(),a("i",Ct)),u(" "+l(c.value?"Wird gespeichert...":"Speichern"),1)],8,xt)]),e("div",St,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:i[9]||(i[9]=o=>w.value=!0),disabled:c.value},[...i[27]||(i[27]=[e("i",{class:"fas fa-trash"},null,-1),u(" Patient lÃ¶schen ",-1)])],8,Rt)])])],32),w.value?(n(),a("div",Ut,[e("div",At,[e("div",Vt,[i[32]||(i[32]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-exclamation-triangle text-danger"}),u(" Patient lÃ¶schen bestÃ¤tigen ")])],-1)),e("div",Tt,[i[31]||(i[31]=e("div",{class:"alert alert-warning"},[e("i",{class:"fas fa-exclamation-triangle"}),e("strong",null,"Achtung!"),u(" Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. ")],-1)),e("p",null,[i[28]||(i[28]=u(" MÃ¶chten Sie den Patienten ",-1)),e("strong",null,l(s.patient.firstName)+" "+l(s.patient.lastName),1),i[29]||(i[29]=u(" wirklich lÃ¶schen? ",-1))]),C.value?(n(),a("div",Ft,[i[30]||(i[30]=e("h6",null,"Auswirkungen:",-1)),e("ul",jt,[C.value.examinations>0?(n(),a("li",Ht,l(C.value.examinations)+" Untersuchung(en) werden gelÃ¶scht ",1)):p("",!0),C.value.findings>0?(n(),a("li",Mt,l(C.value.findings)+" Befund(e) werden gelÃ¶scht ",1)):p("",!0),C.value.videos>0?(n(),a("li",Ot,l(C.value.videos)+" Video(s) werden entfernt ",1)):p("",!0),C.value.reports>0?(n(),a("li",Gt,l(C.value.reports)+" Bericht(e) werden entfernt ",1)):p("",!0)])])):p("",!0)]),e("div",Lt,[e("button",{type:"button",class:"btn btn-secondary",onClick:i[10]||(i[10]=o=>w.value=!1),disabled:m.value}," Abbrechen ",8,It),e("button",{type:"button",class:"btn btn-danger",onClick:K,disabled:m.value},[m.value?(n(),a("span",zt)):(n(),a("i",Kt)),u(" "+l(m.value?"Wird gelÃ¶scht...":"EndgÃ¼ltig lÃ¶schen"),1)],8,Bt)])])])])):p("",!0)]))}}),oe=X(Zt,[["__scopeId","data-v-b5cf8612"]]),qt={class:"patient-detail-view"},Wt={class:"detail-header"},Jt={class:"patient-header-info"},Yt={class:"patient-title"},Qt={key:0,class:"badge bg-success"},Xt={key:1,class:"badge bg-secondary"},es={class:"detail-actions"},ts=["disabled"],ss=["disabled"],as=["disabled"],ns={key:0,class:"alert alert-danger"},ls={key:1,class:"alert alert-success"},is={key:2,class:"edit-section"},os={class:"card"},ds={class:"card-body"},rs={key:3,class:"patient-info-display"},us={class:"row"},cs={class:"col-md-6"},ms={class:"card info-card"},vs={class:"card-body"},fs={class:"info-grid"},bs={class:"info-item"},ps={class:"info-item"},gs={class:"info-item"},hs={key:0,class:"pseudonym-names"},ys=["disabled"],ks={key:0,class:"spinner-border spinner-border-sm me-1"},$s={key:1,class:"fas fa-refresh"},_s=["disabled"],Ps={key:0,class:"spinner-border spinner-border-sm me-1"},Ns={key:1,class:"fas fa-user-secret"},ws={class:"info-item"},Ds={key:0,class:"text-muted"},xs={class:"info-item"},Es={class:"col-md-6"},Cs={class:"card info-card"},Ss={class:"card-body"},Rs={class:"info-grid"},Us={class:"info-item"},As=["href"],Vs={key:1,class:"text-muted"},Ts={class:"info-item"},Fs=["href"],js={key:1,class:"text-muted"},Hs={class:"info-item"},Ms={class:"info-item"},Os={class:"d-flex align-items-center gap-2"},Gs={class:"font-mono"},Ls=["disabled"],Is={key:0,class:"spinner-border spinner-border-sm me-1"},Bs={key:1,class:"fas fa-key me-1"},zs={class:"row mt-3"},Ks={class:"col-12"},Zs={class:"card info-card"},qs={class:"card-body"},Ws={class:"row"},Js={class:"col-md-6"},Ys={class:"info-item"},Qs={class:"font-mono"},Xs={class:"info-item"},ea={key:0,class:"badge bg-success"},ta={key:1,class:"badge bg-secondary"},sa={class:"col-md-6"},aa={class:"info-item"},na={class:"info-item"},la={key:4,class:"modal-overlay"},ia={class:"modal-dialog"},oa={class:"modal-content"},da={class:"modal-body"},ra={key:0,class:"alert alert-info"},ua={key:1,class:"alert alert-warning"},ca={class:"mt-2 mb-0"},ma={class:"patient-detail-view"},va={class:"detail-header"},fa={class:"patient-header-info"},ba={class:"patient-title"},pa={key:0,class:"badge bg-success"},ga={key:1,class:"badge bg-secondary"},ha={class:"detail-actions"},ya=["disabled"],ka=["disabled"],$a=["disabled"],_a={key:0,class:"alert alert-danger"},Pa={key:1,class:"alert alert-success"},Na={key:2,class:"edit-section"},wa={class:"card"},Da={class:"card-body"},xa={key:3,class:"patient-info-display"},Ea={class:"row"},Ca={class:"col-md-6"},Sa={class:"card info-card"},Ra={class:"card-body"},Ua={class:"info-grid"},Aa={class:"info-item"},Va={class:"info-item"},Ta={class:"info-item"},Fa={key:0,class:"pseudonym-names"},ja=["disabled"],Ha={key:0,class:"spinner-border spinner-border-sm me-1"},Ma={key:1,class:"fas fa-refresh"},Oa=["disabled"],Ga={key:0,class:"spinner-border spinner-border-sm me-1"},La={key:1,class:"fas fa-user-secret"},Ia={class:"info-item"},Ba={key:0,class:"text-muted"},za={class:"info-item"},Ka={class:"col-md-6"},Za={class:"card info-card"},qa={class:"card-body"},Wa={class:"info-grid"},Ja={class:"info-item"},Ya=["href"],Qa={key:1,class:"text-muted"},Xa={class:"info-item"},en=["href"],tn={key:1,class:"text-muted"},sn={class:"info-item"},an={class:"info-item"},nn={class:"font-mono"},ln={class:"row mt-3"},on={class:"col-12"},dn={class:"card info-card"},rn={class:"card-body"},un={class:"row"},cn={class:"col-md-6"},mn={class:"info-item"},vn={class:"font-mono"},fn={class:"info-item"},bn={key:0,class:"badge bg-success"},pn={key:1,class:"badge bg-secondary"},gn={class:"col-md-6"},hn={class:"info-item"},yn={class:"info-item"},kn={key:4,class:"modal-overlay"},$n={class:"modal-dialog"},_n={class:"modal-content"},Pn={class:"modal-body"},Nn={key:0,class:"alert alert-info"},wn={key:1,class:"alert alert-warning"},Dn={class:"mt-2 mb-0"},xn={key:2,class:"mt-3"},En={class:"related-objects"},Cn={class:"object-count"},Sn={class:"object-count"},Rn={class:"object-count"},Un={class:"object-count"},An={class:"modal-footer"},Vn=["disabled"],Tn=["disabled"],Fn={key:0,class:"spinner-border spinner-border-sm me-2"},jn={key:1,class:"fas fa-trash me-2"},Hn={key:2,class:"mt-3"},Mn={class:"related-objects"},On={class:"object-count"},Gn={class:"object-count"},Ln={class:"object-count"},In={class:"object-count"},Bn={class:"modal-footer"},zn=["disabled"],Kn=["disabled"],Zn={key:0,class:"spinner-border spinner-border-sm me-2"},qn={key:1,class:"fas fa-trash me-2"},Wn=te({__name:"PatientDetailView",props:{patient:{}},emits:["patient-updated","patient-deleted","close"],setup(s,{emit:v}){const b=s,_=v,k=se(),c=E(!1),m=E(""),w=E(""),P=E(!1),C=E(!1),g=E(!1),f=E(null),x=E(!1),I=V(()=>k.genders),D=V(()=>k.centers),r=async()=>{var $,t;try{c.value=!0,m.value="";const R=k.getCurrentPatient();if(!R||!R.id)throw new Error("Aktueller Patient nicht gefunden");const B=k.resolveCurrentPatientId(R.id,!0),z=await L.get(`/api/patients/${B}/check_deletion_safety/`);f.value=z.data,C.value=!0}catch(R){m.value=((t=($=R.response)==null?void 0:$.data)==null?void 0:t.detail)||R.message||"Fehler beim PrÃ¼fen der LÃ¶schbarkeit"}finally{c.value=!1}},y=async()=>{try{g.value=!0,await G.deletePatient(b.patient.id),w.value=`Patient "${b.patient.firstName} ${b.patient.lastName}" wurde erfolgreich gelÃ¶scht.`,_("patient-deleted",b.patient.id),T()}catch($){m.value=$.message||"Fehler beim LÃ¶schen des Patienten"}finally{g.value=!1}},T=()=>{C.value=!1,f.value=null},K=$=>{P.value=!1,w.value="Patient wurde erfolgreich aktualisiert.",_("patient-updated",$),setTimeout(()=>{w.value=""},5e3)},Z=$=>{P.value=!1,_("patient-deleted",$)},N=$=>{if(!$)return"Nicht angegeben";try{return new Date($).toLocaleDateString("de-DE")}catch{return"UngÃ¼ltig"}},i=$=>{if(!$)return"Nicht angegeben";try{return new Date($).toLocaleString("de-DE")}catch{return"UngÃ¼ltig"}},o=$=>{if(!$)return"Nicht angegeben";const t=I.value.find(R=>R.name===$);return(t==null?void 0:t.nameDe)||(t==null?void 0:t.name)||$},d=$=>{if(!$)return"Nicht zugeordnet";const t=D.value.find(R=>R.name===$);return(t==null?void 0:t.nameDe)||(t==null?void 0:t.name)||$},h=$=>{const t={...b.patient,patientHash:$};_("patient-updated",t)},j=async()=>{var $,t,R,B,z;try{x.value=!0,m.value="";const A=k.resolveCurrentPatientId(($=b.patient)==null?void 0:$.id,!0),H=await ce(A);h(H.patientHash);const O=H.patientHash&&H.patientHash.length>=8?H.patientHash.substring(0,8)+"...":H.patientHash||"â€”";w.value=`Pseudonym-Hash erfolgreich generiert: ${O}`,setTimeout(()=>{w.value=""},3e3)}catch(A){const H=((R=(t=A==null?void 0:A.response)==null?void 0:t.data)==null?void 0:R.detail)||(A==null?void 0:A.message)||"Unbekannter Fehler",O=(z=(B=A==null?void 0:A.response)==null?void 0:B.data)==null?void 0:z.missingFields;m.value=O!=null&&O.length?`Fehlende Felder: ${O.join(", ")}`:`Fehler beim Generieren des Pseudonym-Hashes: ${H}`}finally{x.value=!1}},q=async()=>{await j()};return($,t)=>{var R,B,z,A,H,O,ne,le;return n(),a("div",qt,[e("div",Wt,[e("div",Jt,[e("h2",Yt,[t[6]||(t[6]=e("i",{class:"fas fa-user"},null,-1)),u(" "+l(s.patient.firstName)+" "+l(s.patient.lastName),1)]),s.patient.isRealPerson?(n(),a("span",Qt,[...t[7]||(t[7]=[e("i",{class:"fas fa-shield-alt"},null,-1),u(" Realer Patient ",-1)])])):(n(),a("span",Xt,[...t[8]||(t[8]=[e("i",{class:"fas fa-user-secret"},null,-1),u(" Test-Patient ",-1)])]))]),e("div",es,[e("button",{class:"btn btn-secondary btn-sm",onClick:t[0]||(t[0]=M=>$.$emit("close")),disabled:c.value},[...t[9]||(t[9]=[e("i",{class:"fas fa-times"},null,-1),u(" SchlieÃŸen ",-1)])],8,ts),e("button",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=M=>P.value=!0),disabled:c.value||P.value},[...t[10]||(t[10]=[e("i",{class:"fas fa-edit"},null,-1),u(" Bearbeiten ",-1)])],8,ss),e("button",{class:"btn btn-outline-danger btn-sm",onClick:r,disabled:c.value||P.value},[...t[11]||(t[11]=[e("i",{class:"fas fa-trash"},null,-1),u(" LÃ¶schen ",-1)])],8,as)])]),m.value?(n(),a("div",ns,[t[12]||(t[12]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),u(" "+l(m.value),1)])):p("",!0),w.value?(n(),a("div",ls,[t[13]||(t[13]=e("i",{class:"fas fa-check-circle"},null,-1)),u(" "+l(w.value),1)])):p("",!0),P.value?(n(),a("div",is,[e("div",os,[t[14]||(t[14]=e("div",{class:"card-header"},[e("h4",{class:"card-title"},[e("i",{class:"fas fa-edit"}),u(" Patient bearbeiten ")])],-1)),e("div",ds,[Q(oe,{patient:s.patient,onPatientUpdated:K,onPatientDeleted:Z,onCancel:t[2]||(t[2]=M=>P.value=!1)},null,8,["patient"])])])])):(n(),a("div",rs,[e("div",us,[e("div",cs,[e("div",ms,[t[20]||(t[20]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-user"}),u(" Grunddaten ")])],-1)),e("div",vs,[e("div",fs,[e("div",bs,[t[15]||(t[15]=e("label",null,"Vorname:",-1)),e("span",null,l(s.patient.firstName||"Nicht angegeben"),1)]),e("div",ps,[t[16]||(t[16]=e("label",null,"Nachname:",-1)),e("span",null,l(s.patient.lastName||"Nicht angegeben"),1)]),e("div",gs,[t[17]||(t[17]=e("label",null,"Pseudonym:",-1)),s.patient.pseudonymFirstName&&s.patient.pseudonymLastName?(n(),a("span",hs,[u(l(s.patient.pseudonymFirstName)+" "+l(s.patient.pseudonymLastName)+" ",1),e("button",{class:"btn btn-outline-secondary btn-sm ms-2",onClick:q,disabled:x.value,title:"Neue Pseudonamen generieren"},[x.value?(n(),a("span",ks)):(n(),a("i",$s)),u(" "+l(x.value?"Generiere...":"Neu"),1)],8,ys)])):(n(),a("button",{key:1,class:"btn btn-outline-primary btn-sm",onClick:j,disabled:x.value},[x.value?(n(),a("span",Ps)):(n(),a("i",Ns)),u(" "+l(x.value?"Generiere...":"Pseudonym generieren"),1)],8,_s))]),e("div",ws,[t[18]||(t[18]=e("label",null,"Geburtsdatum:",-1)),e("span",null,[u(l(N(s.patient.dob))+" ",1),s.patient.age?(n(),a("small",Ds,"("+l(s.patient.age)+" Jahre)",1)):p("",!0)])]),e("div",xs,[t[19]||(t[19]=e("label",null,"Geschlecht:",-1)),e("span",null,l(o(s.patient.gender)),1)])])])])]),e("div",Es,[e("div",Cs,[t[25]||(t[25]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-address-book"}),u(" Kontaktdaten ")])],-1)),e("div",Ss,[e("div",Rs,[e("div",Us,[t[21]||(t[21]=e("label",null,"E-Mail:",-1)),e("span",null,[s.patient.email?(n(),a("a",{key:0,href:`mailto:${s.patient.email}`,class:"link"},l(s.patient.email),9,As)):(n(),a("span",Vs,"Nicht angegeben"))])]),e("div",Ts,[t[22]||(t[22]=e("label",null,"Telefon:",-1)),e("span",null,[s.patient.phone?(n(),a("a",{key:0,href:`tel:${s.patient.phone}`,class:"link"},l(s.patient.phone),9,Fs)):(n(),a("span",js,"Nicht angegeben"))])]),e("div",Hs,[t[23]||(t[23]=e("label",null,"Zentrum:",-1)),e("span",null,l(d(s.patient.center)),1)]),e("div",Ms,[t[24]||(t[24]=e("label",null,"Patient Hash:",-1)),e("div",Os,[e("span",Gs,l(s.patient.patientHash?s.patient.patientHash.length>=8?s.patient.patientHash.substring(0,8)+"...":s.patient.patientHash:"Nicht generiert"),1),e("button",{class:"btn btn-sm btn-outline-primary",onClick:j,disabled:x.value,title:"Pseudonym-Hash generieren"},[x.value?(n(),a("span",Is)):(n(),a("i",Bs)),u(" "+l(x.value?"Generiere...":s.patient.patientHash?"Aktualisieren":"Generieren"),1)],8,Ls)])])])])])])]),e("div",zs,[e("div",Ks,[e("div",Zs,[t[32]||(t[32]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-cog"}),u(" Systeminformationen ")])],-1)),e("div",qs,[e("div",Ws,[e("div",Js,[e("div",Ys,[t[26]||(t[26]=e("label",null,"Patient-ID:",-1)),e("span",Qs,l(s.patient.id),1)]),e("div",Xs,[t[29]||(t[29]=e("label",null,"Datentyp:",-1)),e("span",null,[s.patient.isRealPerson?(n(),a("span",ea,[...t[27]||(t[27]=[e("i",{class:"fas fa-shield-alt"},null,-1),u(" Realer Patient ",-1)])])):(n(),a("span",ta,[...t[28]||(t[28]=[e("i",{class:"fas fa-user-secret"},null,-1),u(" Test-/Pseudo-Patient ",-1)])]))])])]),e("div",sa,[e("div",aa,[t[30]||(t[30]=e("label",null,"Erstellt am:",-1)),e("span",null,l(i(s.patient.createdAt)),1)]),e("div",na,[t[31]||(t[31]=e("label",null,"Zuletzt geÃ¤ndert:",-1)),e("span",null,l(i(s.patient.updatedAt)),1)])])])])])])])])),C.value?(n(),a("div",la,[e("div",ia,[e("div",oa,[t[77]||(t[77]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-exclamation-triangle text-warning"}),u(" LÃ¶schvorgang prÃ¼fen ")])],-1)),e("div",da,[(R=f.value)!=null&&R.canDelete?(n(),a("div",ra,[...t[33]||(t[33]=[e("i",{class:"fas fa-info-circle"},null,-1),e("strong",null,"Patient kann gelÃ¶scht werden.",-1),e("p",{class:"mb-0 mt-2"},"Sind Sie sicher, dass Sie diesen Patienten lÃ¶schen mÃ¶chten?",-1)])])):(n(),a("div",ua,[t[70]||(t[70]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[71]||(t[71]=e("strong",null,"Patient kann nicht gelÃ¶scht werden.",-1)),e("ul",ca,[e("template",null,[e("div",ma,[e("div",va,[e("div",fa,[e("h2",ba,[t[34]||(t[34]=e("i",{class:"fas fa-user"},null,-1)),u(" "+l(s.patient.firstName)+" "+l(s.patient.lastName),1)]),s.patient.isRealPerson?(n(),a("span",pa,[...t[35]||(t[35]=[e("i",{class:"fas fa-shield-alt"},null,-1),u(" Realer Patient ",-1)])])):(n(),a("span",ga,[...t[36]||(t[36]=[e("i",{class:"fas fa-user-secret"},null,-1),u(" Test-Patient ",-1)])]))]),e("div",ha,[e("button",{class:"btn btn-secondary btn-sm",onClick:t[3]||(t[3]=M=>$.$emit("close")),disabled:c.value},[...t[37]||(t[37]=[e("i",{class:"fas fa-times"},null,-1),u(" SchlieÃŸen ",-1)])],8,ya),e("button",{class:"btn btn-primary btn-sm",onClick:t[4]||(t[4]=M=>P.value=!0),disabled:c.value||P.value},[...t[38]||(t[38]=[e("i",{class:"fas fa-edit"},null,-1),u(" Bearbeiten ",-1)])],8,ka),e("button",{class:"btn btn-outline-danger btn-sm",onClick:r,disabled:c.value||P.value},[...t[39]||(t[39]=[e("i",{class:"fas fa-trash"},null,-1),u(" LÃ¶schen ",-1)])],8,$a)])]),m.value?(n(),a("div",_a,[t[40]||(t[40]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),u(" "+l(m.value),1)])):p("",!0),w.value?(n(),a("div",Pa,[t[41]||(t[41]=e("i",{class:"fas fa-check-circle"},null,-1)),u(" "+l(w.value),1)])):p("",!0),P.value?(n(),a("div",Na,[e("div",wa,[t[42]||(t[42]=e("div",{class:"card-header"},[e("h4",{class:"card-title"},[e("i",{class:"fas fa-edit"}),u(" Patient bearbeiten ")])],-1)),e("div",Da,[Q(oe,{patient:s.patient,onPatientUpdated:K,onPatientDeleted:Z,onCancel:t[5]||(t[5]=M=>P.value=!1)},null,8,["patient"])])])])):(n(),a("div",xa,[e("div",Ea,[e("div",Ca,[e("div",Sa,[t[48]||(t[48]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-user"}),u(" Grunddaten ")])],-1)),e("div",Ra,[e("div",Ua,[e("div",Aa,[t[43]||(t[43]=e("label",null,"Vorname:",-1)),e("span",null,l(s.patient.firstName||"Nicht angegeben"),1)]),e("div",Va,[t[44]||(t[44]=e("label",null,"Nachname:",-1)),e("span",null,l(s.patient.lastName||"Nicht angegeben"),1)]),e("div",Ta,[t[45]||(t[45]=e("label",null,"Pseudonym:",-1)),s.patient.pseudonymFirstName&&s.patient.pseudonymLastName?(n(),a("span",Fa,[u(l(s.patient.pseudonymFirstName)+" "+l(s.patient.pseudonymLastName)+" ",1),e("button",{class:"btn btn-outline-secondary btn-sm ms-2",onClick:q,disabled:x.value,title:"Neue Pseudonamen generieren"},[x.value?(n(),a("span",Ha)):(n(),a("i",Ma)),u(" "+l(x.value?"Generiere...":"Neu"),1)],8,ja)])):(n(),a("button",{key:1,class:"btn btn-outline-primary btn-sm",onClick:j,disabled:x.value},[x.value?(n(),a("span",Ga)):(n(),a("i",La)),u(" "+l(x.value?"Generiere...":"Pseudonym generieren"),1)],8,Oa))]),e("div",Ia,[t[46]||(t[46]=e("label",null,"Geburtsdatum:",-1)),e("span",null,[u(l(N(s.patient.dob))+" ",1),s.patient.age?(n(),a("small",Ba,"("+l(s.patient.age)+" Jahre)",1)):p("",!0)])]),e("div",za,[t[47]||(t[47]=e("label",null,"Geschlecht:",-1)),e("span",null,l(o(s.patient.gender)),1)])])])])]),e("div",Ka,[e("div",Za,[t[53]||(t[53]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-address-book"}),u(" Kontaktdaten ")])],-1)),e("div",qa,[e("div",Wa,[e("div",Ja,[t[49]||(t[49]=e("label",null,"E-Mail:",-1)),e("span",null,[s.patient.email?(n(),a("a",{key:0,href:`mailto:${s.patient.email}`,class:"link"},l(s.patient.email),9,Ya)):(n(),a("span",Qa,"Nicht angegeben"))])]),e("div",Xa,[t[50]||(t[50]=e("label",null,"Telefon:",-1)),e("span",null,[s.patient.phone?(n(),a("a",{key:0,href:`tel:${s.patient.phone}`,class:"link"},l(s.patient.phone),9,en)):(n(),a("span",tn,"Nicht angegeben"))])]),e("div",sn,[t[51]||(t[51]=e("label",null,"Zentrum:",-1)),e("span",null,l(d(s.patient.center)),1)]),e("div",an,[t[52]||(t[52]=e("label",null,"Patient Hash:",-1)),e("span",nn,l(s.patient.patientHash?s.patient.patientHash.length>=8?s.patient.patientHash.substring(0,8)+"...":s.patient.patientHash:"Nicht generiert"),1)])])])])])]),e("div",ln,[e("div",on,[e("div",dn,[t[60]||(t[60]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-cog"}),u(" Systeminformationen ")])],-1)),e("div",rn,[e("div",un,[e("div",cn,[e("div",mn,[t[54]||(t[54]=e("label",null,"Patient-ID:",-1)),e("span",vn,l(s.patient.id),1)]),e("div",fn,[t[57]||(t[57]=e("label",null,"Datentyp:",-1)),e("span",null,[s.patient.isRealPerson?(n(),a("span",bn,[...t[55]||(t[55]=[e("i",{class:"fas fa-shield-alt"},null,-1),u(" Realer Patient ",-1)])])):(n(),a("span",pn,[...t[56]||(t[56]=[e("i",{class:"fas fa-user-secret"},null,-1),u(" Test-/Pseudo-Patient ",-1)])]))])])]),e("div",gn,[e("div",hn,[t[58]||(t[58]=e("label",null,"Erstellt am:",-1)),e("span",null,l(i(s.patient.createdAt)),1)]),e("div",yn,[t[59]||(t[59]=e("label",null,"Zuletzt geÃ¤ndert:",-1)),e("span",null,l(i(s.patient.updatedAt)),1)])])])])])])])])),C.value?(n(),a("div",kn,[e("div",$n,[e("div",_n,[t[69]||(t[69]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-exclamation-triangle text-warning"}),u(" LÃ¶schvorgang prÃ¼fen ")])],-1)),e("div",Pn,[(B=f.value)!=null&&B.canDelete?(n(),a("div",Nn,[...t[61]||(t[61]=[e("i",{class:"fas fa-info-circle"},null,-1),e("strong",null,"Patient kann gelÃ¶scht werden.",-1),e("p",{class:"mb-0 mt-2"},"Sind Sie sicher, dass Sie diesen Patienten lÃ¶schen mÃ¶chten?",-1)])])):(n(),a("div",wn,[t[62]||(t[62]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[63]||(t[63]=e("strong",null,"Patient kann nicht gelÃ¶scht werden.",-1)),e("ul",Dn,[(n(!0),a(J,null,Y((A=(z=f.value)==null?void 0:z.warnings)==null?void 0:A.filter(M=>M),M=>(n(),a("li",{key:M},l(M),1))),128))])])),(H=f.value)!=null&&H.relatedObjects?(n(),a("div",xn,[t[68]||(t[68]=e("h6",null,"VerknÃ¼pfte Objekte:",-1)),e("div",En,[e("div",Cn,[t[64]||(t[64]=e("i",{class:"fas fa-stethoscope"},null,-1)),u(" "+l(f.value.relatedObjects.examinations)+" Untersuchung(en) ",1)]),e("div",Sn,[t[65]||(t[65]=e("i",{class:"fas fa-search"},null,-1)),u(" "+l(f.value.relatedObjects.findings)+" Befund(e) ",1)]),e("div",Rn,[t[66]||(t[66]=e("i",{class:"fas fa-video"},null,-1)),u(" "+l(f.value.relatedObjects.videos)+" Video(s) ",1)]),e("div",Un,[t[67]||(t[67]=e("i",{class:"fas fa-file-pdf"},null,-1)),u(" "+l(f.value.relatedObjects.reports)+" Bericht(e) ",1)])])])):p("",!0)]),e("div",An,[e("button",{type:"button",class:"btn btn-secondary",onClick:T,disabled:g.value}," Abbrechen ",8,Vn),(O=f.value)!=null&&O.canDelete?(n(),a("button",{key:0,type:"button",class:"btn btn-danger",onClick:y,disabled:g.value},[g.value?(n(),a("span",Fn)):(n(),a("i",jn)),u(" "+l(g.value?"Wird gelÃ¶scht...":"EndgÃ¼ltig lÃ¶schen"),1)],8,Tn)):p("",!0)])])])])):p("",!0)])])])])),(ne=f.value)!=null&&ne.relatedObjects?(n(),a("div",Hn,[t[76]||(t[76]=e("h6",null,"VerknÃ¼pfte Objekte:",-1)),e("div",Mn,[e("div",On,[t[72]||(t[72]=e("i",{class:"fas fa-stethoscope"},null,-1)),u(" "+l(f.value.relatedObjects.examinations)+" Untersuchung(en) ",1)]),e("div",Gn,[t[73]||(t[73]=e("i",{class:"fas fa-search"},null,-1)),u(" "+l(f.value.relatedObjects.findings)+" Befund(e) ",1)]),e("div",Ln,[t[74]||(t[74]=e("i",{class:"fas fa-video"},null,-1)),u(" "+l(f.value.relatedObjects.videos)+" Video(s) ",1)]),e("div",In,[t[75]||(t[75]=e("i",{class:"fas fa-file-pdf"},null,-1)),u(" "+l(f.value.relatedObjects.reports)+" Bericht(e) ",1)])])])):p("",!0)]),e("div",Bn,[e("button",{type:"button",class:"btn btn-secondary",onClick:T,disabled:g.value}," Abbrechen ",8,zn),(le=f.value)!=null&&le.canDelete?(n(),a("button",{key:0,type:"button",class:"btn btn-danger",onClick:y,disabled:g.value},[g.value?(n(),a("span",Zn)):(n(),a("i",qn)),u(" "+l(g.value?"Wird gelÃ¶scht...":"EndgÃ¼ltig lÃ¶schen"),1)],8,Kn)):p("",!0)])])])])):p("",!0)])}}}),Jn=X(Wn,[["__scopeId","data-v-753c8a26"]]),Yn={class:"patient-dashboard"},Qn={class:"dashboard-header"},Xn={class:"header-actions"},el=["disabled"],tl={key:0,class:"alert alert-danger alert-dismissible"},sl={key:1,class:"alert alert-success alert-dismissible"},al={key:2,class:"loading-container"},nl={key:3,class:"card form-card"},ll={class:"card-body"},il={key:4,class:"card patients-card"},ol={class:"card-header"},dl={class:"d-flex justify-content-between align-items-center"},rl={class:"card-title mb-0"},ul={class:"search-box"},cl={class:"card-body"},ml={key:0,class:"patients-grid"},vl=["onClick"],fl={class:"patient-card-header"},bl={class:"patient-name"},pl={class:"patient-id"},gl={class:"patient-card-body"},hl={class:"patient-info"},yl={class:"info-item"},kl={key:0},$l={key:0,class:"info-item"},_l={key:1,class:"info-item"},Pl={key:2,class:"info-item"},Nl={key:1,class:"empty-state"},wl={class:"text-muted"},Dl={key:5,class:"patient-detail-section"},xl=te({__name:"PatientDashboard",setup(s){const v=se(),b=E(!1),_=E(""),k=E(""),c=E(!1),m=E(null),w=E(""),P=V(()=>v.patients),C=V(()=>v.genders),g=V(()=>v.centers),f=V(()=>{if(!w.value)return P.value;const o=w.value.toLowerCase();return P.value.filter(d=>{var h,j,q;return((h=d.firstName)==null?void 0:h.toLowerCase().includes(o))||((j=d.lastName)==null?void 0:j.toLowerCase().includes(o))||((q=d.email)==null?void 0:q.toLowerCase().includes(o))||`${d.firstName} ${d.lastName}`.toLowerCase().includes(o)})}),x=async()=>{try{b.value=!0,_.value="",await Promise.all([I(),D()])}catch(o){_.value=o.message||"Fehler beim Laden der Daten",console.error("Error loading dashboard data:",o)}finally{b.value=!1}},I=async()=>{const o=await G.getPatients();v.patients=o},D=async()=>{try{if(C.value.length===0){const o=await G.getGenders();v.genders=o}if(g.value.length===0){const o=await G.getCenters();v.centers=o}}catch(o){console.error("Error loading lookup data:",o)}},r=o=>{m.value=o},y=o=>{c.value=!1,m.value=o,k.value=`Patient "${o.firstName} ${o.lastName}" wurde erfolgreich erstellt!`,setTimeout(()=>{k.value=""},5e3)},T=o=>{m.value=o;const d=v.patients.findIndex(h=>h.id===o.id);d!==-1&&(v.patients[d]=o),k.value=`Patient "${o.firstName} ${o.lastName}" wurde erfolgreich aktualisiert!`,setTimeout(()=>{k.value=""},5e3)},K=o=>{const d=v.patients.findIndex(h=>h.id===o);if(d!==-1){const h=v.patients[d];v.patients.splice(d,1),k.value=`Patient "${h.firstName} ${h.lastName}" wurde erfolgreich gelÃ¶scht!`}m.value=null,setTimeout(()=>{k.value=""},5e3)},Z=o=>{if(!o)return"Nicht angegeben";try{return new Date(o).toLocaleDateString("de-DE")}catch{return"UngÃ¼ltig"}},N=o=>{if(!o)return"Nicht angegeben";const d=C.value.find(h=>h.name===o);return(d==null?void 0:d.nameDe)||(d==null?void 0:d.name)||o},i=o=>{if(!o)return"Nicht zugeordnet";const d=g.value.find(h=>h.name===o);return(d==null?void 0:d.nameDe)||(d==null?void 0:d.name)||o};return ae(()=>{x()}),(o,d)=>(n(),a("div",Yn,[e("div",Qn,[d[8]||(d[8]=e("h1",{class:"dashboard-title"},[e("i",{class:"fas fa-users"}),u(" Patienten-Dashboard ")],-1)),e("div",Xn,[e("button",{class:"btn btn-primary",onClick:d[0]||(d[0]=h=>c.value=!0),disabled:b.value},[...d[7]||(d[7]=[e("i",{class:"fas fa-plus"},null,-1),u(" Neuer Patient ",-1)])],8,el)])]),_.value?(n(),a("div",tl,[d[9]||(d[9]=e("strong",null,"Fehler:",-1)),u(" "+l(_.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:d[1]||(d[1]=h=>_.value="")})])):p("",!0),k.value?(n(),a("div",sl,[d[10]||(d[10]=e("strong",null,"Erfolg:",-1)),u(" "+l(k.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:d[2]||(d[2]=h=>k.value="")})])):p("",!0),b.value?(n(),a("div",al,[...d[11]||(d[11]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Laden...")],-1),e("p",null,"Lade Patientendaten...",-1)])])):p("",!0),c.value&&!b.value?(n(),a("div",nl,[d[12]||(d[12]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},[e("i",{class:"fas fa-user-plus"}),u(" Neuen Patienten erstellen ")])],-1)),e("div",ll,[Q(Xe,{onPatientCreated:y,onCancel:d[3]||(d[3]=h=>c.value=!1)})])])):p("",!0),!b.value&&!c.value?(n(),a("div",il,[e("div",ol,[e("div",dl,[e("h3",rl,[d[13]||(d[13]=e("i",{class:"fas fa-list"},null,-1)),u(" Patienten ("+l(P.value.length)+") ",1)]),e("div",ul,[S(e("input",{"onUpdate:modelValue":d[4]||(d[4]=h=>w.value=h),type:"text",class:"form-control",placeholder:"Patienten suchen..."},null,512),[[F,w.value]])])])]),e("div",cl,[f.value.length>0?(n(),a("div",ml,[(n(!0),a(J,null,Y(f.value,h=>{var j;return n(),a("div",{key:h.id,class:U(["patient-card",{selected:((j=m.value)==null?void 0:j.id)===h.id}]),onClick:q=>r(h)},[e("div",fl,[e("h5",bl,l(h.firstName)+" "+l(h.lastName),1),e("span",pl,"ID: "+l(h.id),1)]),e("div",gl,[e("div",hl,[e("div",yl,[d[14]||(d[14]=e("i",{class:"fas fa-birthday-cake"},null,-1)),e("span",null,l(Z(h.dob)),1),h.age?(n(),a("small",kl,"("+l(h.age)+" Jahre)",1)):p("",!0)]),h.gender?(n(),a("div",$l,[d[15]||(d[15]=e("i",{class:"fas fa-venus-mars"},null,-1)),e("span",null,l(N(h.gender)),1)])):p("",!0),h.center?(n(),a("div",_l,[d[16]||(d[16]=e("i",{class:"fas fa-hospital"},null,-1)),e("span",null,l(i(h.center)),1)])):p("",!0),h.email?(n(),a("div",Pl,[d[17]||(d[17]=e("i",{class:"fas fa-envelope"},null,-1)),e("span",null,l(h.email),1)])):p("",!0)])]),d[18]||(d[18]=e("div",{class:"patient-card-footer"},[e("small",{class:"text-muted"}," Klicken fÃ¼r Details ")],-1))],10,vl)}),128))])):b.value?p("",!0):(n(),a("div",Nl,[d[20]||(d[20]=e("i",{class:"fas fa-users fa-3x text-muted"},null,-1)),d[21]||(d[21]=e("h4",null,"Keine Patienten gefunden",-1)),e("p",wl,l(w.value?"Keine Patienten entsprechen der Suche.":"Erstellen Sie den ersten Patienten."),1),w.value?p("",!0):(n(),a("button",{key:0,class:"btn btn-primary",onClick:d[5]||(d[5]=h=>c.value=!0)},[...d[19]||(d[19]=[e("i",{class:"fas fa-plus"},null,-1),u(" Ersten Patienten erstellen ",-1)])]))]))])])):p("",!0),m.value&&!c.value&&!b.value?(n(),a("div",Dl,[Q(Jn,{patient:m.value,onPatientUpdated:T,onPatientDeleted:K,onClose:d[6]||(d[6]=h=>m.value=null)},null,8,["patient"])])):p("",!0)]))}}),El=X(xl,[["__scopeId","data-v-8a212e39"]]),Cl={name:"Patients",components:{PatientDashboard:El}},Sl={class:"container-fluid h-100 w-100 py-1 px-4"},Rl={class:"row"};function Ul(s,v,b,_,k,c){const m=ue("PatientDashboard");return n(),a("div",Sl,[e("div",Rl,[Q(m)])])}const Tl=X(Cl,[["render",Ul]]);export{Tl as default};
