# TODOs for Setup

## Basic Setup

```markdown
Copy, paste and run these in a terminal in the root directory:
- [ ] direnv allow
- [ ] uv sync 
- [ ] direnv allow

- [ ] check for errors, possibly rerun


In .env
- [ ] Check if empty, else in terminal run "python env_setup.py"
- [ ] Set DJANGO_SETTINGS_MODULE_PRODUCTION
- [ ] Change Django DB password

```

# Django Module lx_annotate - Backend and Security Settings

Inside of lx_ annotate the django app runs the TypeScript as an entry to the JavaScript files.  and generated by the content inside of frontend.

```markdown
Copy, paste and run these in a terminal in the root directory:
- [ ] direnv allow
- [ ] uv sync 
- [ ] direnv allow

- [ ] check for errors, possibly rerun


In .env
- [ ] Check if empty, else in terminal run "python env_setup.py"
- [ ] [Change django settings using the terminal](## Changing of Django settings module)
- [ ] Change 
        - DB password
        - SECRET_KEY
        - SALT

```

## Changing of Django Settings Module

Lx-Annotate has a formidable settings module that will load production or development settings to run the app. The respective files to set up the settings can be found in lx_annotate/settings/ and are named respectively prod and dev. To change the django settings from development mode to production mode just run

export DJANGO_SETTINGS_MODULE=lx_annotate.settings.prod 
export DJANGO_SETTINGS_MODULE=lx_annotate.settings_dev

or if you are feeling like starting brand new

export DJANGO_SETTINGS_MODULE=lx_annotate.settings.base

## Vue.js Frontend Integration & Build Process

### Architecture Overview

LX-Annotate uses a sophisticated **Django + Vue.js** architecture where:

- **Django** serves as the backend API and static file server
- **Vue.js** provides the interactive frontend single-page application (SPA)
- **Vite** handles modern frontend tooling, development server, and production builds
- **django-vite** integration bridges Django templates with Vite-built assets

### Project Structure

```
lx-annotate/
├── frontend/                    # Vue.js application source
│   ├── src/
│   │   ├── main.ts             # Vue app entry point
│   │   ├── components/         # Reusable Vue components
│   │   ├── views/              # Page-level Vue components
│   │   ├── stores/             # Pinia state management
│   │   ├── api/                # API service layer
│   │   └── assets/             # CSS, images, fonts
│   ├── vite.config.ts          # Vite build configuration
│   └── package.json            # Node.js dependencies
├── static/dist/                # Built frontend assets (generated)
│   ├── main.js                 # Compiled Vue application
│   ├── main.css                # Compiled stylesheets
│   └── manifest.json           # Asset mapping for Django
├── lx_annotate/
│   ├── templates/base.html     # Django template loading Vue app
│   └── settings/               # Django configuration
└── manage.py                   # Django management
```

### Development vs Production Modes

#### Development Mode (NOT CURRENTLY USED)
```bash
# Frontend development server (if enabled)
cd frontend
npm run dev  # Starts Vite dev server on http://localhost:5173

# Django settings for dev mode
export DJANGO_SETTINGS_MODULE=lx_annotate.settings_dev
# In dev.py: DJANGO_VITE["default"]["dev_mode"] = True
```

#### Production Mode (CURRENT SETUP)
```bash
# Build frontend assets first
cd frontend
npm run build  # Generates static/dist/ files

# Django uses pre-built assets
export DJANGO_SETTINGS_MODULE=lx_annotate.settings.prod
# In settings: DJANGO_VITE["default"]["dev_mode"] = False
```

### Frontend Build Process

#### 1. Vue Component Compilation
Vue Single File Components (`.vue`) are processed by Vite:

```vue
<!-- Example: VideoExamination.vue -->
<template>
  <div class="video-player">
    <!-- Vue template syntax -->
  </div>
</template>

<script>
export default {
  // Vue component logic
}
</script>

<style scoped>
/* Component-specific CSS */
</style>
```

Gets compiled to:
- **JavaScript modules** with reactive functionality
- **CSS stylesheets** with scoped styling
- **Type definitions** (.d.ts files) for TypeScript support

#### 2. Vite Build Configuration

The `frontend/vite.config.ts` configures the build process:

```typescript
export default defineConfig({
  build: {
    manifest: 'manifest.json',           // Asset mapping for Django
    outDir: '../static/dist',            // Output to Django static files
    rollupOptions: {
      input: { main: 'src/main.ts' },    // Entry point
      output: {
        entryFileNames: '[name].js',     // main.js
        assetFileNames: '[name].[ext]',  // main.css
      },
    },
  },
  // ...proxy settings for API calls to Django
})
```

#### 3. Asset Generation

Running `npm run build` creates:

```
static/dist/
├── main.js          # Bundled Vue application (~175KB)
├── main.css         # Compiled CSS styles
├── manifest.json    # Asset mapping for django-vite
└── assets/          # Images, fonts, etc.
```

#### 4. Django Template Integration

The Django template `lx_annotate/templates/base.html` loads the Vue app:

```html
{% load django_vite %}
<!DOCTYPE html>
<html>
<head>
    <meta name="csrf-token" content="{{ csrf_token }}">
    {% vite_asset 'src/main.ts' %}  <!-- Loads main.js via manifest.json -->
</head>
<body>
    <div id="app"></div>  <!-- Vue app mounts here -->
</body>
</html>
```

### Vue Application Structure

#### 1. Entry Point (`src/main.ts`)
```typescript
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import router from './router'
import App from './App.vue'

const app = createApp(App)
app.use(createPinia())   // State management
app.use(router)          // Client-side routing
app.mount('#app')        // Mount to Django template
```

#### 2. Router Configuration
Vue Router handles client-side navigation:
```typescript
const routes = [
  { path: '/', component: Dashboard },
  { path: '/patients', component: PatientOverview },
  { path: '/video-annotation', component: VideoExamination },
  // ... other routes
]
```

#### 3. API Integration
API services communicate with Django backend:
```typescript
// src/api/patientService.ts
export const patientService = {
  async getPatients(): Promise<Patient[]> {
    const response = await axiosInstance.get('/api/patients/')
    return response.data
  }
}
```

#### 4. State Management (Pinia)
```typescript
// src/stores/videoStore.ts
export const useVideoStore = defineStore('videos', {
  state: () => ({
    videos: [],
    currentVideo: null
  }),
  actions: {
    async fetchVideos() {
      this.videos = await videoService.getVideos()
    }
  }
})
```

### API Endpoints & Data Flow

The frontend communicates with Django through RESTful APIs:

```
Frontend Request → Django API → Database → JSON Response → Vue State
```

Key API endpoints:
- `/api/patients/` - Patient management
- `/api/videos/` - Video metadata and streaming
- `/api/examinations/` - Medical examination data
- `/api/video-segments/` - Video annotation segments

### Development Workflow

#### Setting up for Development

1. **Install Frontend Dependencies**
```bash
cd frontend
npm install  # Install Vue.js, Vite, TypeScript, etc.
```

2. **Build Frontend Assets**
```bash
npm run build  # Compiles Vue to static/dist/
```

3. **Configure Django Settings**
```bash
export DJANGO_SETTINGS_MODULE=lx_annotate.settings_dev
# Ensure dev_mode = False to use built assets
```

4. **Start Django Server**
```bash
python manage.py runserver  # Serves both API and Vue app
```

#### Making Frontend Changes

1. **Edit Vue Components** in `frontend/src/`
2. **Rebuild Assets** with `npm run build`
3. **Refresh Browser** to see changes

#### For Hot Reloading (Advanced)
To enable live reloading during development:
1. Set `dev_mode = True` in Django settings
2. Run `npm run dev` for Vite dev server
3. Ensure proper CORS configuration

### Troubleshooting Common Issues

#### 1. Vue App Not Loading
- Check `static/dist/main.js` exists
- Verify `manifest.json` is present
- Ensure `DJANGO_VITE["default"]["dev_mode"] = False`

#### 2. API Calls Failing
- Check Django server is running on `http://127.0.0.1:8000`
- Verify CORS settings in Django
- Check CSRF token configuration

#### 3. Build Errors
- Run `npm run build` and check for compilation errors
- Verify TypeScript types are correct
- Check Vite configuration in `vite.config.ts`

### Production Deployment Checklist

- [ ] Run `npm run build` to generate optimized assets
- [ ] Set `DJANGO_SETTINGS_MODULE=lx_annotate.settings.prod`
- [ ] Ensure `dev_mode = False` in production settings
- [ ] Configure static file serving (WhiteNoise/Nginx)
- [ ] Set proper CORS and CSRF settings
- [ ] Update `ALLOWED_HOSTS` for production domain

### Vue Component Guidelines

#### Component Naming
- Use PascalCase for component files: `VideoExamination.vue`
- Use kebab-case in templates: `<video-examination>`

#### TypeScript Integration
- Use TypeScript for type safety
- Define interfaces for API data
- Leverage Vue 3 Composition API with `<script setup>`

#### Styling
- Use scoped CSS in components
- Follow Material Dashboard theme
- Utilize CSS custom properties for consistency

This architecture provides a robust, scalable foundation for the medical annotation application with clear separation between backend logic and frontend presentation.




