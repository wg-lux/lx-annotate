import{_ as We,s as J,z as Q,c as r,o as a,a as t,g as p,t as g,v as te,y as le,F as R,q as P,B as Ye,x as Je,i as M,d as Xe,l as He,m as C,w as ce,e as F,f as qe,K as xe,G as Qe,n as Re,h,j as D,A as Pe,H as et,L as Be,E as tt,b as nt,M as it,O as ot,k as st}from"./main.js";import{u as Oe,n as lt,f as E,g as Ae,a as at}from"./annotationStore.js";import{useAuthStore as rt}from"./authStore.js";import{u as dt}from"./mediaTypeStore.js";const ct={name:"SimpleExaminationForm",props:{videoTimestamp:{type:Number,default:0},videoId:{type:Number,required:!0}},emits:["examination-saved"],data(){return{loading:!1,error:null,examinations:[],findings:[],locationClassifications:[],locationChoices:[],morphologyClassifications:[],morphologyChoices:[],interventions:[],selectedExaminationId:null,selectedFindingId:null,selectedLocationClassificationId:null,selectedLocationChoiceId:null,selectedMorphologyClassificationId:null,selectedMorphologyChoiceId:null,selectedInterventions:[],notes:""}},computed:{selectedExamination(){return this.examinations.find(c=>c.id===this.selectedExaminationId)||null},selectedFinding(){return this.findings.find(c=>c.id===this.selectedFindingId)||null},selectedLocationClassification(){return this.locationClassifications.find(c=>c.id===this.selectedLocationClassificationId)||null},selectedLocationChoice(){return this.locationChoices.find(c=>c.id===this.selectedLocationChoiceId)||null},selectedMorphologyClassification(){return this.morphologyClassifications.find(c=>c.id===this.selectedMorphologyClassificationId)||null},selectedMorphologyChoice(){return this.morphologyChoices.find(c=>c.id===this.selectedMorphologyChoiceId)||null},canSave(){return this.selectedExaminationId&&this.selectedFindingId},hasSelections(){return this.selectedExaminationId||this.selectedFindingId||this.selectedLocationClassificationId||this.selectedMorphologyClassificationId||this.selectedInterventions.length>0}},methods:{async loadExaminations(){try{this.loading=!0,this.error=null;const c=await J.get(Q("examinations/"));this.examinations=c.data}catch(c){this.error="Fehler beim Laden der Untersuchungstypen: "+c.message,console.error("Error loading examinations:",c)}finally{this.loading=!1}},async onExaminationChange(){if(this.resetLowerLevels("examination"),!!this.selectedExaminationId)try{this.loading=!0,this.error=null;const[c,o]=await Promise.all([J.get(Q(`examination/${this.selectedExaminationId}/findings/`)),J.get(Q(`examination/${this.selectedExaminationId}/location-classifications/`))]);this.findings=c.data,this.locationClassifications=o.data;try{const _=await J.get(Q(`examination/${this.selectedExaminationId}/morphology-classifications/`));this.morphologyClassifications=_.data}catch(_){console.warn("Morphology classifications not available for this examination:",_),this.morphologyClassifications=[]}}catch(c){this.error="Fehler beim Laden der Findings: "+c.message,console.error("Error loading findings:",c)}finally{this.loading=!1}},async onFindingChange(){if(this.resetLowerLevels("finding"),!(!this.selectedFindingId||!this.selectedExaminationId))try{this.loading=!0,this.error=null;const c=await J.get(Q(`examination/${this.selectedExaminationId}/finding/${this.selectedFindingId}/interventions/`));this.interventions=c.data}catch(c){this.error="Fehler beim Laden der Interventionen: "+c.message,console.error("Error loading interventions:",c)}finally{this.loading=!1}},async onLocationClassificationChange(){if(this.resetLowerLevels("locationClassification"),!(!this.selectedLocationClassificationId||!this.selectedExaminationId))try{this.loading=!0,this.error=null;const c=await J.get(Q(`examination/${this.selectedExaminationId}/location-classification/${this.selectedLocationClassificationId}/choices/`));this.locationChoices=c.data}catch(c){this.error="Fehler beim Laden der Lokalisationen: "+c.message,console.error("Error loading location choices:",c)}finally{this.loading=!1}},async onMorphologyClassificationChange(){if(this.resetLowerLevels("morphologyClassification"),!(!this.selectedMorphologyClassificationId||!this.selectedExaminationId))try{this.loading=!0,this.error=null;const c=await J.get(Q(`examination/${this.selectedExaminationId}/morphology-classification/${this.selectedMorphologyClassificationId}/choices/`));this.morphologyChoices=c.data}catch(c){this.error="Fehler beim Laden der Morphologien: "+c.message,console.error("Error loading morphology choices:",c)}finally{this.loading=!1}},resetLowerLevels(c){switch(c){case"examination":this.selectedFindingId=null,this.findings=[],this.locationClassifications=[],this.morphologyClassifications=[];case"finding":this.selectedLocationClassificationId=null,this.selectedMorphologyClassificationId=null,this.locationChoices=[],this.morphologyChoices=[],this.interventions=[],this.selectedInterventions=[];case"locationClassification":this.selectedLocationChoiceId=null,this.locationChoices=[];break;case"morphologyClassification":this.selectedMorphologyChoiceId=null,this.morphologyChoices=[];break}},async saveExamination(){if(this.canSave)try{this.loading=!0,this.error=null;const c={videoId:this.videoId,timestamp:this.videoTimestamp,examinationTypeId:this.selectedExaminationId,findingId:this.selectedFindingId,locationClassificationId:this.selectedLocationClassificationId||null,locationChoiceId:this.selectedLocationChoiceId||null,morphologyClassificationId:this.selectedMorphologyClassificationId||null,morphologyChoiceId:this.selectedMorphologyChoiceId||null,interventionIds:this.selectedInterventions,notes:this.notes||null},o=await J.post(Q("examinations/"),c);this.$emit("examination-saved",o.data),this.resetForm()}catch(c){this.error="Fehler beim Speichern: "+c.message,console.error("Error saving examination:",c)}finally{this.loading=!1}},resetForm(){this.selectedExaminationId=null,this.selectedFindingId=null,this.selectedLocationClassificationId=null,this.selectedLocationChoiceId=null,this.selectedMorphologyClassificationId=null,this.selectedMorphologyChoiceId=null,this.selectedInterventions=[],this.notes="",this.findings=[],this.locationClassifications=[],this.locationChoices=[],this.morphologyClassifications=[],this.morphologyChoices=[],this.interventions=[]}},mounted(){this.loadExaminations()}},ut={class:"examination-form"},mt={key:0,class:"alert alert-info"},vt={key:1,class:"alert alert-danger"},gt={class:"mb-3"},ft=["disabled"],ht=["value"],pt={key:2,class:"mb-3"},yt=["disabled"],bt=["value"],Ct={key:3,class:"mb-3"},kt=["disabled"],xt=["value"],St={key:4,class:"mb-3"},wt=["disabled"],Lt=["value"],It={key:5,class:"mb-3"},Et=["disabled"],Mt=["value"],_t={key:6,class:"mb-3"},Tt=["disabled"],Vt=["value"],Ft={key:7,class:"mb-3"},$t={key:0,class:"form-check-group"},zt=["id","value"],Ut=["for"],Nt={key:1,class:"text-muted"},Dt={class:"mb-3"},Rt={class:"d-grid"},Pt=["disabled"],Bt={key:8,class:"mt-3 p-3 bg-light rounded"},At={class:"list-unstyled mb-0"},Wt={key:0},jt={key:1},Xt={key:2},Ht={key:3},qt={key:4},Ot={key:5},Kt={key:6};function Gt(c,o,_,ue,s,f){return a(),r("div",ut,[o[35]||(o[35]=t("h6",{class:"mb-3"},"Untersuchungsformular",-1)),s.loading?(a(),r("div",mt,"Lade Daten...")):p("",!0),s.error?(a(),r("div",vt,g(s.error),1)):p("",!0),t("div",gt,[o[14]||(o[14]=t("label",{class:"form-label"},"Untersuchungstyp:",-1)),te(t("select",{"onUpdate:modelValue":o[0]||(o[0]=d=>s.selectedExaminationId=d),onChange:o[1]||(o[1]=(...d)=>f.onExaminationChange&&f.onExaminationChange(...d)),class:"form-select",disabled:s.loading},[o[13]||(o[13]=t("option",{value:null},"Bitte Untersuchungstyp wählen...",-1)),(a(!0),r(R,null,P(s.examinations,d=>(a(),r("option",{key:d.id,value:d.id},g(d.name),9,ht))),128))],40,ft),[[le,s.selectedExaminationId,void 0,{number:!0}]])]),s.selectedExaminationId?(a(),r("div",pt,[o[16]||(o[16]=t("label",{class:"form-label"},"Finding:",-1)),te(t("select",{"onUpdate:modelValue":o[2]||(o[2]=d=>s.selectedFindingId=d),onChange:o[3]||(o[3]=(...d)=>f.onFindingChange&&f.onFindingChange(...d)),class:"form-select",disabled:s.loading||!s.findings.length},[o[15]||(o[15]=t("option",{value:null},"Bitte Finding wählen...",-1)),(a(!0),r(R,null,P(s.findings,d=>(a(),r("option",{key:d.id,value:d.id},g(d.name),9,bt))),128))],40,yt),[[le,s.selectedFindingId,void 0,{number:!0}]])])):p("",!0),s.selectedFindingId?(a(),r("div",Ct,[o[18]||(o[18]=t("label",{class:"form-label"},"Lokalisationsklassifikation:",-1)),te(t("select",{"onUpdate:modelValue":o[4]||(o[4]=d=>s.selectedLocationClassificationId=d),onChange:o[5]||(o[5]=(...d)=>f.onLocationClassificationChange&&f.onLocationClassificationChange(...d)),class:"form-select",disabled:s.loading||!s.locationClassifications.length},[o[17]||(o[17]=t("option",{value:null},"Bitte Lokalisationsklassifikation wählen...",-1)),(a(!0),r(R,null,P(s.locationClassifications,d=>(a(),r("option",{key:d.id,value:d.id},g(d.name),9,xt))),128))],40,kt),[[le,s.selectedLocationClassificationId,void 0,{number:!0}]])])):p("",!0),s.selectedLocationClassificationId?(a(),r("div",St,[o[20]||(o[20]=t("label",{class:"form-label"},"Lokalisation:",-1)),te(t("select",{"onUpdate:modelValue":o[6]||(o[6]=d=>s.selectedLocationChoiceId=d),class:"form-select",disabled:s.loading||!s.locationChoices.length},[o[19]||(o[19]=t("option",{value:null},"Bitte Lokalisation wählen...",-1)),(a(!0),r(R,null,P(s.locationChoices,d=>(a(),r("option",{key:d.id,value:d.id},g(d.name),9,Lt))),128))],8,wt),[[le,s.selectedLocationChoiceId,void 0,{number:!0}]])])):p("",!0),s.selectedFindingId?(a(),r("div",It,[o[22]||(o[22]=t("label",{class:"form-label"},"Morphologieklassifikation:",-1)),te(t("select",{"onUpdate:modelValue":o[7]||(o[7]=d=>s.selectedMorphologyClassificationId=d),onChange:o[8]||(o[8]=(...d)=>f.onMorphologyClassificationChange&&f.onMorphologyClassificationChange(...d)),class:"form-select",disabled:s.loading||!s.morphologyClassifications.length},[o[21]||(o[21]=t("option",{value:null},"Bitte Morphologieklassifikation wählen...",-1)),(a(!0),r(R,null,P(s.morphologyClassifications,d=>(a(),r("option",{key:d.id,value:d.id},g(d.name),9,Mt))),128))],40,Et),[[le,s.selectedMorphologyClassificationId,void 0,{number:!0}]])])):p("",!0),s.selectedMorphologyClassificationId?(a(),r("div",_t,[o[24]||(o[24]=t("label",{class:"form-label"},"Morphologie:",-1)),te(t("select",{"onUpdate:modelValue":o[9]||(o[9]=d=>s.selectedMorphologyChoiceId=d),class:"form-select",disabled:s.loading||!s.morphologyChoices.length},[o[23]||(o[23]=t("option",{value:null},"Bitte Morphologie wählen...",-1)),(a(!0),r(R,null,P(s.morphologyChoices,d=>(a(),r("option",{key:d.id,value:d.id},g(d.name),9,Vt))),128))],8,Tt),[[le,s.selectedMorphologyChoiceId,void 0,{number:!0}]])])):p("",!0),s.selectedFindingId?(a(),r("div",Ft,[o[25]||(o[25]=t("label",{class:"form-label"},"Interventionen:",-1)),s.interventions.length>0?(a(),r("div",$t,[(a(!0),r(R,null,P(s.interventions,d=>(a(),r("div",{key:d.id,class:"form-check"},[te(t("input",{type:"checkbox",id:`intervention-${d.id}`,"onUpdate:modelValue":o[10]||(o[10]=ee=>s.selectedInterventions=ee),value:d.id,class:"form-check-input"},null,8,zt),[[Ye,s.selectedInterventions]]),t("label",{for:`intervention-${d.id}`,class:"form-check-label"},g(d.name),9,Ut)]))),128))])):(a(),r("small",Nt,"Keine Interventionen für dieses Finding verfügbar."))])):p("",!0),t("div",Dt,[o[26]||(o[26]=t("label",{class:"form-label"},"Notizen:",-1)),te(t("textarea",{"onUpdate:modelValue":o[11]||(o[11]=d=>s.notes=d),class:"form-control",rows:"3",placeholder:"Zusätzliche Bemerkungen..."},null,512),[[Je,s.notes]])]),t("div",Rt,[t("button",{onClick:o[12]||(o[12]=(...d)=>f.saveExamination&&f.saveExamination(...d)),disabled:!f.canSave||s.loading,class:"btn btn-primary"},g(s.loading?"Speichere...":"Untersuchung speichern"),9,Pt)]),f.hasSelections?(a(),r("div",Bt,[o[34]||(o[34]=t("h6",null,"Aktuelle Auswahl:",-1)),t("ul",At,[f.selectedExamination?(a(),r("li",Wt,[o[27]||(o[27]=t("strong",null,"Untersuchung:",-1)),M(" "+g(f.selectedExamination.name),1)])):p("",!0),f.selectedFinding?(a(),r("li",jt,[o[28]||(o[28]=t("strong",null,"Finding:",-1)),M(" "+g(f.selectedFinding.name),1)])):p("",!0),f.selectedLocationClassification?(a(),r("li",Xt,[o[29]||(o[29]=t("strong",null,"Lokalisationsklassifikation:",-1)),M(" "+g(f.selectedLocationClassification.name),1)])):p("",!0),f.selectedLocationChoice?(a(),r("li",Ht,[o[30]||(o[30]=t("strong",null,"Lokalisation:",-1)),M(" "+g(f.selectedLocationChoice.name),1)])):p("",!0),f.selectedMorphologyClassification?(a(),r("li",qt,[o[31]||(o[31]=t("strong",null,"Morphologieklassifikation:",-1)),M(" "+g(f.selectedMorphologyClassification.name),1)])):p("",!0),f.selectedMorphologyChoice?(a(),r("li",Ot,[o[32]||(o[32]=t("strong",null,"Morphologie:",-1)),M(" "+g(f.selectedMorphologyChoice.name),1)])):p("",!0),s.selectedInterventions.length>0?(a(),r("li",Kt,[o[33]||(o[33]=t("strong",null,"Interventionen:",-1)),M(" "+g(s.interventions.filter(d=>s.selectedInterventions.includes(d.id)).map(d=>d.name).join(", ")),1)])):p("",!0)])])):p("",!0)])}const Zt=We(ct,[["render",Gt],["__scopeId","data-v-f6468eae"]]);function je(c){if(!Number.isFinite(c)||c<0)return"00:00";const o=Math.floor(c/60),_=Math.floor(c%60);return`${o.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`}function Yt(c,o,_){return!Number.isFinite(c)||!Number.isFinite(o)||!Number.isFinite(_)||_<=0||o<=c?0:(o-c)/_*100}function Jt(c,o){return!Number.isFinite(c)||!Number.isFinite(o)||o<=0?0:c/o*100}function Qt(){for(var c="0123456789ABCDEF",o="#",_=0;_<6;_++)o+=c[Math.floor(Math.random()*16)];return o}const en={class:"timeline-container"},tn={class:"timeline-header"},nn={class:"timeline-controls"},on=["disabled"],sn={class:"time-display"},ln={class:"zoom-controls"},an=["disabled"],rn={class:"zoom-level"},dn=["disabled"],cn={class:"time-markers"},un={class:"marker-text"},mn={class:"segments-container"},vn=["data-id","onClick","onContextmenu"],gn={class:"segment-content"},fn={class:"segment-label"},hn={class:"segment-duration"},pn=["onClick"],yn={key:0,class:"draft-indicator"},bn={key:0,class:"waveform-container"},Cn=Xe({__name:"Timeline",props:{video:{},segments:{},labels:{},currentTime:{},isPlaying:{type:Boolean},activeSegmentId:{},showWaveform:{type:Boolean},selectionMode:{type:Boolean},fps:{}},emits:["seek","play-pause","segment-select","segment-edit","segment-delete","segment-create","segment-resize","segment-move","time-selection"],setup(c,{emit:o}){const _=He(),ue=Oe();ue.segmentsByLabel;const s=c,f=o,d=C(null),ee=C(null),Fe=C([]),N=C([]),$=C(1),ae=C(!1),ne=C(0),ie=C(0),me=C([]);ce(()=>s.segments,n=>{(n||[]).forEach(i=>{me.value.includes(i.label)||me.value.push(i.label)})},{immediate:!0});const y=C(null),B=C(null),k=C({visible:!1,x:0,y:0,segment:null}),ve=C({visible:!1,x:0,y:0,text:""}),T=F(()=>s.video?.duration||0),oe=F(()=>{const n=T.value,i=s.currentTime||0;if(!n||n===0||!Number.isFinite(n))return console.warn("[Timeline] Duration is 0 or invalid:",n),0;if(!Number.isFinite(i)||i<0)return console.warn("[Timeline] CurrentTime is invalid:",i),0;const u=i/n*100;return Number.isFinite(u)?Math.max(0,Math.min(100,u)):(console.warn("[Timeline] Calculated percentage is NaN:",{currentVideoTime:i,videoDuration:n}),0)}),re=F(()=>{const n=[],i=T.value;if(i===0)return n;const v=10/$.value,b=Math.floor(i/v);for(let x=0;x<=b;x++){const S=x*v;S<=i&&n.push({time:S,position:S/i*100})}return n});F(()=>s.fps||50);const A=n=>{const i=lt(n),u=q(n.label);return{...i,start:i.startTime,end:i.endTime,isDraft:typeof n.id=="string"&&(n.id==="draft"||n.id.startsWith("temp-")),color:u||Qt()||void 0,avgConfidence:n.avgConfidence??0,label:n.label??n.label_name}},z=C(null),$e=n=>{z.value=n.label,f("segment-select",n)},ze=n=>ue.getTranslationForLabel(n),q=n=>ue.getColorForLabel(n),W=C([]);ce(()=>s.segments,n=>{n?W.value=n?.map(A):W.value=[]},{immediate:!0});const O=F(()=>{const n={};for(const v of W.value)(n[v.label]||=[]).push(v);const i=z.value?[z.value,...me.value.filter(v=>v!==z.value)]:[...me.value],u=[];return i.forEach(v=>{if(!n[v])return;const b=n[v].sort((L,X)=>L.start-X.start);let x=0,S={key:`${v}-0`,label:v,rowNumber:u.length,segments:[],maxEndTime:0};for(const L of b)L.start<S.maxEndTime-1e-4&&(u.push(S),x+=1,S={key:`${v}-${x}`,label:v,rowNumber:u.length,segments:[],maxEndTime:0}),S.segments.push(L),S.maxEndTime=Math.max(S.maxEndTime,L.end);u.push(S)}),u}),K=F(()=>60+O.value.length*45+10),I=n=>typeof n!="number"||isNaN(n)?"00:00":je(n),he=(n,i)=>{const u=i-n;return je(u)},Se=n=>Jt(n,T.value),we=(n,i)=>Yt(n,i,T.value);function Ue(n,i){let u=null,v=0,b=0,x=0,S=0,L=0;const X=U=>U/i.trackPx()*i.duration();function Te(U){U.stopPropagation();const Y=U.target.closest(".resize-handle");Y?.classList.contains("start-handle")?u="start":Y?.classList.contains("end-handle")?u="end":u="drag",v=U.clientX,b=n.offsetLeft,x=n.offsetWidth,n.setPointerCapture(U.pointerId),U.preventDefault()}function ke(U){if(!u)return;const Y=U.clientX-v;if(u==="drag"){let V=Math.min(Math.max(0,b+Y),i.trackPx()-x);n.style.left=V+"px",S=V,L=V+x}if(u==="start"){let V=Math.min(b+Y,b+x-10),Ve=x+(b-V);n.style.left=V+"px",n.style.width=Ve+"px",S=V,L=V+Ve}if(u==="end"){let V=Math.max(10,x+Y);n.style.width=V+"px",n.style.left=b+"px",S=b,L=b+V}}function ge(U){if(!u)return;ke(U);let Y=S,V=L;u==="drag"?i.onMove(X(Y),X(V)):i.onResize(X(Y),X(V),u),u=null,n.releasePointerCapture(U.pointerId),i.onDone()}return n.addEventListener("pointerdown",Te),n.addEventListener("pointermove",ke),n.addEventListener("pointerup",ge),n.addEventListener("pointercancel",ge),()=>{n.removeEventListener("pointerdown",Te),n.removeEventListener("pointermove",ke),n.removeEventListener("pointerup",ge),n.removeEventListener("pointercancel",ge)}}const G=()=>{N.value.forEach(n=>n()),N.value=[],d.value&&xe(()=>{O.value.forEach(n=>{n.segments.forEach(i=>{const u=document.querySelector(`[data-id="${i.id}"]`);if(!u)return;const v=Ue(u,{trackPx:()=>d.value.offsetWidth,duration:()=>T.value,onMove:(b,x)=>{const S=W.value.find(L=>L.id===i.id);S&&(S.start=b,S.end=x,S.startTime=b,S.endTime=x),f("segment-move",i.id,b,x)},onResize:(b,x,S)=>{const L=W.value.find(X=>X.id===i.id);L&&(L.start=b,L.end=x,L.startTime=b,L.endTime=x),f("segment-resize",i.id,b,x,S)},onDone:()=>{const b=W.value.find(x=>x.id===i.id);if(b)if(typeof i.id=="string"&&(i.id==="draft"||i.id.startsWith("temp-")))f("segment-resize",i.id,b.start,b.end,"end",!0);else{const x=De(i.id);x!==null&&f("segment-resize",x,b.start,b.end,"end",!0)}}});N.value.push(v)})})})},de=()=>{$.value<5&&($.value=Math.min(5,$.value+.5))},Le=()=>{$.value>1&&($.value=Math.max(1,$.value-.5))},Ne=()=>{f("play-pause")},Ie=n=>{n&&(Z(),f("segment-edit",n))},j=n=>{n&&(Z(),f("segment-delete",n))},pe=n=>{n&&(Z(),f("seek",n.startTime||0),f("play-pause"))},ye=(n,i)=>{k.value={visible:!0,x:i.clientX,y:i.clientY,segment:n}},Z=()=>{k.value.visible=!1},Ee=n=>{if(B.value||y.value)return;const i=d.value.getBoundingClientRect(),u=n.clientX-i.left,v=u/i.width*T.value;s.selectionMode?(ae.value=!0,ne.value=u/i.width*100,ie.value=ne.value,document.addEventListener("mousemove",be),document.addEventListener("mouseup",Ce)):f("seek",v)},be=n=>{if(!ae.value||!d.value)return;const i=d.value.getBoundingClientRect(),u=n.clientX-i.left;ie.value=Math.max(0,Math.min(100,u/i.width*100))},Ce=n=>{if(!ae.value)return;d.value.getBoundingClientRect();const i=Math.min(ne.value,ie.value),u=Math.max(ne.value,ie.value),v=i/100*T.value,b=u/100*T.value;b-v>.1&&f("time-selection",{start:v,end:b}),ae.value=!1,ne.value=0,ie.value=0,document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",Ce)};ce(()=>s.video,()=>{s.showWaveform&&xe(()=>{Me()})}),ce(O,()=>xe(G),{immediate:!0}),ce(O,n=>{n.forEach(i=>{i.segments.forEach(u=>{we(u.start,u.end)===0&&console.warn("[Timeline] Segment mit 0% Breite:",u)})})},{immediate:!0});const Me=()=>{if(!ee.value||!s.video)return;const n=ee.value,i=n.getContext("2d");if(i){n.width=n.offsetWidth,n.height=n.offsetHeight,i.fillStyle="#e0e0e0",i.fillRect(0,0,n.width,n.height),i.strokeStyle="#2196F3",i.lineWidth=1,i.beginPath();for(let u=0;u<n.width;u+=2){const v=Math.random()*n.height*.8+n.height*.1;u===0?i.moveTo(u,v):i.lineTo(u,v)}i.stroke()}},_e=n=>{k.value.visible&&!n.target?.closest(".context-menu")&&Z()};qe(()=>{document.addEventListener("click",_e),xe(()=>{G()}),s.showWaveform&&xe(()=>{Me()}),_.success({text:"[Timeline] Component mounted and ready"})}),Qe(()=>{document.removeEventListener("click",_e),N.value.forEach(n=>n()),N.value=[],document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",Ce)});const De=n=>{if(typeof n=="number")return n;if(typeof n=="string"){if(n==="draft"||n.startsWith("temp-"))return console.warn("[Timeline] Ignoring draft/temp segment:",n),null;const i=parseInt(n,10);return isNaN(i)?(console.error("[Timeline] Invalid segment ID:",n),null):i}return console.error("[Timeline] Unexpected segment ID type:",typeof n,n),null};return(n,i)=>(a(),r("div",en,[t("div",tn,[t("div",nn,[t("button",{onClick:Ne,class:"play-btn",disabled:!n.video},[t("i",{class:Re(n.isPlaying?"fas fa-pause":"fas fa-play")},null,2)],8,on),t("span",sn,g(I(n.currentTime))+" / "+g(I(T.value)),1)]),t("div",ln,[t("button",{onClick:Le,disabled:h($)<=1},[...i[4]||(i[4]=[t("i",{class:"fas fa-search-minus"},null,-1)])],8,an),t("span",rn,g(Math.round(h($)*100))+"%",1),t("button",{onClick:de,disabled:h($)>=5},[...i[5]||(i[5]=[t("i",{class:"fas fa-search-plus"},null,-1)])],8,dn)])]),t("div",{class:"timeline-wrapper",style:D({height:K.value+"px"})},[t("div",{class:"timeline",ref_key:"timeline",ref:d,onMousedown:Ee,style:D({height:K.value+"px"})},[t("div",cn,[(a(!0),r(R,null,P(re.value,u=>(a(),r("div",{key:u.time,class:"time-marker",style:D({left:u.position+"%"})},[t("div",{class:"marker-line",style:D({height:K.value+"px"})},null,4),t("div",un,g(I(u.time)),1)],4))),128))]),t("div",mn,[(a(!0),r(R,null,P(O.value,u=>(a(),r("div",{key:u.key,class:Re(["segment-row",{active:u.label===h(z)}]),style:D({top:u.rowNumber*45+"px",height:"40px"})},[(a(!0),r(R,null,P(u.segments,v=>(a(),r("div",{key:v.id,ref_for:!0,ref_key:"segmentElements",ref:Fe,class:Re(["segment",{active:v.id===n.activeSegmentId,draft:v.isDraft}]),style:D({left:Se(v.start)+"%",width:we(v.start,v.end)+"%",backgroundColor:v.color||q(v.label),borderColor:v.isDraft?"#ff9800":"transparent"}),"data-id":v.id,onClick:b=>$e(v),onContextmenu:Pe(b=>ye(v,b),["prevent"])},[i[7]||(i[7]=t("div",{class:"resize-handle start-handle",title:"Segment-Start ändern"},[t("i",{class:"fas fa-grip-lines-vertical"})],-1)),t("div",gn,[t("span",fn,g(ze(v.label)),1),t("span",hn,g(he(v.start,v.end)),1)]),t("div",{class:"segment-delete-btn",onClick:Pe(b=>j(v),["stop"]),title:"Segment löschen"},"X",8,pn),i[8]||(i[8]=t("div",{class:"resize-handle end-handle",title:"Segment-Ende ändern"},[t("i",{class:"fas fa-grip-lines-vertical"})],-1)),v.isDraft?(a(),r("div",yn,[...i[6]||(i[6]=[t("i",{class:"fas fa-edit"},null,-1)])])):p("",!0)],46,vn))),128))],6))),128))]),t("div",{class:"playhead",style:D({left:oe.value+"%",height:K.value+"px"})},[t("div",{class:"playhead-line",style:D({height:K.value+"px"})},null,4),i[9]||(i[9]=t("div",{class:"playhead-handle"},null,-1))],4),h(ae)?(a(),r("div",{key:0,class:"selection-overlay",style:D({left:Math.min(h(ne),h(ie))+"%",width:Math.abs(h(ie)-h(ne))+"%",height:K.value+"px"})},null,4)):p("",!0)],36),n.showWaveform?(a(),r("div",bn,[t("canvas",{ref_key:"waveformCanvas",ref:ee,class:"waveform-canvas"},null,512)])):p("",!0)],4),h(k).visible?(a(),r("div",{key:0,class:"context-menu",style:D({left:h(k).x+"px",top:h(k).y+"px"}),onClick:i[3]||(i[3]=Pe(()=>{},["stop"]))},[t("div",{class:"context-menu-item",onClick:i[0]||(i[0]=u=>Ie(h(k).segment))},[...i[10]||(i[10]=[t("i",{class:"fas fa-edit"},null,-1),M(" Segment bearbeiten ",-1)])]),t("div",{class:"context-menu-item danger",onClick:i[1]||(i[1]=u=>j(h(k).segment))},[...i[11]||(i[11]=[t("i",{class:"fas fa-trash"},null,-1),M(" Segment löschen ",-1)])]),i[13]||(i[13]=t("div",{class:"context-menu-separator"},null,-1)),t("div",{class:"context-menu-item",onClick:i[2]||(i[2]=u=>pe(h(k).segment))},[...i[12]||(i[12]=[t("i",{class:"fas fa-play"},null,-1),M(" Segment abspielen ",-1)])])],4)):p("",!0),h(ve).visible?(a(),r("div",{key:1,class:"timeline-tooltip",style:D({left:h(ve).x+"px",top:h(ve).y+"px"})},g(h(ve).text),5)):p("",!0)]))}}),kn=We(Cn,[["__scopeId","data-v-b2283c3f"]]),xn={class:"container-fluid py-4"},Sn={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},wn={key:1,class:"alert alert-success alert-dismissible fade show",role:"alert"},Ln={class:"row"},In={class:"col-lg-8"},En={class:"card"},Mn={class:"card-body"},_n={class:"mb-3"},Tn=["disabled"],Vn={value:null},Fn=["value"],$n={key:0,class:"text-muted"},zn={key:0,class:"text-center text-muted py-5"},Un={key:0,class:"alert alert-info mt-2"},Nn={key:1,class:"text-center text-muted py-5"},Dn={class:"mt-2"},Rn={key:2,class:"video-container"},Pn=["src"],Bn={key:3,class:"timeline-wrapper mt-3"},An=["title"],Wn={key:4,class:"debug-info mt-2"},jn={class:"text-muted"},Xn={key:5,class:"timeline-controls mt-4"},Hn={class:"d-flex align-items-center gap-3"},qn={class:"d-flex align-items-center"},On={class:"d-flex align-items-center gap-2"},Kn=["disabled"],Gn={class:"ms-3 text-muted"},Zn={key:0,class:"alert alert-info mt-2 mb-0"},Yn={key:0},Jn={key:1},Qn={class:"col-lg-4"},ei={class:"card"},ti={class:"card-header pb-0"},ni={key:0,class:"text-muted"},ii={class:"card-body"},oi={key:1,class:"text-center text-muted py-5"},si={key:0,class:"card mt-3"},li={class:"card-body","data-cy":"saved-examinations"},ai={class:"list-group list-group-flush"},ri={class:"text-muted"},di=["onClick"],ci=["onClick"],ui=Xe({__name:"VideoExaminationAnnotation",setup(c){const o=et(),_=st(),ue=Number(o.query.video??"")||null,s=Oe(),f=dt(),{videoList:d,videoStreamUrl:ee,timelineSegments:Fe}=Be(s),N=F(()=>d.value.videos);He();const{allSegments:$}=Be(s),ae=tt(),{overview:ne}=Be(ae),ie=F(()=>[...s.labels||[]]);function me(l){return ne.value.find(m=>m.id===l&&m.mediaType==="video")?.anonymizationStatus==="done"}const y=C(ue),B=C(0),k=C(0),ve=C(50),T=C([]),oe=C([]),re=C(null),A=C(""),z=C(!1),$e=C(0),ze=C(null),q=C(null),W=C(null),O=C(""),K=C(""),I=C(null),he=C(null);async function Se(){if(y.value==null){s.clearVideo(),q.value=null,W.value=null;return}pe(),ye();try{await s.loadVideo(String(y.value)),await be(y.value),await j(Ce()),await j(Me()),await j(s.fetchAllSegments(y.value.toString())),console.log("Video fully loaded:",y.value)}catch(l){console.error("loadSelectedVideo failed",l),await j(Promise.reject(l))}}function we(){Se(),_.replace({query:{video:y.value}})}ce(y,Se),ce(()=>o.query.video,l=>{const e=Number(l??"")||null;e!==y.value&&(y.value=e)},{immediate:!0}),F(()=>d.value.videos.filter(l=>me(l.id)));const Ue=F(()=>y.value!==null&&G.value!==void 0),G=F(()=>{if(!y.value)return;const l=N.value.find(e=>e.id===y.value);if(l){f.setCurrentItem(l);const e=f.getVideoUrl(l);if(e)return console.log("🎬 Using MediaStore video URL:",e),e}if(q.value?.video_url)return console.log("🎬 Using videoDetail URL:",q.value.video_url),q.value.video_url;if(ee.value)return console.log("🎬 Using legacy store URL:",ee.value),ee.value}),de=F(()=>N.value&&N.value.length>0),Le=F(()=>N.value.length===0?"Keine Videos verfügbar. Bitte laden Sie zuerst Videos hoch.":"");F(()=>$.value.map(l=>({...l})));const Ne=F(()=>s.segmentsByLabel),Ie=F(()=>y.value&&q.value?.video_url&&A.value&&!z.value&&k.value>0);qe(s.fetchAllVideos);async function j(l){try{return await l}catch(e){const m=e?.response?.data?.detail||e?.response?.data?.error||e?.message||String(e);O.value=m;return}}const pe=()=>{O.value=""},ye=()=>{K.value=""},Z=l=>{K.value=l,setTimeout(()=>{ye()},5e3)},Ee=l=>{O.value=l,setTimeout(()=>{pe()},1e4)},be=async l=>{if(l)try{console.log("Loading video detail for ID:",l);const e=await J.get(Q(`media/videos/${l}/`));console.log("Video detail response:",e.data),q.value={video_url:e.data.video_url},W.value={duration:Number(e.data.duration??0),fps:Number(e.data.fps??25)};const m=N.value.find(w=>w.id===l);m&&(f.setCurrentItem(m),console.log("MediaStore updated with video:",l),console.log("MediaStore video URL:",f.getVideoUrl(m))),W.value.duration>0&&(k.value=W.value.duration),console.log("Video detail loaded:",q.value),console.log("Video meta loaded:",W.value),console.log("Stream source will be:",G.value)}catch(e){console.error("Error loading video detail:",e),await j(Promise.reject(e))}},Ce=async()=>{if(y.value!==null)try{const l=await J.get(Q(`video/${y.value}/examinations/`));oe.value=l.data,T.value=l.data.map(e=>({id:`exam-${e.id}`,timestamp:e.timestamp,examination_data:e.data}))}catch(l){console.error("Error loading saved examinations:",l);const e=l?.response?.data?.error||l?.response?.data?.detail||l?.message||l.toString();e.includes("darf nicht annotiert werden")||e.includes("anonymisierung")||e.includes("anonymization")?Ee(`Video ${y.value} darf nicht annotiert werden, solange die Anonymisierung nicht abgeschlossen ist.`):l?.response?.status!==404&&await j(Promise.reject(l)),oe.value=[],T.value=[]}},Me=async()=>{I.value&&await new Promise(l=>{const e=I.value;e.readyState>=1?(k.value=e.duration,l()):e.addEventListener("loadedmetadata",()=>{k.value=e.duration,l()},{once:!0})})},_e=async()=>{if(y.value!==null)try{await s.fetchAllSegments(y.value.toString()),console.log("Video segments loaded for video:",y.value),console.log("Timeline segments count:",$.value.length)}catch(l){console.error("Error loading video segments:",l)}},De=()=>{I.value&&(k.value=I.value.duration,console.log("🎥 Video loaded - Frontend"),console.log(`- Video source URL: ${G.value}`),console.log(`- Legacy stream URL: ${ee.value}`),console.log(`- Video detail URL: ${q.value?.video_url}`),console.log(`- Video readyState: ${I.value.readyState}`),console.log(`- Video networkState: ${I.value.networkState}`),I.value.videoWidth&&I.value.videoHeight&&console.log(`- Video dimensions: ${I.value.videoWidth}x${I.value.videoHeight}`),k.value<10?console.warn(`⚠️ WARNING: Video duration seems very short (${k.value}s)`):Z(`Video geladen: ${Math.round(k.value)}s Dauer`))},n=()=>{I.value&&(B.value=I.value.currentTime)},i=l=>{if(!he.value||k.value===0)return;const e=he.value.getBoundingClientRect(),H=(l.clientX-e.left)/e.width*k.value;X(H)},u=(...l)=>{const[e]=l;X(e)},v=(...l)=>{const[e,m,w,H,se]=l;if(typeof e=="string"&&(e==="draft"||/^temp-/.test(e))){console.warn("[VideoExamination] Ignoring resize for draft/temp segment:",e);return}const fe=typeof e=="string"?parseInt(e,10):e;if(isNaN(fe)){console.warn("[VideoExamination] Invalid segment ID for resize:",e);return}se?(s.patchSegmentLocally(fe,{startTime:m,endTime:w}),s.updateSegment(fe,{startTime:m,endTime:w}),console.log(`✅ Segment ${fe} resized and saved: ${E(m)} - ${E(w)}`)):(s.patchSegmentLocally(fe,{startTime:m,endTime:w}),console.log(`Preview resize segment ${fe} ${H}: ${E(m)} - ${E(w)}`))},b=(...l)=>{const[e,m,w,H]=l;if(typeof e=="string"&&(e==="draft"||/^temp-/.test(e))){console.warn("[VideoExamination] Ignoring move for draft/temp segment:",e);return}const se=typeof e=="string"?parseInt(e,10):e;if(isNaN(se)){console.warn("[VideoExamination] Invalid segment ID for move:",e);return}H?(s.patchSegmentLocally(se,{startTime:m,endTime:w}),s.updateSegment(se,{startTime:m,endTime:w}),console.log(`✅ Segment ${se} moved and saved: ${E(m)} - ${E(w)}`)):(s.patchSegmentLocally(se,{startTime:m,endTime:w}),console.log(`Preview move segment ${se}: ${E(m)} - ${E(w)}`))},x=(...l)=>{const[e]=l;A.value&&y.value&&S({label:A.value,start:e.start,end:e.end})},S=(...l)=>{const[e]=l;return new Promise(async(m,w)=>{try{y.value&&(await s.createSegment?.(y.value.toString(),e.label,e.start,e.end),Z(`Segment erstellt: ${Ae(e.label)}`)),m()}catch(H){await j(Promise.reject(H)),w(H)}})},L=(...l)=>{const[e]=l;return new Promise(async(m,w)=>{if(!e.id||typeof e.id!="number"){console.warn("Cannot delete draft or temporary segment:",e.id),m();return}try{s.removeSegment(e.id),await s.deleteSegment(e.id),Z(`Segment gelöscht: ${Ae(e.label)}`),m()}catch(H){console.error("Segment konnte nicht gelöscht werden:",H),await j(Promise.reject(H)),w(H)}})},X=l=>{I.value&&l>=0&&l<=k.value&&(I.value.currentTime=l,B.value=l)},Te=()=>{console.log("Label selected:",A.value)},ke=()=>{Ie.value&&(z.value=!0,$e.value=B.value,s.startDraft(A.value,B.value),console.log(`Draft gestartet: ${A.value} bei ${E(B.value)}`))},ge=async()=>{if(!(!z.value||!y.value))try{s.updateDraftEnd(B.value),await s.commitDraft(),z.value=!1,A.value="",await _e(),console.log("Label-Markierung abgeschlossen")}catch(l){console.error("Error finishing label marking:",l)}},U=()=>{s.cancelDraft(),z.value=!1,A.value="",console.log("Label-Markierung abgebrochen")},Y=async l=>{oe.value.push(l);const e={id:`exam-${l.id}`,timestamp:l.timestamp,examination_data:l.data};T.value.push(e),Z(`Untersuchung gespeichert: ${l.examination_type||"Untersuchung"}`);try{const m=at(),w=rt();w.initMockUser(),w.user?.id&&y.value?(await m.createExaminationAnnotation(y.value.toString(),l.timestamp,l.examination_type||"examination",l.id,w.user.id),console.log(`✅ Created annotation for examination ${l.id}`)):console.warn("No authenticated user or video ID found for examination annotation creation")}catch(m){console.error("Failed to create examination annotation:",m)}console.log("Examination saved:",l)},V=l=>{X(l.timestamp),re.value=T.value.find(e=>e.id===`exam-${l.id}`)||null},Ve=async l=>{try{await J.delete(Q(`examinations/${l}/`)),oe.value=oe.value.filter(e=>e.id!==l),T.value=T.value.filter(e=>e.id!==`exam-${l}`),re.value?.id===`exam-${l}`&&(re.value=null),Z(`Untersuchung ${l} gelöscht`),console.log("Examination deleted:",l)}catch(e){console.error("Error deleting examination:",e),await j(Promise.reject(e))}},Ke=l=>{console.error("Video loading error:",l);const e=l.target;console.error("Video error details:",{error:e.error,networkState:e.networkState,readyState:e.readyState,currentSrc:e.currentSrc}),Ee("Fehler beim Laden des Videos. Bitte versuchen Sie es erneut.")},Ge=()=>{console.log("Video loading started for:",G.value)},Ze=()=>{console.log("Video can play, loaded successfully"),Z("Video erfolgreich geladen")};return(l,e)=>(a(),r("div",xn,[O.value?(a(),r("div",Sn,[e[2]||(e[2]=t("i",{class:"material-icons me-2"},"error",-1)),e[3]||(e[3]=t("strong",null,"Fehler:",-1)),M(" "+g(O.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:pe,"aria-label":"Close"})])):p("",!0),K.value?(a(),r("div",wn,[e[4]||(e[4]=t("i",{class:"material-icons me-2"},"check_circle",-1)),e[5]||(e[5]=t("strong",null,"Erfolg:",-1)),M(" "+g(K.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:ye,"aria-label":"Close"})])):p("",!0),e[25]||(e[25]=t("div",{class:"row"},[t("div",{class:"col-12"},[t("h1",null,"Video-Untersuchung Annotation"),t("p",null,"Annotieren Sie Untersuchungen während der Videobetrachtung")])],-1)),t("div",Ln,[t("div",In,[t("div",En,[e[19]||(e[19]=t("div",{class:"card-header pb-0"},[t("h5",{class:"mb-0"},"Video Player")],-1)),t("div",Mn,[t("div",_n,[e[6]||(e[6]=t("label",{class:"form-label"},"Video auswählen:",-1)),te(t("select",{"onUpdate:modelValue":e[0]||(e[0]=m=>y.value=m),onChange:we,class:"form-select",disabled:!de.value},[t("option",Vn,g(de.value?"Bitte Video auswählen...":"Keine Videos verfügbar"),1),(a(!0),r(R,null,P(N.value,m=>(a(),r("option",{key:m.id,value:m.id},g(m.original_file_name||"Video Nr. "+m.id)+" "+g("Center:"+m.centerName||"Unbekanntes Zentrum")+" "+g("Processor:"+m.processorName||"Unbekannter Prozessor"),9,Fn))),128))],40,Tn),[[le,y.value,void 0,{number:!0}]]),de.value?p("",!0):(a(),r("small",$n,g(Le.value),1))]),!G.value&&de.value?(a(),r("div",zn,[e[10]||(e[10]=t("i",{class:"material-icons",style:{"font-size":"48px"}},"movie",-1)),e[11]||(e[11]=t("p",{class:"mt-2"},"Video auswählen, um mit der Betrachtung zu beginnen",-1)),y.value?(a(),r("div",Un,[t("small",null,[e[7]||(e[7]=t("strong",null,"Debug:",-1)),M(" Video ID "+g(y.value)+" ausgewählt",1),e[8]||(e[8]=t("br",null,null,-1)),M(" Stream-URL: "+g(G.value||"Nicht verfügbar"),1),e[9]||(e[9]=t("br",null,null,-1)),M(" MediaStore URL: "+g(y.value?h(f).getVideoUrl(N.value.find(m=>m.id===y.value)):"N/A"),1)])])):p("",!0)])):p("",!0),de.value?p("",!0):(a(),r("div",Nn,[e[12]||(e[12]=t("i",{class:"material-icons",style:{"font-size":"48px"}},"video_library",-1)),t("p",Dn,g(Le.value),1),e[13]||(e[13]=t("small",null,"Videos können über den Ordner Raw Videos hochgeladen werden. Sie müssen erst anonymisiert werden, bevor sie hier angezeigt werden.",-1))])),G.value?(a(),r("div",Rn,[t("video",{ref_key:"videoRef",ref:I,"data-cy":"video-player",src:G.value,onTimeupdate:n,onLoadedmetadata:De,onError:Ke,onLoadstart:Ge,onCanplay:Ze,controls:"",class:"w-100",style:{"max-height":"400px"}}," Ihr Browser unterstützt das Video-Element nicht. ",40,Pn)])):p("",!0),k.value>0?(a(),r("div",Bn,[nt(kn,{video:{duration:k.value},segments:h(Fe),labels:ie.value,"current-time":B.value,"is-playing":!1,"active-segment-id":ze.value,"show-waveform":!1,"selection-mode":!0,fps:ve.value,onSeek:u,onSegmentResize:v,onSegmentMove:b,onSegmentCreate:S,onTimeSelection:x,onDeleteSegment:L},null,8,["video","segments","labels","current-time","active-segment-id","fps"]),t("div",{class:"simple-timeline-track mt-2",onClick:i,ref_key:"timelineRef",ref:he},[t("div",{class:"progress-bar",style:D({width:`${B.value/k.value*100}%`})},null,4),(a(!0),r(R,null,P(T.value,m=>(a(),r("div",{key:m.id,class:"examination-marker",style:D({left:`${m.timestamp/k.value*100}%`}),title:`Untersuchung bei ${h(E)(m.timestamp)}`},null,12,An))),128))],512)])):p("",!0),k.value>0?(a(),r("div",Wn,[t("small",jn," Timeline Debug: "+g(h($).length)+" Segmente geladen | Duration: "+g(h(E)(k.value))+" | Store: "+g(Object.keys(Ne.value).length)+" Labels ",1)])):p("",!0),y.value?(a(),r("div",Xn,[t("div",Hn,[t("div",qn,[e[15]||(e[15]=t("label",{class:"form-label mb-0 me-2"},"Neues Label setzen:",-1)),te(t("select",{"onUpdate:modelValue":e[1]||(e[1]=m=>A.value=m),onChange:Te,class:"form-select form-select-sm control-select","data-cy":"label-select"},[...e[14]||(e[14]=[it('<option value="" data-v-bc21cf87>Label auswählen...</option><option value="appendix" data-v-bc21cf87>Appendix</option><option value="blood" data-v-bc21cf87>Blut</option><option value="diverticule" data-v-bc21cf87>Divertikel</option><option value="grasper" data-v-bc21cf87>Greifer</option><option value="ileocaecalvalve" data-v-bc21cf87>Ileozäkalklappe</option><option value="ileum" data-v-bc21cf87>Ileum</option><option value="low_quality" data-v-bc21cf87>Niedrige Bildqualität</option><option value="nbi" data-v-bc21cf87>Narrow Band Imaging</option><option value="needle" data-v-bc21cf87>Nadel</option><option value="outside" data-v-bc21cf87>Außerhalb</option><option value="polyp" data-v-bc21cf87>Polyp</option><option value="snare" data-v-bc21cf87>Snare</option><option value="water_jet" data-v-bc21cf87>Wasserstrahl</option><option value="wound" data-v-bc21cf87>Wunde</option>',15)])],544),[[le,A.value]])]),t("div",On,[z.value?p("",!0):(a(),r("button",{key:0,onClick:ke,class:"btn btn-success btn-sm control-button",disabled:!Ie.value,"data-cy":"start-label-button"},[...e[16]||(e[16]=[t("i",{class:"material-icons"},"label",-1),M(" Label-Start setzen ",-1)])],8,Kn)),z.value?(a(),r("button",{key:1,onClick:ge,class:"btn btn-warning btn-sm control-button","data-cy":"finish-label-button"},[...e[17]||(e[17]=[t("i",{class:"material-icons"},"stop",-1),M(" Label-Ende setzen ",-1)])])):p("",!0),z.value?(a(),r("button",{key:2,onClick:U,class:"btn btn-outline-secondary btn-sm control-button"}," Abbrechen ")):p("",!0)]),t("span",Gn," Zeit: "+g(h(E)(B.value))+" / "+g(h(E)(k.value)),1)]),h(s).draftSegment?(a(),r("div",Zn,[t("small",null,[e[18]||(e[18]=t("i",{class:"material-icons align-middle me-1",style:{"font-size":"16px"}},"info",-1)),M(' Label "'+g(h(Ae)(h(s).draftSegment.label))+'" ',1),h(s).draftSegment.end?(a(),r("span",Yn," von "+g(h(E)(h(s).draftSegment.start))+" bis "+g(h(E)(h(s).draftSegment.end)),1)):(a(),r("span",Jn," startet bei "+g(h(E)(h(s).draftSegment.start))+" - Ende beim nächsten Klick ",1))])])):p("",!0)])):p("",!0)])])]),t("div",Qn,[t("div",ei,[t("div",ti,[e[20]||(e[20]=t("h5",{class:"mb-0"},"Untersuchungsdetails",-1)),re.value?(a(),r("small",ni," Zeitpunkt: "+g(h(E)(re.value.timestamp)),1)):p("",!0)]),t("div",ii,[Ue.value?(a(),ot(Zt,{key:0,"video-timestamp":B.value,"video-id":y.value,onExaminationSaved:Y,"data-cy":"examination-form"},null,8,["video-timestamp","video-id"])):(a(),r("div",oi,[...e[21]||(e[21]=[t("i",{class:"material-icons",style:{"font-size":"48px"}},"videocam",-1),t("p",{class:"mt-2"},"Wählen Sie ein Video aus, um mit der Annotation zu beginnen",-1)])]))])]),oe.value.length>0?(a(),r("div",si,[e[24]||(e[24]=t("div",{class:"card-header pb-0"},[t("h6",{class:"mb-0"},"Gespeicherte Untersuchungen")],-1)),t("div",li,[t("div",ai,[(a(!0),r(R,null,P(oe.value,m=>(a(),r("div",{key:m.id,class:"list-group-item d-flex justify-content-between align-items-center px-0"},[t("div",null,[t("small",ri,g(h(E)(m.timestamp)),1),t("div",null,g(m.examination_type||"Untersuchung"),1)]),t("div",null,[t("button",{onClick:w=>V(m),class:"btn btn-sm btn-outline-primary me-2"},[...e[22]||(e[22]=[t("i",{class:"material-icons"},"play_arrow",-1)])],8,di),t("button",{onClick:w=>Ve(m.id),class:"btn btn-sm btn-outline-danger"},[...e[23]||(e[23]=[t("i",{class:"material-icons"},"delete",-1)])],8,ci)])]))),128))])])])):p("",!0)])])]))}}),hi=We(ui,[["__scopeId","data-v-bc21cf87"]]);export{hi as T};
