import{z as j,A as G,d as q,h as E,e as A,i as J,c as n,a as e,G as ee,k as r,l as R,j as g,H as V,C as U,t as l,v as Z,F as L,m as I,I as te,o as a,_ as K,J as Q,b as z,r as se}from"./main.js";import{u as W}from"./patientStore.js";async function ne(s){if(!Number.isFinite(s)||s<=0)throw new Error("Ungültige patientId");const{data:v}=await j.post(`/api/patients/${s}/pseudonym/`);return v}const F={async getPatients(){try{const s=await j.get(G("patients/"));return Array.isArray(s.data)?s.data:s.data.results||[]}catch(s){throw console.error("Error getting patients:",s),s}},async addPatient(s){try{console.log("PatientService: Sende Patientendaten an API:",s);const v=await j.post(G("patients/"),s);return console.log("PatientService: Erfolgreiche Antwort erhalten:",v.data),v.data}catch(v){throw console.error("PatientService: Fehler beim Hinzufügen des Patienten:",v),v.response?console.error("Response Error:",{status:v.response.status,statusText:v.response.statusText,data:v.response.data}):v.request?console.error("Request Error:",v.request):console.error("General Error:",v.message),v}},async updatePatient(s,v){try{return(await j.put(G(`patients/${s}/`),v)).data}catch(b){throw console.error("Error updating patient:",b),b}},async deletePatient(s){try{await j.delete(G(`patients/${s}/`))}catch(v){throw console.error("Error deleting patient:",v),v}},async getGenders(){try{return(await j.get(G("genders/")).catch(async()=>({data:[{id:1,name:"female",nameDe:"Weiblich"},{id:2,name:"male",nameDe:"Männlich"},{id:3,name:"diverse",nameDe:"Divers"}],status:200,statusText:"OK",headers:{},config:{}}))).data}catch(s){return console.error("Error getting genders:",s),[{id:1,name:"female",nameDe:"Weiblich"},{id:2,name:"male",nameDe:"Männlich"},{id:3,name:"diverse",nameDe:"Divers"}]}},async getCenters(){try{return(await j.get(G("centers/")).catch(async()=>({data:[{id:1,name:"Hauptzentrum",nameDe:"Hauptzentrum"}],status:200,statusText:"OK",headers:{},config:{}}))).data}catch(s){return console.error("Error getting centers:",s),[{id:1,name:"Hauptzentrum",nameDe:"Hauptzentrum"}]}},formatPatientData(s){const v={firstName:s.firstName,lastName:s.lastName,dob:s.dob||null,gender:s.gender||null,center:s.center||null,email:s.email||void 0,phone:s.phone||void 0,patientHash:s.patientHash||null,isRealPerson:s.isRealPerson??!0};return Object.keys(v).forEach(b=>{v[b]===""&&delete v[b]}),v},calculateAge(s){if(!s)return null;const v=new Date,b=new Date(s);if(isNaN(b.getTime()))return null;let P=v.getFullYear()-b.getFullYear();const $=v.getMonth()-b.getMonth();return($<0||$===0&&v.getDate()<b.getDate())&&P--,P>=0?P:null},isValidEmail(s){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)},validatePatientData(s){const v=[];if(s.firstName?.trim()||v.push("Vorname ist erforderlich"),s.lastName?.trim()||v.push("Nachname ist erforderlich"),s.email&&!this.isValidEmail(s.email)&&v.push("Ungültige E-Mail-Adresse"),s.dob){const b=new Date(s.dob),P=new Date;isNaN(b.getTime())?v.push("Ungültiges Geburtsdatum"):b>P&&v.push("Geburtsdatum kann nicht in der Zukunft liegen")}return{isValid:v.length===0,errors:v}}},ae={class:"patient-create-form"},le={class:"form-section"},ie={class:"row"},oe={class:"col-md-6"},de={class:"form-group"},re={key:0,class:"invalid-feedback"},ue={class:"col-md-6"},ce={class:"form-group"},me={key:0,class:"invalid-feedback"},ve={class:"row"},fe={class:"col-md-6"},be={class:"form-group"},ge={key:0,class:"invalid-feedback"},pe={key:1,class:"form-text text-muted"},he={class:"col-md-6"},ye={class:"form-group"},ke=["value"],$e={key:0,class:"invalid-feedback"},_e={class:"form-section"},Pe={class:"row"},Ne={class:"col-md-6"},we={class:"form-group"},De={key:0,class:"invalid-feedback"},xe={class:"col-md-6"},Ee={class:"form-group"},Ce={key:0,class:"invalid-feedback"},Se={class:"form-section"},Re={class:"row"},Ue={class:"col-md-6"},Ae={class:"form-group"},Ve=["value"],Te={key:0,class:"invalid-feedback"},Fe={class:"col-md-6"},je={class:"form-group"},He={class:"form-actions"},Me={key:0,class:"alert alert-danger w-100 mb-3"},Oe=["disabled"],Ge={key:0,class:"spinner-border spinner-border-sm me-2"},Le={key:1,class:"fas fa-save me-2"},Ie=["disabled"],Be=q({__name:"PatientCreateForm",emits:["patient-created","cancel"],setup(s,{emit:v}){const b=v,P=W(),$=E(!1),c=E({}),m=E({id:null,firstName:"",lastName:"",dob:null,email:"",phone:"",gender:null,center:null,patientHash:"",comments:"",isRealPerson:!0}),w=A(()=>P.genders),N=A(()=>P.centers),C=A(()=>{if(!m.value.dob)return null;try{const x=new Date(m.value.dob),d=new Date;let h=d.getFullYear()-x.getFullYear();const T=d.getMonth()-x.getMonth();return(T<0||T===0&&d.getDate()<x.getDate())&&h--,h>=0?h:null}catch{return null}}),p=A(()=>m.value.firstName.trim()!==""&&m.value.lastName.trim()!==""&&Object.keys(c.value).length===0),f=()=>(c.value={},m.value.firstName?.trim()||(c.value.firstName="Vorname ist erforderlich"),m.value.lastName?.trim()||(c.value.lastName="Nachname ist erforderlich"),m.value.dob&&new Date(m.value.dob)>new Date&&(c.value.dob="Geburtsdatum kann nicht in der Zukunft liegen"),m.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.value.email)&&(c.value.email="Ungültige E-Mail-Adresse"),Object.keys(c.value).length===0),D=async()=>{if(console.log("=== FORM SUBMIT START ==="),console.log("handleSubmit aufgerufen!",{formValid:p.value,loading:$.value,formData:m.value}),!f()){console.log("❌ Validierung fehlgeschlagen:",c.value);return}let x=null;try{$.value=!0,c.value={},console.log("✅ Validation passed, sende Daten:",m.value),x=P.formatPatientForSubmission(m.value),console.log("📋 Formatierte Daten für API:",x),console.log("🌐 API-Aufruf wird gestartet..."),console.log("URL:","/api/patients/"),console.log("Full URL wird zu:",`${window.location.origin}/api/patients/`);const d=await P.createPatient(x);console.log("🎉 Patient erfolgreich erstellt:",d),m.value={id:null,firstName:"",lastName:"",dob:null,email:"",phone:"",gender:null,center:null,patientHash:"",comments:"",isRealPerson:!0},b("patient-created",d),console.log("📤 Event patient-created ausgelöst mit:",d),console.log("=== FORM SUBMIT SUCCESS ===")}catch(d){console.log("=== FORM SUBMIT ERROR ==="),console.error("❌ KOMPLETTES ERROR-OBJEKT:",d),console.error("❌ ERROR STACK:",d.stack),console.error("❌ ERROR NAME:",d.name),console.error("❌ ERROR MESSAGE:",d.message),d.message&&d.message.includes("HTTP error!")?c.value.general="Server-Fehler beim Erstellen des Patienten. Prüfen Sie Ihre Verbindung.":c.value.general=d.message||"Unbekannter Fehler beim Erstellen des Patienten",console.error("🔍 Zusätzliche Debug-Infos:",{errorName:d.name,errorMessage:d.message,errorStack:d.stack,formattedData:x,timestamp:new Date().toISOString()})}finally{$.value=!1,console.log("🏁 Loading beendet, finaler Zustand:",{loading:$.value,errors:c.value,hasErrors:Object.keys(c.value).length>0})}},H=async()=>{try{if(w.value.length===0){const x=await F.getGenders();P.genders=x}if(N.value.length===0){const x=await F.getCenters();P.centers=x}}catch(x){console.error("Error loading lookup data:",x)}};return J(()=>{H()}),(x,d)=>(a(),n("div",ae,[e("form",{onSubmit:ee(D,["prevent"])},[e("div",le,[d[14]||(d[14]=e("h4",null,[e("i",{class:"fas fa-user"}),r(" Grunddaten ")],-1)),e("div",ie,[e("div",oe,[e("div",de,[d[9]||(d[9]=e("label",{for:"firstName",class:"required"},"Vorname",-1)),R(e("input",{"onUpdate:modelValue":d[0]||(d[0]=h=>m.value.firstName=h),type:"text",id:"firstName",class:U(["form-control",{"is-invalid":c.value.firstName}]),required:"",placeholder:"Vorname eingeben"},null,2),[[V,m.value.firstName]]),c.value.firstName?(a(),n("div",re,l(c.value.firstName),1)):g("",!0)])]),e("div",ue,[e("div",ce,[d[10]||(d[10]=e("label",{for:"lastName",class:"required"},"Nachname",-1)),R(e("input",{"onUpdate:modelValue":d[1]||(d[1]=h=>m.value.lastName=h),type:"text",id:"lastName",class:U(["form-control",{"is-invalid":c.value.lastName}]),required:"",placeholder:"Nachname eingeben"},null,2),[[V,m.value.lastName]]),c.value.lastName?(a(),n("div",me,l(c.value.lastName),1)):g("",!0)])])]),e("div",ve,[e("div",fe,[e("div",be,[d[11]||(d[11]=e("label",{for:"dob"},"Geburtsdatum",-1)),R(e("input",{"onUpdate:modelValue":d[2]||(d[2]=h=>m.value.dob=h),type:"date",id:"dob",class:U(["form-control",{"is-invalid":c.value.dob}])},null,2),[[V,m.value.dob]]),c.value.dob?(a(),n("div",ge,l(c.value.dob),1)):g("",!0),C.value?(a(),n("small",pe," Alter: "+l(C.value)+" Jahre ",1)):g("",!0)])]),e("div",he,[e("div",ye,[d[13]||(d[13]=e("label",{for:"gender"},"Geschlecht",-1)),R(e("select",{"onUpdate:modelValue":d[3]||(d[3]=h=>m.value.gender=h),id:"gender",class:U(["form-control",{"is-invalid":c.value.gender}])},[d[12]||(d[12]=e("option",{value:""},"Bitte wählen",-1)),(a(!0),n(L,null,I(w.value,h=>(a(),n("option",{key:h.id,value:h.name},l(h.nameDe||h.name),9,ke))),128))],2),[[Z,m.value.gender]]),c.value.gender?(a(),n("div",$e,l(c.value.gender),1)):g("",!0)])])])]),e("div",_e,[d[17]||(d[17]=e("h4",null,[e("i",{class:"fas fa-address-book"}),r(" Kontaktdaten ")],-1)),e("div",Pe,[e("div",Ne,[e("div",we,[d[15]||(d[15]=e("label",{for:"email"},"E-Mail",-1)),R(e("input",{"onUpdate:modelValue":d[4]||(d[4]=h=>m.value.email=h),type:"email",id:"email",class:U(["form-control",{"is-invalid":c.value.email}]),placeholder:"email@beispiel.de"},null,2),[[V,m.value.email]]),c.value.email?(a(),n("div",De,l(c.value.email),1)):g("",!0)])]),e("div",xe,[e("div",Ee,[d[16]||(d[16]=e("label",{for:"phone"},"Telefon",-1)),R(e("input",{"onUpdate:modelValue":d[5]||(d[5]=h=>m.value.phone=h),type:"tel",id:"phone",class:U(["form-control",{"is-invalid":c.value.phone}]),placeholder:"+49 123 456789"},null,2),[[V,m.value.phone]]),c.value.phone?(a(),n("div",Ce,l(c.value.phone),1)):g("",!0)])])])]),e("div",Se,[d[22]||(d[22]=e("h4",null,[e("i",{class:"fas fa-hospital"}),r(" Organisation ")],-1)),e("div",Re,[e("div",Ue,[e("div",Ae,[d[19]||(d[19]=e("label",{for:"center"},"Zentrum",-1)),R(e("select",{"onUpdate:modelValue":d[6]||(d[6]=h=>m.value.center=h),id:"center",class:U(["form-control",{"is-invalid":c.value.center}])},[d[18]||(d[18]=e("option",{value:""},"Bitte wählen",-1)),(a(!0),n(L,null,I(N.value,h=>(a(),n("option",{key:h.id,value:h.name},l(h.nameDe||h.name),9,Ve))),128))],2),[[Z,m.value.center]]),c.value.center?(a(),n("div",Te,l(c.value.center),1)):g("",!0)])]),e("div",Fe,[e("div",je,[e("label",null,[R(e("input",{"onUpdate:modelValue":d[7]||(d[7]=h=>m.value.isRealPerson=h),type:"checkbox",class:"form-check-input me-2"},null,512),[[te,m.value.isRealPerson]]),d[20]||(d[20]=r(" Reale Person ",-1))]),d[21]||(d[21]=e("small",{class:"form-text text-muted d-block"}," Aktiviert für echte Patienten, deaktiviert für Testdaten ",-1))])])])]),e("div",He,[c.value.general?(a(),n("div",Me,[d[23]||(d[23]=e("strong",null,"Fehler:",-1)),r(" "+l(c.value.general),1)])):g("",!0),e("button",{type:"submit",class:"btn btn-primary",disabled:$.value||!p.value},[$.value?(a(),n("span",Ge)):(a(),n("i",Le)),r(" "+l($.value?"Wird gespeichert...":"Patient erstellen"),1)],8,Oe),e("button",{type:"button",class:"btn btn-secondary ms-2",onClick:d[8]||(d[8]=h=>x.$emit("cancel")),disabled:$.value},[...d[24]||(d[24]=[e("i",{class:"fas fa-times me-2"},null,-1),r(" Abbrechen ",-1)])],8,Ie)])],32)]))}}),ze=K(Be,[["__scopeId","data-v-75c0175d"]]),Ke={class:"patient-edit-form"},Ze={class:"form-grid"},qe={class:"form-section"},We={class:"form-group"},Je={key:0,class:"invalid-feedback"},Ye={class:"form-group"},Qe={key:0,class:"invalid-feedback"},Xe={class:"form-group"},et=["max"],tt={key:0,class:"invalid-feedback"},st={class:"form-group"},nt=["value"],at={key:0,class:"invalid-feedback"},lt={class:"form-section"},it={class:"form-group"},ot={key:0,class:"invalid-feedback"},dt={class:"form-group"},rt={key:0,class:"invalid-feedback"},ut={class:"form-group"},ct=["value"],mt={key:0,class:"invalid-feedback"},vt={class:"form-group"},ft={class:"form-check"},bt={key:0,class:"alert alert-danger"},gt={class:"form-actions"},pt={class:"action-group"},ht=["disabled"],yt=["disabled"],kt={key:0,class:"spinner-border spinner-border-sm me-2"},$t={key:1,class:"fas fa-save me-2"},_t={class:"delete-section"},Pt=["disabled"],Nt={key:0,class:"modal-overlay"},wt={class:"modal-dialog"},Dt={class:"modal-content"},xt={class:"modal-body"},Et={key:0,class:"deletion-info"},Ct={class:"mb-0"},St={key:0},Rt={key:1},Ut={key:2},At={key:3},Vt={class:"modal-footer"},Tt=["disabled"],Ft=["disabled"],jt={key:0,class:"spinner-border spinner-border-sm me-2"},Ht={key:1,class:"fas fa-trash me-2"},Mt=q({__name:"PatientEditForm",props:{patient:{}},emits:["patient-updated","patient-deleted","cancel"],setup(s,{emit:v}){const b=s,P=v,$=W(),c=E(!1),m=E(!1),w=E(!1),N=E(""),C=E(null),p=Q({id:b.patient.id||null,firstName:b.patient.firstName||"",lastName:b.patient.lastName||"",dob:b.patient.dob?b.patient.dob.split("T")[0]:null,gender:b.patient.gender||null,center:b.patient.center||null,email:b.patient.email||"",phone:b.patient.phone||"",patientHash:b.patient.patientHash||"",comments:"",isRealPerson:b.patient.isRealPerson??!0}),f=Q({firstName:"",lastName:"",dob:"",gender:"",center:"",email:"",phone:"",patientHash:""}),D=A(()=>$.genders),H=A(()=>$.centers),x=A(()=>new Date().toISOString().split("T")[0]),d=A(()=>p.firstName.trim()&&p.lastName.trim()&&!Object.values(f).some(_=>_)),h=()=>{Object.keys(f).forEach(i=>{f[i]=""});let _=!0;return p.firstName.trim()||(f.firstName="Vorname ist erforderlich",_=!1),p.lastName.trim()||(f.lastName="Nachname ist erforderlich",_=!1),p.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.email)&&(f.email="Ungültige E-Mail-Adresse",_=!1),p.dob&&new Date(p.dob)>new Date&&(f.dob="Geburtsdatum kann nicht in der Zukunft liegen",_=!1),_},T=async()=>{if(h())try{c.value=!0,N.value="";const _=F.formatPatientData(p),i=await F.updatePatient(b.patient.id,_);P("patient-updated",i)}catch(_){if(console.error("Error updating patient:",_),_.response?.data){const i=_.response.data;typeof i=="object"&&Object.keys(i).forEach(o=>{o in f&&(f[o]=Array.isArray(i[o])?i[o][0]:i[o])}),N.value=i.detail||i.message||"Fehler beim Aktualisieren des Patienten"}else N.value=_.message||"Unbekannter Fehler beim Aktualisieren des Patienten"}finally{c.value=!1}},M=async()=>{try{m.value=!0,await F.deletePatient(b.patient.id),P("patient-deleted",b.patient.id),w.value=!1}catch(_){console.error("Error deleting patient:",_),N.value=_.message||"Fehler beim Löschen des Patienten",w.value=!1}finally{m.value=!1}},O=async()=>{try{const _=await fetch(`/api/patients/${b.patient.id}/check_deletion_safety/`);if(_.ok){const i=await _.json();C.value=i.related_objects}}catch(_){console.error("Error loading deletion info:",_)}};return J(()=>{O()}),(_,i)=>(a(),n("div",Ke,[e("form",{onSubmit:ee(T,["prevent"]),class:"edit-form"},[e("div",Ze,[e("div",qe,[i[17]||(i[17]=e("h5",{class:"section-title"},[e("i",{class:"fas fa-user"}),r(" Grunddaten ")],-1)),e("div",We,[i[11]||(i[11]=e("label",{for:"firstName",class:"form-label required"}," Vorname ",-1)),R(e("input",{id:"firstName","onUpdate:modelValue":i[0]||(i[0]=o=>p.firstName=o),type:"text",class:U(["form-control",{"is-invalid":f.firstName}]),required:"",maxlength:"100"},null,2),[[V,p.firstName]]),f.firstName?(a(),n("div",Je,l(f.firstName),1)):g("",!0)]),e("div",Ye,[i[12]||(i[12]=e("label",{for:"lastName",class:"form-label required"}," Nachname ",-1)),R(e("input",{id:"lastName","onUpdate:modelValue":i[1]||(i[1]=o=>p.lastName=o),type:"text",class:U(["form-control",{"is-invalid":f.lastName}]),required:"",maxlength:"100"},null,2),[[V,p.lastName]]),f.lastName?(a(),n("div",Qe,l(f.lastName),1)):g("",!0)]),e("div",Xe,[i[13]||(i[13]=e("label",{for:"dob",class:"form-label"}," Geburtsdatum ",-1)),R(e("input",{id:"dob","onUpdate:modelValue":i[2]||(i[2]=o=>p.dob=o),type:"date",class:U(["form-control",{"is-invalid":f.dob}]),max:x.value},null,10,et),[[V,p.dob]]),f.dob?(a(),n("div",tt,l(f.dob),1)):g("",!0),i[14]||(i[14]=e("small",{class:"form-text text-muted"}," Optional - Wird zur Altersberechnung verwendet ",-1))]),e("div",st,[i[16]||(i[16]=e("label",{for:"gender",class:"form-label"}," Geschlecht ",-1)),R(e("select",{id:"gender","onUpdate:modelValue":i[3]||(i[3]=o=>p.gender=o),class:U(["form-select",{"is-invalid":f.gender}])},[i[15]||(i[15]=e("option",{value:""},"Bitte wählen",-1)),(a(!0),n(L,null,I(D.value,o=>(a(),n("option",{key:o.id,value:o.name},l(o.nameDe||o.name),9,nt))),128))],2),[[Z,p.gender]]),f.gender?(a(),n("div",at,l(f.gender),1)):g("",!0)])]),e("div",lt,[i[23]||(i[23]=e("h5",{class:"section-title"},[e("i",{class:"fas fa-address-book"}),r(" Kontaktdaten ")],-1)),e("div",it,[i[18]||(i[18]=e("label",{for:"email",class:"form-label"}," E-Mail-Adresse ",-1)),R(e("input",{id:"email","onUpdate:modelValue":i[4]||(i[4]=o=>p.email=o),type:"email",class:U(["form-control",{"is-invalid":f.email}]),maxlength:"254"},null,2),[[V,p.email]]),f.email?(a(),n("div",ot,l(f.email),1)):g("",!0)]),e("div",dt,[i[19]||(i[19]=e("label",{for:"phone",class:"form-label"}," Telefonnummer ",-1)),R(e("input",{id:"phone","onUpdate:modelValue":i[5]||(i[5]=o=>p.phone=o),type:"tel",class:U(["form-control",{"is-invalid":f.phone}]),maxlength:"20"},null,2),[[V,p.phone]]),f.phone?(a(),n("div",rt,l(f.phone),1)):g("",!0)]),e("div",ut,[i[21]||(i[21]=e("label",{for:"center",class:"form-label"}," Zentrum ",-1)),R(e("select",{id:"center","onUpdate:modelValue":i[6]||(i[6]=o=>p.center=o),class:U(["form-select",{"is-invalid":f.center}])},[i[20]||(i[20]=e("option",{value:""},"Kein Zentrum zugeordnet",-1)),(a(!0),n(L,null,I(H.value,o=>(a(),n("option",{key:o.id,value:o.name},l(o.nameDe||o.name),9,ct))),128))],2),[[Z,p.center]]),f.center?(a(),n("div",mt,l(f.center),1)):g("",!0)]),e("div",vt,[e("div",ft,[R(e("input",{id:"isRealPerson","onUpdate:modelValue":i[7]||(i[7]=o=>p.isRealPerson=o),class:"form-check-input",type:"checkbox"},null,512),[[te,p.isRealPerson]]),i[22]||(i[22]=e("label",{class:"form-check-label",for:"isRealPerson"},[e("strong",null,"Realer Patient"),e("small",{class:"d-block text-muted"}," Markieren Sie dies nur für echte Patientendaten ")],-1))])])])]),N.value?(a(),n("div",bt,[i[24]||(i[24]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),i[25]||(i[25]=e("strong",null,"Fehler:",-1)),r(" "+l(N.value),1)])):g("",!0),e("div",gt,[e("div",pt,[e("button",{type:"button",class:"btn btn-secondary",onClick:i[8]||(i[8]=o=>_.$emit("cancel")),disabled:c.value},[...i[26]||(i[26]=[e("i",{class:"fas fa-times"},null,-1),r(" Abbrechen ",-1)])],8,ht),e("button",{type:"submit",class:"btn btn-primary",disabled:c.value||!d.value},[c.value?(a(),n("span",kt)):(a(),n("i",$t)),r(" "+l(c.value?"Wird gespeichert...":"Speichern"),1)],8,yt)]),e("div",_t,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:i[9]||(i[9]=o=>w.value=!0),disabled:c.value},[...i[27]||(i[27]=[e("i",{class:"fas fa-trash"},null,-1),r(" Patient löschen ",-1)])],8,Pt)])])],32),w.value?(a(),n("div",Nt,[e("div",wt,[e("div",Dt,[i[32]||(i[32]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-exclamation-triangle text-danger"}),r(" Patient löschen bestätigen ")])],-1)),e("div",xt,[i[31]||(i[31]=e("div",{class:"alert alert-warning"},[e("i",{class:"fas fa-exclamation-triangle"}),e("strong",null,"Achtung!"),r(" Diese Aktion kann nicht rückgängig gemacht werden. ")],-1)),e("p",null,[i[28]||(i[28]=r(" Möchten Sie den Patienten ",-1)),e("strong",null,l(s.patient.firstName)+" "+l(s.patient.lastName),1),i[29]||(i[29]=r(" wirklich löschen? ",-1))]),C.value?(a(),n("div",Et,[i[30]||(i[30]=e("h6",null,"Auswirkungen:",-1)),e("ul",Ct,[C.value.examinations>0?(a(),n("li",St,l(C.value.examinations)+" Untersuchung(en) werden gelöscht ",1)):g("",!0),C.value.findings>0?(a(),n("li",Rt,l(C.value.findings)+" Befund(e) werden gelöscht ",1)):g("",!0),C.value.videos>0?(a(),n("li",Ut,l(C.value.videos)+" Video(s) werden entfernt ",1)):g("",!0),C.value.reports>0?(a(),n("li",At,l(C.value.reports)+" Bericht(e) werden entfernt ",1)):g("",!0)])])):g("",!0)]),e("div",Vt,[e("button",{type:"button",class:"btn btn-secondary",onClick:i[10]||(i[10]=o=>w.value=!1),disabled:m.value}," Abbrechen ",8,Tt),e("button",{type:"button",class:"btn btn-danger",onClick:M,disabled:m.value},[m.value?(a(),n("span",jt)):(a(),n("i",Ht)),r(" "+l(m.value?"Wird gelöscht...":"Endgültig löschen"),1)],8,Ft)])])])])):g("",!0)]))}}),X=K(Mt,[["__scopeId","data-v-b5cf8612"]]),Ot={class:"patient-detail-view"},Gt={class:"detail-header"},Lt={class:"patient-header-info"},It={class:"patient-title"},Bt={key:0,class:"badge bg-success"},zt={key:1,class:"badge bg-secondary"},Kt={class:"detail-actions"},Zt=["disabled"],qt=["disabled"],Wt=["disabled"],Jt={key:0,class:"alert alert-danger"},Yt={key:1,class:"alert alert-success"},Qt={key:2,class:"edit-section"},Xt={class:"card"},es={class:"card-body"},ts={key:3,class:"patient-info-display"},ss={class:"row"},ns={class:"col-md-6"},as={class:"card info-card"},ls={class:"card-body"},is={class:"info-grid"},os={class:"info-item"},ds={class:"info-item"},rs={class:"info-item"},us={key:0,class:"pseudonym-names"},cs=["disabled"],ms={key:0,class:"spinner-border spinner-border-sm me-1"},vs={key:1,class:"fas fa-refresh"},fs=["disabled"],bs={key:0,class:"spinner-border spinner-border-sm me-1"},gs={key:1,class:"fas fa-user-secret"},ps={class:"info-item"},hs={key:0,class:"text-muted"},ys={class:"info-item"},ks={class:"col-md-6"},$s={class:"card info-card"},_s={class:"card-body"},Ps={class:"info-grid"},Ns={class:"info-item"},ws=["href"],Ds={key:1,class:"text-muted"},xs={class:"info-item"},Es=["href"],Cs={key:1,class:"text-muted"},Ss={class:"info-item"},Rs={class:"info-item"},Us={class:"d-flex align-items-center gap-2"},As={class:"font-mono"},Vs=["disabled"],Ts={key:0,class:"spinner-border spinner-border-sm me-1"},Fs={key:1,class:"fas fa-key me-1"},js={class:"row mt-3"},Hs={class:"col-12"},Ms={class:"card info-card"},Os={class:"card-body"},Gs={class:"row"},Ls={class:"col-md-6"},Is={class:"info-item"},Bs={class:"font-mono"},zs={class:"info-item"},Ks={key:0,class:"badge bg-success"},Zs={key:1,class:"badge bg-secondary"},qs={class:"col-md-6"},Ws={class:"info-item"},Js={class:"info-item"},Ys={key:4,class:"modal-overlay"},Qs={class:"modal-dialog"},Xs={class:"modal-content"},en={class:"modal-body"},tn={key:0,class:"alert alert-info"},sn={key:1,class:"alert alert-warning"},nn={class:"mt-2 mb-0"},an={class:"patient-detail-view"},ln={class:"detail-header"},on={class:"patient-header-info"},dn={class:"patient-title"},rn={key:0,class:"badge bg-success"},un={key:1,class:"badge bg-secondary"},cn={class:"detail-actions"},mn=["disabled"],vn=["disabled"],fn=["disabled"],bn={key:0,class:"alert alert-danger"},gn={key:1,class:"alert alert-success"},pn={key:2,class:"edit-section"},hn={class:"card"},yn={class:"card-body"},kn={key:3,class:"patient-info-display"},$n={class:"row"},_n={class:"col-md-6"},Pn={class:"card info-card"},Nn={class:"card-body"},wn={class:"info-grid"},Dn={class:"info-item"},xn={class:"info-item"},En={class:"info-item"},Cn={key:0,class:"pseudonym-names"},Sn=["disabled"],Rn={key:0,class:"spinner-border spinner-border-sm me-1"},Un={key:1,class:"fas fa-refresh"},An=["disabled"],Vn={key:0,class:"spinner-border spinner-border-sm me-1"},Tn={key:1,class:"fas fa-user-secret"},Fn={class:"info-item"},jn={key:0,class:"text-muted"},Hn={class:"info-item"},Mn={class:"col-md-6"},On={class:"card info-card"},Gn={class:"card-body"},Ln={class:"info-grid"},In={class:"info-item"},Bn=["href"],zn={key:1,class:"text-muted"},Kn={class:"info-item"},Zn=["href"],qn={key:1,class:"text-muted"},Wn={class:"info-item"},Jn={class:"info-item"},Yn={class:"font-mono"},Qn={class:"row mt-3"},Xn={class:"col-12"},ea={class:"card info-card"},ta={class:"card-body"},sa={class:"row"},na={class:"col-md-6"},aa={class:"info-item"},la={class:"font-mono"},ia={class:"info-item"},oa={key:0,class:"badge bg-success"},da={key:1,class:"badge bg-secondary"},ra={class:"col-md-6"},ua={class:"info-item"},ca={class:"info-item"},ma={key:4,class:"modal-overlay"},va={class:"modal-dialog"},fa={class:"modal-content"},ba={class:"modal-body"},ga={key:0,class:"alert alert-info"},pa={key:1,class:"alert alert-warning"},ha={class:"mt-2 mb-0"},ya={key:2,class:"mt-3"},ka={class:"related-objects"},$a={class:"object-count"},_a={class:"object-count"},Pa={class:"object-count"},Na={class:"object-count"},wa={class:"modal-footer"},Da=["disabled"],xa=["disabled"],Ea={key:0,class:"spinner-border spinner-border-sm me-2"},Ca={key:1,class:"fas fa-trash me-2"},Sa={key:2,class:"mt-3"},Ra={class:"related-objects"},Ua={class:"object-count"},Aa={class:"object-count"},Va={class:"object-count"},Ta={class:"object-count"},Fa={class:"modal-footer"},ja=["disabled"],Ha=["disabled"],Ma={key:0,class:"spinner-border spinner-border-sm me-2"},Oa={key:1,class:"fas fa-trash me-2"},Ga=q({__name:"PatientDetailView",props:{patient:{}},emits:["patient-updated","patient-deleted","close"],setup(s,{emit:v}){const b=s,P=v,$=W(),c=E(!1),m=E(""),w=E(""),N=E(!1),C=E(!1),p=E(!1),f=E(null),D=E(!1),H=A(()=>$.genders),x=A(()=>$.centers),d=async()=>{try{c.value=!0,m.value="";const y=$.getCurrentPatient();if(!y||!y.id)throw new Error("Aktueller Patient nicht gefunden");const t=$.resolveCurrentPatientId(y.id,!0),S=await j.get(`/api/patients/${t}/check_deletion_safety/`);f.value=S.data,C.value=!0}catch(y){m.value=y.response?.data?.detail||y.message||"Fehler beim Prüfen der Löschbarkeit"}finally{c.value=!1}},h=async()=>{try{p.value=!0,await F.deletePatient(b.patient.id),w.value=`Patient "${b.patient.firstName} ${b.patient.lastName}" wurde erfolgreich gelöscht.`,P("patient-deleted",b.patient.id),T()}catch(y){m.value=y.message||"Fehler beim Löschen des Patienten"}finally{p.value=!1}},T=()=>{C.value=!1,f.value=null},M=y=>{N.value=!1,w.value="Patient wurde erfolgreich aktualisiert.",P("patient-updated",y),setTimeout(()=>{w.value=""},5e3)},O=y=>{N.value=!1,P("patient-deleted",y)},_=y=>{if(!y)return"Nicht angegeben";try{return new Date(y).toLocaleDateString("de-DE")}catch{return"Ungültig"}},i=y=>{if(!y)return"Nicht angegeben";try{return new Date(y).toLocaleString("de-DE")}catch{return"Ungültig"}},o=y=>{if(!y)return"Nicht angegeben";const t=H.value.find(S=>S.name===y);return t?.nameDe||t?.name||y},u=y=>{if(!y)return"Nicht zugeordnet";const t=x.value.find(S=>S.name===y);return t?.nameDe||t?.name||y},k=y=>{const t={...b.patient,patientHash:y};P("patient-updated",t)},B=async()=>{try{D.value=!0,m.value="";const y=$.resolveCurrentPatientId(b.patient?.id,!0),t=await ne(y);k(t.patientHash);const S=t.patientHash&&t.patientHash.length>=8?t.patientHash.substring(0,8)+"...":t.patientHash||"—";w.value=`Pseudonym-Hash erfolgreich generiert: ${S}`,setTimeout(()=>{w.value=""},3e3)}catch(y){const t=y?.response?.data?.detail||y?.message||"Unbekannter Fehler",S=y?.response?.data?.missingFields;m.value=S?.length?`Fehlende Felder: ${S.join(", ")}`:`Fehler beim Generieren des Pseudonym-Hashes: ${t}`}finally{D.value=!1}},Y=async()=>{await B()};return(y,t)=>(a(),n("div",Ot,[e("div",Gt,[e("div",Lt,[e("h2",It,[t[6]||(t[6]=e("i",{class:"fas fa-user"},null,-1)),r(" "+l(s.patient.firstName)+" "+l(s.patient.lastName),1)]),s.patient.isRealPerson?(a(),n("span",Bt,[...t[7]||(t[7]=[e("i",{class:"fas fa-shield-alt"},null,-1),r(" Realer Patient ",-1)])])):(a(),n("span",zt,[...t[8]||(t[8]=[e("i",{class:"fas fa-user-secret"},null,-1),r(" Test-Patient ",-1)])]))]),e("div",Kt,[e("button",{class:"btn btn-secondary btn-sm",onClick:t[0]||(t[0]=S=>y.$emit("close")),disabled:c.value},[...t[9]||(t[9]=[e("i",{class:"fas fa-times"},null,-1),r(" Schließen ",-1)])],8,Zt),e("button",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=S=>N.value=!0),disabled:c.value||N.value},[...t[10]||(t[10]=[e("i",{class:"fas fa-edit"},null,-1),r(" Bearbeiten ",-1)])],8,qt),e("button",{class:"btn btn-outline-danger btn-sm",onClick:d,disabled:c.value||N.value},[...t[11]||(t[11]=[e("i",{class:"fas fa-trash"},null,-1),r(" Löschen ",-1)])],8,Wt)])]),m.value?(a(),n("div",Jt,[t[12]||(t[12]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),r(" "+l(m.value),1)])):g("",!0),w.value?(a(),n("div",Yt,[t[13]||(t[13]=e("i",{class:"fas fa-check-circle"},null,-1)),r(" "+l(w.value),1)])):g("",!0),N.value?(a(),n("div",Qt,[e("div",Xt,[t[14]||(t[14]=e("div",{class:"card-header"},[e("h4",{class:"card-title"},[e("i",{class:"fas fa-edit"}),r(" Patient bearbeiten ")])],-1)),e("div",es,[z(X,{patient:s.patient,onPatientUpdated:M,onPatientDeleted:O,onCancel:t[2]||(t[2]=S=>N.value=!1)},null,8,["patient"])])])])):(a(),n("div",ts,[e("div",ss,[e("div",ns,[e("div",as,[t[20]||(t[20]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-user"}),r(" Grunddaten ")])],-1)),e("div",ls,[e("div",is,[e("div",os,[t[15]||(t[15]=e("label",null,"Vorname:",-1)),e("span",null,l(s.patient.firstName||"Nicht angegeben"),1)]),e("div",ds,[t[16]||(t[16]=e("label",null,"Nachname:",-1)),e("span",null,l(s.patient.lastName||"Nicht angegeben"),1)]),e("div",rs,[t[17]||(t[17]=e("label",null,"Pseudonym:",-1)),s.patient.pseudonymFirstName&&s.patient.pseudonymLastName?(a(),n("span",us,[r(l(s.patient.pseudonymFirstName)+" "+l(s.patient.pseudonymLastName)+" ",1),e("button",{class:"btn btn-outline-secondary btn-sm ms-2",onClick:Y,disabled:D.value,title:"Neue Pseudonamen generieren"},[D.value?(a(),n("span",ms)):(a(),n("i",vs)),r(" "+l(D.value?"Generiere...":"Neu"),1)],8,cs)])):(a(),n("button",{key:1,class:"btn btn-outline-primary btn-sm",onClick:B,disabled:D.value},[D.value?(a(),n("span",bs)):(a(),n("i",gs)),r(" "+l(D.value?"Generiere...":"Pseudonym generieren"),1)],8,fs))]),e("div",ps,[t[18]||(t[18]=e("label",null,"Geburtsdatum:",-1)),e("span",null,[r(l(_(s.patient.dob))+" ",1),s.patient.age?(a(),n("small",hs,"("+l(s.patient.age)+" Jahre)",1)):g("",!0)])]),e("div",ys,[t[19]||(t[19]=e("label",null,"Geschlecht:",-1)),e("span",null,l(o(s.patient.gender)),1)])])])])]),e("div",ks,[e("div",$s,[t[25]||(t[25]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-address-book"}),r(" Kontaktdaten ")])],-1)),e("div",_s,[e("div",Ps,[e("div",Ns,[t[21]||(t[21]=e("label",null,"E-Mail:",-1)),e("span",null,[s.patient.email?(a(),n("a",{key:0,href:`mailto:${s.patient.email}`,class:"link"},l(s.patient.email),9,ws)):(a(),n("span",Ds,"Nicht angegeben"))])]),e("div",xs,[t[22]||(t[22]=e("label",null,"Telefon:",-1)),e("span",null,[s.patient.phone?(a(),n("a",{key:0,href:`tel:${s.patient.phone}`,class:"link"},l(s.patient.phone),9,Es)):(a(),n("span",Cs,"Nicht angegeben"))])]),e("div",Ss,[t[23]||(t[23]=e("label",null,"Zentrum:",-1)),e("span",null,l(u(s.patient.center)),1)]),e("div",Rs,[t[24]||(t[24]=e("label",null,"Patient Hash:",-1)),e("div",Us,[e("span",As,l(s.patient.patientHash?s.patient.patientHash.length>=8?s.patient.patientHash.substring(0,8)+"...":s.patient.patientHash:"Nicht generiert"),1),e("button",{class:"btn btn-sm btn-outline-primary",onClick:B,disabled:D.value,title:"Pseudonym-Hash generieren"},[D.value?(a(),n("span",Ts)):(a(),n("i",Fs)),r(" "+l(D.value?"Generiere...":s.patient.patientHash?"Aktualisieren":"Generieren"),1)],8,Vs)])])])])])])]),e("div",js,[e("div",Hs,[e("div",Ms,[t[32]||(t[32]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-cog"}),r(" Systeminformationen ")])],-1)),e("div",Os,[e("div",Gs,[e("div",Ls,[e("div",Is,[t[26]||(t[26]=e("label",null,"Patient-ID:",-1)),e("span",Bs,l(s.patient.id),1)]),e("div",zs,[t[29]||(t[29]=e("label",null,"Datentyp:",-1)),e("span",null,[s.patient.isRealPerson?(a(),n("span",Ks,[...t[27]||(t[27]=[e("i",{class:"fas fa-shield-alt"},null,-1),r(" Realer Patient ",-1)])])):(a(),n("span",Zs,[...t[28]||(t[28]=[e("i",{class:"fas fa-user-secret"},null,-1),r(" Test-/Pseudo-Patient ",-1)])]))])])]),e("div",qs,[e("div",Ws,[t[30]||(t[30]=e("label",null,"Erstellt am:",-1)),e("span",null,l(i(s.patient.createdAt)),1)]),e("div",Js,[t[31]||(t[31]=e("label",null,"Zuletzt geändert:",-1)),e("span",null,l(i(s.patient.updatedAt)),1)])])])])])])])])),C.value?(a(),n("div",Ys,[e("div",Qs,[e("div",Xs,[t[77]||(t[77]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-exclamation-triangle text-warning"}),r(" Löschvorgang prüfen ")])],-1)),e("div",en,[f.value?.canDelete?(a(),n("div",tn,[...t[33]||(t[33]=[e("i",{class:"fas fa-info-circle"},null,-1),e("strong",null,"Patient kann gelöscht werden.",-1),e("p",{class:"mb-0 mt-2"},"Sind Sie sicher, dass Sie diesen Patienten löschen möchten?",-1)])])):(a(),n("div",sn,[t[70]||(t[70]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[71]||(t[71]=e("strong",null,"Patient kann nicht gelöscht werden.",-1)),e("ul",nn,[e("template",null,[e("div",an,[e("div",ln,[e("div",on,[e("h2",dn,[t[34]||(t[34]=e("i",{class:"fas fa-user"},null,-1)),r(" "+l(s.patient.firstName)+" "+l(s.patient.lastName),1)]),s.patient.isRealPerson?(a(),n("span",rn,[...t[35]||(t[35]=[e("i",{class:"fas fa-shield-alt"},null,-1),r(" Realer Patient ",-1)])])):(a(),n("span",un,[...t[36]||(t[36]=[e("i",{class:"fas fa-user-secret"},null,-1),r(" Test-Patient ",-1)])]))]),e("div",cn,[e("button",{class:"btn btn-secondary btn-sm",onClick:t[3]||(t[3]=S=>y.$emit("close")),disabled:c.value},[...t[37]||(t[37]=[e("i",{class:"fas fa-times"},null,-1),r(" Schließen ",-1)])],8,mn),e("button",{class:"btn btn-primary btn-sm",onClick:t[4]||(t[4]=S=>N.value=!0),disabled:c.value||N.value},[...t[38]||(t[38]=[e("i",{class:"fas fa-edit"},null,-1),r(" Bearbeiten ",-1)])],8,vn),e("button",{class:"btn btn-outline-danger btn-sm",onClick:d,disabled:c.value||N.value},[...t[39]||(t[39]=[e("i",{class:"fas fa-trash"},null,-1),r(" Löschen ",-1)])],8,fn)])]),m.value?(a(),n("div",bn,[t[40]||(t[40]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),r(" "+l(m.value),1)])):g("",!0),w.value?(a(),n("div",gn,[t[41]||(t[41]=e("i",{class:"fas fa-check-circle"},null,-1)),r(" "+l(w.value),1)])):g("",!0),N.value?(a(),n("div",pn,[e("div",hn,[t[42]||(t[42]=e("div",{class:"card-header"},[e("h4",{class:"card-title"},[e("i",{class:"fas fa-edit"}),r(" Patient bearbeiten ")])],-1)),e("div",yn,[z(X,{patient:s.patient,onPatientUpdated:M,onPatientDeleted:O,onCancel:t[5]||(t[5]=S=>N.value=!1)},null,8,["patient"])])])])):(a(),n("div",kn,[e("div",$n,[e("div",_n,[e("div",Pn,[t[48]||(t[48]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-user"}),r(" Grunddaten ")])],-1)),e("div",Nn,[e("div",wn,[e("div",Dn,[t[43]||(t[43]=e("label",null,"Vorname:",-1)),e("span",null,l(s.patient.firstName||"Nicht angegeben"),1)]),e("div",xn,[t[44]||(t[44]=e("label",null,"Nachname:",-1)),e("span",null,l(s.patient.lastName||"Nicht angegeben"),1)]),e("div",En,[t[45]||(t[45]=e("label",null,"Pseudonym:",-1)),s.patient.pseudonymFirstName&&s.patient.pseudonymLastName?(a(),n("span",Cn,[r(l(s.patient.pseudonymFirstName)+" "+l(s.patient.pseudonymLastName)+" ",1),e("button",{class:"btn btn-outline-secondary btn-sm ms-2",onClick:Y,disabled:D.value,title:"Neue Pseudonamen generieren"},[D.value?(a(),n("span",Rn)):(a(),n("i",Un)),r(" "+l(D.value?"Generiere...":"Neu"),1)],8,Sn)])):(a(),n("button",{key:1,class:"btn btn-outline-primary btn-sm",onClick:B,disabled:D.value},[D.value?(a(),n("span",Vn)):(a(),n("i",Tn)),r(" "+l(D.value?"Generiere...":"Pseudonym generieren"),1)],8,An))]),e("div",Fn,[t[46]||(t[46]=e("label",null,"Geburtsdatum:",-1)),e("span",null,[r(l(_(s.patient.dob))+" ",1),s.patient.age?(a(),n("small",jn,"("+l(s.patient.age)+" Jahre)",1)):g("",!0)])]),e("div",Hn,[t[47]||(t[47]=e("label",null,"Geschlecht:",-1)),e("span",null,l(o(s.patient.gender)),1)])])])])]),e("div",Mn,[e("div",On,[t[53]||(t[53]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-address-book"}),r(" Kontaktdaten ")])],-1)),e("div",Gn,[e("div",Ln,[e("div",In,[t[49]||(t[49]=e("label",null,"E-Mail:",-1)),e("span",null,[s.patient.email?(a(),n("a",{key:0,href:`mailto:${s.patient.email}`,class:"link"},l(s.patient.email),9,Bn)):(a(),n("span",zn,"Nicht angegeben"))])]),e("div",Kn,[t[50]||(t[50]=e("label",null,"Telefon:",-1)),e("span",null,[s.patient.phone?(a(),n("a",{key:0,href:`tel:${s.patient.phone}`,class:"link"},l(s.patient.phone),9,Zn)):(a(),n("span",qn,"Nicht angegeben"))])]),e("div",Wn,[t[51]||(t[51]=e("label",null,"Zentrum:",-1)),e("span",null,l(u(s.patient.center)),1)]),e("div",Jn,[t[52]||(t[52]=e("label",null,"Patient Hash:",-1)),e("span",Yn,l(s.patient.patientHash?s.patient.patientHash.length>=8?s.patient.patientHash.substring(0,8)+"...":s.patient.patientHash:"Nicht generiert"),1)])])])])])]),e("div",Qn,[e("div",Xn,[e("div",ea,[t[60]||(t[60]=e("div",{class:"card-header"},[e("h5",{class:"card-title"},[e("i",{class:"fas fa-cog"}),r(" Systeminformationen ")])],-1)),e("div",ta,[e("div",sa,[e("div",na,[e("div",aa,[t[54]||(t[54]=e("label",null,"Patient-ID:",-1)),e("span",la,l(s.patient.id),1)]),e("div",ia,[t[57]||(t[57]=e("label",null,"Datentyp:",-1)),e("span",null,[s.patient.isRealPerson?(a(),n("span",oa,[...t[55]||(t[55]=[e("i",{class:"fas fa-shield-alt"},null,-1),r(" Realer Patient ",-1)])])):(a(),n("span",da,[...t[56]||(t[56]=[e("i",{class:"fas fa-user-secret"},null,-1),r(" Test-/Pseudo-Patient ",-1)])]))])])]),e("div",ra,[e("div",ua,[t[58]||(t[58]=e("label",null,"Erstellt am:",-1)),e("span",null,l(i(s.patient.createdAt)),1)]),e("div",ca,[t[59]||(t[59]=e("label",null,"Zuletzt geändert:",-1)),e("span",null,l(i(s.patient.updatedAt)),1)])])])])])])])])),C.value?(a(),n("div",ma,[e("div",va,[e("div",fa,[t[69]||(t[69]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-exclamation-triangle text-warning"}),r(" Löschvorgang prüfen ")])],-1)),e("div",ba,[f.value?.canDelete?(a(),n("div",ga,[...t[61]||(t[61]=[e("i",{class:"fas fa-info-circle"},null,-1),e("strong",null,"Patient kann gelöscht werden.",-1),e("p",{class:"mb-0 mt-2"},"Sind Sie sicher, dass Sie diesen Patienten löschen möchten?",-1)])])):(a(),n("div",pa,[t[62]||(t[62]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[63]||(t[63]=e("strong",null,"Patient kann nicht gelöscht werden.",-1)),e("ul",ha,[(a(!0),n(L,null,I(f.value?.warnings?.filter(S=>S),S=>(a(),n("li",{key:S},l(S),1))),128))])])),f.value?.relatedObjects?(a(),n("div",ya,[t[68]||(t[68]=e("h6",null,"Verknüpfte Objekte:",-1)),e("div",ka,[e("div",$a,[t[64]||(t[64]=e("i",{class:"fas fa-stethoscope"},null,-1)),r(" "+l(f.value.relatedObjects.examinations)+" Untersuchung(en) ",1)]),e("div",_a,[t[65]||(t[65]=e("i",{class:"fas fa-search"},null,-1)),r(" "+l(f.value.relatedObjects.findings)+" Befund(e) ",1)]),e("div",Pa,[t[66]||(t[66]=e("i",{class:"fas fa-video"},null,-1)),r(" "+l(f.value.relatedObjects.videos)+" Video(s) ",1)]),e("div",Na,[t[67]||(t[67]=e("i",{class:"fas fa-file-pdf"},null,-1)),r(" "+l(f.value.relatedObjects.reports)+" Bericht(e) ",1)])])])):g("",!0)]),e("div",wa,[e("button",{type:"button",class:"btn btn-secondary",onClick:T,disabled:p.value}," Abbrechen ",8,Da),f.value?.canDelete?(a(),n("button",{key:0,type:"button",class:"btn btn-danger",onClick:h,disabled:p.value},[p.value?(a(),n("span",Ea)):(a(),n("i",Ca)),r(" "+l(p.value?"Wird gelöscht...":"Endgültig löschen"),1)],8,xa)):g("",!0)])])])])):g("",!0)])])])])),f.value?.relatedObjects?(a(),n("div",Sa,[t[76]||(t[76]=e("h6",null,"Verknüpfte Objekte:",-1)),e("div",Ra,[e("div",Ua,[t[72]||(t[72]=e("i",{class:"fas fa-stethoscope"},null,-1)),r(" "+l(f.value.relatedObjects.examinations)+" Untersuchung(en) ",1)]),e("div",Aa,[t[73]||(t[73]=e("i",{class:"fas fa-search"},null,-1)),r(" "+l(f.value.relatedObjects.findings)+" Befund(e) ",1)]),e("div",Va,[t[74]||(t[74]=e("i",{class:"fas fa-video"},null,-1)),r(" "+l(f.value.relatedObjects.videos)+" Video(s) ",1)]),e("div",Ta,[t[75]||(t[75]=e("i",{class:"fas fa-file-pdf"},null,-1)),r(" "+l(f.value.relatedObjects.reports)+" Bericht(e) ",1)])])])):g("",!0)]),e("div",Fa,[e("button",{type:"button",class:"btn btn-secondary",onClick:T,disabled:p.value}," Abbrechen ",8,ja),f.value?.canDelete?(a(),n("button",{key:0,type:"button",class:"btn btn-danger",onClick:h,disabled:p.value},[p.value?(a(),n("span",Ma)):(a(),n("i",Oa)),r(" "+l(p.value?"Wird gelöscht...":"Endgültig löschen"),1)],8,Ha)):g("",!0)])])])])):g("",!0)]))}}),La=K(Ga,[["__scopeId","data-v-753c8a26"]]),Ia={class:"patient-dashboard"},Ba={class:"dashboard-header"},za={class:"header-actions"},Ka=["disabled"],Za={key:0,class:"alert alert-danger alert-dismissible"},qa={key:1,class:"alert alert-success alert-dismissible"},Wa={key:2,class:"loading-container"},Ja={key:3,class:"card form-card"},Ya={class:"card-body"},Qa={key:4,class:"card patients-card"},Xa={class:"card-header"},el={class:"d-flex justify-content-between align-items-center"},tl={class:"card-title mb-0"},sl={class:"search-box"},nl={class:"card-body"},al={key:0,class:"patients-grid"},ll=["onClick"],il={class:"patient-card-header"},ol={class:"patient-name"},dl={class:"patient-id"},rl={class:"patient-card-body"},ul={class:"patient-info"},cl={class:"info-item"},ml={key:0},vl={key:0,class:"info-item"},fl={key:1,class:"info-item"},bl={key:2,class:"info-item"},gl={key:1,class:"empty-state"},pl={class:"text-muted"},hl={key:5,class:"patient-detail-section"},yl=q({__name:"PatientDashboard",setup(s){const v=W(),b=E(!1),P=E(""),$=E(""),c=E(!1),m=E(null),w=E(""),N=A(()=>v.patients),C=A(()=>v.genders),p=A(()=>v.centers),f=A(()=>{if(!w.value)return N.value;const o=w.value.toLowerCase();return N.value.filter(u=>u.firstName?.toLowerCase().includes(o)||u.lastName?.toLowerCase().includes(o)||u.email?.toLowerCase().includes(o)||`${u.firstName} ${u.lastName}`.toLowerCase().includes(o))}),D=async()=>{try{b.value=!0,P.value="",await Promise.all([H(),x()])}catch(o){P.value=o.message||"Fehler beim Laden der Daten",console.error("Error loading dashboard data:",o)}finally{b.value=!1}},H=async()=>{const o=await F.getPatients();v.patients=o},x=async()=>{try{if(C.value.length===0){const o=await F.getGenders();v.genders=o}if(p.value.length===0){const o=await F.getCenters();v.centers=o}}catch(o){console.error("Error loading lookup data:",o)}},d=o=>{m.value=o},h=o=>{c.value=!1,m.value=o,$.value=`Patient "${o.firstName} ${o.lastName}" wurde erfolgreich erstellt!`,setTimeout(()=>{$.value=""},5e3)},T=o=>{m.value=o;const u=v.patients.findIndex(k=>k.id===o.id);u!==-1&&(v.patients[u]=o),$.value=`Patient "${o.firstName} ${o.lastName}" wurde erfolgreich aktualisiert!`,setTimeout(()=>{$.value=""},5e3)},M=o=>{const u=v.patients.findIndex(k=>k.id===o);if(u!==-1){const k=v.patients[u];v.patients.splice(u,1),$.value=`Patient "${k.firstName} ${k.lastName}" wurde erfolgreich gelöscht!`}m.value=null,setTimeout(()=>{$.value=""},5e3)},O=o=>{if(!o)return"Nicht angegeben";try{return new Date(o).toLocaleDateString("de-DE")}catch{return"Ungültig"}},_=o=>{if(!o)return"Nicht angegeben";const u=C.value.find(k=>k.name===o);return u?.nameDe||u?.name||o},i=o=>{if(!o)return"Nicht zugeordnet";const u=p.value.find(k=>k.name===o);return u?.nameDe||u?.name||o};return J(()=>{D()}),(o,u)=>(a(),n("div",Ia,[e("div",Ba,[u[8]||(u[8]=e("h1",{class:"dashboard-title"},[e("i",{class:"fas fa-users"}),r(" Patienten-Dashboard ")],-1)),e("div",za,[e("button",{class:"btn btn-primary",onClick:u[0]||(u[0]=k=>c.value=!0),disabled:b.value},[...u[7]||(u[7]=[e("i",{class:"fas fa-plus"},null,-1),r(" Neuer Patient ",-1)])],8,Ka)])]),P.value?(a(),n("div",Za,[u[9]||(u[9]=e("strong",null,"Fehler:",-1)),r(" "+l(P.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:u[1]||(u[1]=k=>P.value="")})])):g("",!0),$.value?(a(),n("div",qa,[u[10]||(u[10]=e("strong",null,"Erfolg:",-1)),r(" "+l($.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:u[2]||(u[2]=k=>$.value="")})])):g("",!0),b.value?(a(),n("div",Wa,[...u[11]||(u[11]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Laden...")],-1),e("p",null,"Lade Patientendaten...",-1)])])):g("",!0),c.value&&!b.value?(a(),n("div",Ja,[u[12]||(u[12]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},[e("i",{class:"fas fa-user-plus"}),r(" Neuen Patienten erstellen ")])],-1)),e("div",Ya,[z(ze,{onPatientCreated:h,onCancel:u[3]||(u[3]=k=>c.value=!1)})])])):g("",!0),!b.value&&!c.value?(a(),n("div",Qa,[e("div",Xa,[e("div",el,[e("h3",tl,[u[13]||(u[13]=e("i",{class:"fas fa-list"},null,-1)),r(" Patienten ("+l(N.value.length)+") ",1)]),e("div",sl,[R(e("input",{"onUpdate:modelValue":u[4]||(u[4]=k=>w.value=k),type:"text",class:"form-control",placeholder:"Patienten suchen..."},null,512),[[V,w.value]])])])]),e("div",nl,[f.value.length>0?(a(),n("div",al,[(a(!0),n(L,null,I(f.value,k=>(a(),n("div",{key:k.id,class:U(["patient-card",{selected:m.value?.id===k.id}]),onClick:B=>d(k)},[e("div",il,[e("h5",ol,l(k.firstName)+" "+l(k.lastName),1),e("span",dl,"ID: "+l(k.id),1)]),e("div",rl,[e("div",ul,[e("div",cl,[u[14]||(u[14]=e("i",{class:"fas fa-birthday-cake"},null,-1)),e("span",null,l(O(k.dob)),1),k.age?(a(),n("small",ml,"("+l(k.age)+" Jahre)",1)):g("",!0)]),k.gender?(a(),n("div",vl,[u[15]||(u[15]=e("i",{class:"fas fa-venus-mars"},null,-1)),e("span",null,l(_(k.gender)),1)])):g("",!0),k.center?(a(),n("div",fl,[u[16]||(u[16]=e("i",{class:"fas fa-hospital"},null,-1)),e("span",null,l(i(k.center)),1)])):g("",!0),k.email?(a(),n("div",bl,[u[17]||(u[17]=e("i",{class:"fas fa-envelope"},null,-1)),e("span",null,l(k.email),1)])):g("",!0)])]),u[18]||(u[18]=e("div",{class:"patient-card-footer"},[e("small",{class:"text-muted"}," Klicken für Details ")],-1))],10,ll))),128))])):b.value?g("",!0):(a(),n("div",gl,[u[20]||(u[20]=e("i",{class:"fas fa-users fa-3x text-muted"},null,-1)),u[21]||(u[21]=e("h4",null,"Keine Patienten gefunden",-1)),e("p",pl,l(w.value?"Keine Patienten entsprechen der Suche.":"Erstellen Sie den ersten Patienten."),1),w.value?g("",!0):(a(),n("button",{key:0,class:"btn btn-primary",onClick:u[5]||(u[5]=k=>c.value=!0)},[...u[19]||(u[19]=[e("i",{class:"fas fa-plus"},null,-1),r(" Ersten Patienten erstellen ",-1)])]))]))])])):g("",!0),m.value&&!c.value&&!b.value?(a(),n("div",hl,[z(La,{patient:m.value,onPatientUpdated:T,onPatientDeleted:M,onClose:u[6]||(u[6]=k=>m.value=null)},null,8,["patient"])])):g("",!0)]))}}),kl=K(yl,[["__scopeId","data-v-8a212e39"]]),$l={name:"Patients",components:{PatientDashboard:kl}},_l={class:"container-fluid h-100 w-100 py-1 px-4"},Pl={class:"row"};function Nl(s,v,b,P,$,c){const m=se("PatientDashboard");return a(),n("div",_l,[e("div",Pl,[z(m)])])}const xl=K($l,[["render",Nl]]);export{xl as default};
