import{d as pe,u as Qe,s as Y,e as h,f as Ye,g as et,h as f,w as F,i as tt,c as i,j as d,a as n,k as b,t as o,l as ge,v as fe,F as j,m as q,n as nt,p as u,b as ye,q as be,x as at,y as st,z as K,A as W,o as l,_ as ot}from"./main.js";import{u as lt,f as v,g as G}from"./videoStore.js";import"./annotationStore.js";import{u as it}from"./mediaTypeStore.js";import{R as rt}from"./RequirementGenerator.js";import{T as dt}from"./Timeline.js";import"./patientStore.js";import"./PatientAdder2.js";const ut={class:"container-fluid py-4"},ct={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},mt={key:1,class:"alert alert-success alert-dismissible fade show",role:"alert"},vt={class:"row"},gt={class:"col-lg-12"},ft={class:"card"},bt={class:"card-body"},pt={class:"mb-3"},yt=["disabled"],ht={value:null},_t=["value"],St={key:0,class:"text-muted"},Vt={key:1,class:"mt-2"},wt={class:"d-flex flex-wrap gap-2 align-items-center"},kt={class:"badge bg-success"},xt={class:"badge bg-primary"},$t={class:"badge bg-secondary"},Tt={key:0,class:"text-center text-muted py-5"},Lt={key:0,class:"alert alert-info mt-2"},zt={class:"d-flex align-items-center justify-content-center"},Et={class:"text-start"},Ct={class:"text-muted"},Mt={key:1,class:"text-center text-muted py-5"},At={class:"mt-2"},Dt={key:2,class:"video-container"},Ut=["src"],Nt={key:0,class:"mt-3 p-3 rounded border video-status-card"},Pt={class:"row align-items-center"},It={class:"col-md-8"},Rt={class:"mb-1"},Bt={class:"status-badge-container mb-2"},Ft={key:0,class:"badge bg-info"},jt={key:1,class:"badge bg-warning"},qt={class:"col-md-4 text-md-end"},Kt={class:"text-muted d-block"},Wt={class:"text-muted d-block"},Gt={class:"text-muted d-block"},Ot={key:3,class:""},Xt=["disabled"],Ht={key:4,class:"timeline-wrapper mt-3"},Zt=["title"],Jt={key:5,class:"debug-info mt-2"},Qt={class:"text-muted"},Yt={key:6,class:"timeline-controls mt-4"},en={class:"d-flex align-items-center gap-3"},tn={class:"d-flex align-items-center"},nn=["value"],an={class:"d-flex align-items-center gap-2"},sn=["disabled"],on={class:"ms-3 text-muted"},ln={key:0,class:"alert alert-info mt-2 mb-0"},rn={key:0},dn={key:1},un={key:0,class:"mt-3"},cn={key:0,class:"alert alert-success d-flex align-items-center validation-status-alert"},mn={class:"text-muted"},vn={key:2,class:"text-muted text-center mt-2 mb-0",style:{"font-size":"0.9rem"}},gn={class:"col-lg-12"},fn={class:"card"},bn={class:"card-header pb-0"},pn={key:0,class:"text-muted"},yn={key:1,class:"mt-2"},hn={class:"alert alert-info alert-sm mb-0"},_n={class:"card-body p-0",style:{"max-height":"80vh","overflow-y":"auto"}},Sn={key:1,class:"text-center text-muted py-5 px-3"},Vn={key:0,class:"card mt-3"},wn={class:"card-body","data-cy":"saved-examinations"},kn={class:"list-group list-group-flush"},xn={class:"text-muted"},$n=["onClick"],Tn=["onClick"],Ln=pe({__name:"VideoExaminationAnnotation",setup(he){const O=Qe(),ee=st(),_e=Number(O.query.video??"")||null,r=lt(),Se=it(),{videoList:te,videoStreamUrl:ne,timelineSegments:Cn}=Y(r),X=h(()=>te.value.videos);Ye();const{allSegments:R}=Y(r),ae=et(),{overview:x}=Y(ae),se=h(()=>[...r.labels||[]]);function oe(t){return x.value.find(a=>a.id===t&&a.mediaType==="video")?.anonymizationStatus==="done_processing_anonymization"}const s=f(_e),V=f(0),g=f(0),Ve=f(50),U=f(!1),E=f([]),$=f([]),N=f(null),y=f(""),T=f(!1),we=f(0),le=f(null),P=f(null),I=f(null),C=f(""),B=f(""),m=f(null),H=f(null);async function ie(){if(s.value==null){r.clearVideo(),P.value=null,I.value=null;return}if(!oe(s.value)){k(`Video ${s.value} kann nicht annotiert werden, da es noch nicht anonymisiert wurde.`),s.value=null;return}Z(),J();try{await r.loadVideo(s.value),await Te(s.value),await w(Le()),await w(ze()),await w(r.fetchAllSegments(s.value)),console.log("Video fully loaded:",s.value)}catch(t){console.error("loadSelectedVideo failed",t),await w(Promise.reject(t))}}function ke(){ie(),ee.replace({query:{video:s.value}})}F(s,ie),F(()=>O.query.video,t=>{const e=Number(t??"")||null;e!==s.value&&(s.value=e)},{immediate:!0});const _=h(()=>te.value.videos.filter(t=>oe(t.id))),xe=h(()=>s.value!==null&&S.value!==void 0),S=h(()=>s.value?`${window.location.origin}/api/media/videos/${s.value}/?type=processed`:void 0),M=h(()=>_.value&&_.value.length>0),re=h(()=>X.value.length===0?"Keine Videos verfÃ¼gbar. Bitte laden Sie zuerst Videos hoch.":_.value.length===0?"Keine anonymisierten Videos verfÃ¼gbar. Videos mÃ¼ssen erst anonymisiert werden.":""),L=h(()=>s.value?R.value.filter(t=>t.videoID===s.value).map(t=>({id:t.id,label:t.label,label_display:t.label,name:t.label,startTime:t.startTime,endTime:t.endTime,avgConfidence:t.avgConfidence||0,video_id:t.videoID,label_id:t.labelID})):[]);h(()=>R.value.map(t=>({...t})));const $e=h(()=>r.segmentsByLabel),de=h(()=>s.value&&(P.value?.video_url||S.value)&&y.value&&!T.value&&g.value>0);tt(async()=>{console.log("ðŸš€ [VideoExamination] Component mounted - loading data in priority order...");try{await r.fetchLabels(),console.log(`âœ… [VideoExamination] Labels loaded: ${r.labels.length}`),await ae.fetchOverview(),console.log(`âœ… [VideoExamination] Anonymization status loaded: ${x.value.length} items`),await r.fetchAllVideos(),console.log(`âœ… [VideoExamination] Videos loaded: ${r.videoList.videos.length}`),console.log(`âœ… [VideoExamination] Annotatable videos: ${_.value.length}`)}catch(t){console.error("âŒ [VideoExamination] Error during initial load:",t),k("Fehler beim Laden der Daten. Bitte Seite neu laden.")}});async function w(t){try{return await t}catch(e){const a=e?.response?.data?.detail||e?.response?.data?.error||e?.message||String(e);C.value=a;return}}F(ne,t=>{console.log("Video stream URL updated:",t)}),F(s,t=>{console.log("Selected video ID changed, setting store to:",t),typeof t=="number"?r.setCurrentVideo(t):C.value="Invalid video ID"});const Z=()=>{C.value=""},J=()=>{B.value=""},A=t=>{B.value=t,setTimeout(()=>{J()},5e3)},k=t=>{C.value=t,setTimeout(()=>{Z()},1e4)},Te=async t=>{if(t)try{console.log("Loading video detail for ID:",t);const e=await K.get(W(`media/videos/${t}/`));console.log("Video detail response:",e.data),P.value={video_url:e.data.video_url},I.value={duration:Number(e.data.duration??0),fps:Number(e.data.fps??25)};const a=_.value.find(c=>c.id===t);a&&(Se.setCurrentItem(a),console.log("MediaStore updated with video:",t)),I.value.duration>0&&(g.value=I.value.duration),console.log("Video detail loaded:",P.value),console.log("Video meta loaded:",I.value),console.log("Stream source will be:",S.value)}catch(e){console.error("Error loading video detail:",e),await w(Promise.reject(e))}},Le=async()=>{if(s.value!==null)try{const t=await K.get(W(`video/${s.value}/examinations/`));$.value=t.data,E.value=t.data.map(e=>({id:`exam-${e.id}`,timestamp:e.timestamp,examination_data:e.data}))}catch(t){console.error("Error loading saved examinations:",t);const e=t?.response?.data?.error||t?.response?.data?.detail||t?.message||t.toString();e.includes("darf nicht annotiert werden")||e.includes("anonymisierung")||e.includes("anonymization")?k(`Video ${s.value} darf nicht annotiert werden, solange die Anonymisierung nicht abgeschlossen ist.`):t?.response?.status!==404&&await w(Promise.reject(t)),$.value=[],E.value=[]}},ze=async()=>{m.value&&await new Promise(t=>{const e=m.value;e.readyState>=1?(g.value=e.duration,t()):e.addEventListener("loadedmetadata",()=>{g.value=e.duration,t()},{once:!0})})},ue=async()=>{if(s.value!==null)try{await r.fetchAllSegments(s.value),console.log("Video segments loaded for video:",s.value),console.log("Timeline segments count:",R.value.length)}catch(t){console.error("Error loading video segments:",t)}},Ee=()=>{m.value&&(g.value=m.value.duration,m.value.addEventListener("play",()=>{U.value=!0}),m.value.addEventListener("pause",()=>{U.value=!1}),m.value.addEventListener("ended",()=>{U.value=!1}),console.log("ðŸŽ¥ Video loaded - Frontend"),console.log(`- Video source URL: ${S.value}`),console.log(`- Legacy stream URL: ${ne.value}`),console.log(`- Video detail URL: ${P.value?.video_url}`),console.log(`- Video readyState: ${m.value.readyState}`),console.log(`- Video networkState: ${m.value.networkState}`),m.value.videoWidth&&m.value.videoHeight&&console.log(`- Video dimensions: ${m.value.videoWidth}x${m.value.videoHeight}`),g.value<10?console.warn(`âš ï¸ WARNING: Video duration seems very short (${g.value}s)`):A(`Video geladen: ${Math.round(g.value)}s Dauer`))},Ce=()=>{m.value&&(V.value=m.value.currentTime)},Me=t=>{if(!H.value||g.value===0)return;const e=H.value.getBoundingClientRect(),p=(t.clientX-e.left)/e.width*g.value;Q(p)},Ae=(...t)=>{const[e]=t;Q(e)},De=(...t)=>{m.value&&(m.value.paused?m.value.play().catch(e=>{console.error("Error playing video:",e),k("Fehler beim Abspielen des Videos")}):m.value.pause())},Ue=(...t)=>{const[e]=t;le.value=e,console.log("Segment selected:",e)},Ne=(...t)=>{const[e,a,c,p,z]=t;if(typeof e=="string"&&(e==="draft"||/^temp-/.test(e))){console.warn("[VideoExamination] Ignoring resize for draft/temp segment:",e);return}const D=typeof e=="string"?parseInt(e,10):e;if(isNaN(D)){console.warn("[VideoExamination] Invalid segment ID for resize:",e);return}z?(r.patchSegmentLocally(D,{startTime:a,endTime:c}),r.updateSegment(D,{startTime:a,endTime:c}),console.log(`âœ… Segment ${D} resized and saved: ${v(a)} - ${v(c)}`)):(r.patchSegmentLocally(D,{startTime:a,endTime:c}),console.log(`Preview resize segment ${D} ${p}: ${v(a)} - ${v(c)}`))},Pe=(...t)=>{const[e,a,c,p]=t;if(typeof e=="string"&&(e==="draft"||/^temp-/.test(e))){console.warn("[VideoExamination] Ignoring move for draft/temp segment:",e);return}const z=typeof e=="string"?parseInt(e,10):e;if(isNaN(z)){console.warn("[VideoExamination] Invalid segment ID for move:",e);return}p?(r.patchSegmentLocally(z,{startTime:a,endTime:c}),r.updateSegment(z,{startTime:a,endTime:c}),console.log(`âœ… Segment ${z} moved and saved: ${v(a)} - ${v(c)}`)):(r.patchSegmentLocally(z,{startTime:a,endTime:c}),console.log(`Preview move segment ${z}: ${v(a)} - ${v(c)}`))},Ie=(...t)=>{const[e]=t;y.value&&s.value?(console.log(`Creating segment from time selection: ${v(e.start)} - ${v(e.end)} with label: ${y.value}`),ce({label:y.value,start:e.start,end:e.end})):(console.warn("Cannot create segment: no label selected or no video selected"),k("Bitte wÃ¤hlen Sie ein Label aus, bevor Sie ein Segment erstellen."))},ce=(...t)=>{const[e]=t;return new Promise(async(a,c)=>{try{s.value&&(await r.createSegment?.(s.value.toString(),e.label,e.start,e.end),A(`Segment erstellt: ${G(e.label)}`)),a()}catch(p){await w(Promise.reject(p)),c(p)}})},Re=(...t)=>{const[e]=t;return new Promise(async(a,c)=>{if(!e.id||typeof e.id!="number"){console.warn("Cannot delete draft or temporary segment:",e.id),a();return}try{r.removeSegment(e.id),await r.deleteSegment(e.id),A(`Segment gelÃ¶scht: ${G(e.label)}`),a()}catch(p){console.error("Segment konnte nicht gelÃ¶scht werden:",p),await w(Promise.reject(p)),c(p)}})},Q=t=>{m.value&&t>=0&&t<=g.value&&(m.value.currentTime=t,V.value=t)},Be=()=>{console.log("Label selected:",y.value)},Fe=()=>{de.value&&(T.value=!0,we.value=V.value,r.startDraft(y.value,V.value),console.log(`Draft gestartet: ${y.value} bei ${v(V.value)}`))},je=async()=>{if(!(!T.value||!s.value))try{r.updateDraftEnd(V.value),await r.commitDraft(),T.value=!1,y.value="",await ue(),console.log("Label-Markierung abgeschlossen")}catch(t){console.error("Error finishing label marking:",t)}},qe=()=>{r.cancelDraft(),T.value=!1,y.value="",console.log("Label-Markierung abgebrochen")},Ke=t=>{Q(t.timestamp),N.value=E.value.find(e=>e.id===`exam-${t.id}`)||null},We=async t=>{try{await K.delete(W(`examinations/${t}/`)),$.value=$.value.filter(e=>e.id!==t),E.value=E.value.filter(e=>e.id!==`exam-${t}`),N.value?.id===`exam-${t}`&&(N.value=null),A(`Untersuchung ${t} gelÃ¶scht`),console.log("Examination deleted:",t)}catch(e){console.error("Error deleting examination:",e),await w(Promise.reject(e))}},Ge=async()=>{if(!s.value){k("Kein Video ausgewÃ¤hlt");return}const t=L.value.length;if(t===0){k("Keine Segmente zum Validieren vorhanden");return}if(confirm(`MÃ¶chten Sie alle ${t} Segmente von Video ${s.value} als validiert markieren? AuÃŸerhalb-Segmente werden danach gelÃ¶scht.`))try{console.log(`ðŸ” Validating all segments for video ${s.value}...`);const e=await K.post(W(`media/videos/${s.value}/segments/validation-status/`),{notes:`VollstÃ¤ndige Video-Review abgeschlossen am ${new Date().toLocaleString("de-DE")}`});console.log("âœ… Validation response:",e.data),A(`Erfolgreich! ${e.data.updated_count} von ${e.data.total_segments} Segmenten validiert.`),await ue()}catch(e){console.error("âŒ Error validating video segments:",e);const a=e?.response?.data?.error||e?.message||"Unbekannter Fehler";k(`Validierung fehlgeschlagen: ${a}`)}},Oe=t=>{console.error("Video loading error:",t);const e=t.target;console.error("Video error details:",{error:e.error,networkState:e.networkState,readyState:e.readyState,currentSrc:e.currentSrc}),k("Fehler beim Laden des Videos. Bitte versuchen Sie es erneut.")},Xe=()=>{console.log("Video loading started for:",S.value)},He=()=>{console.log("Video can play, loaded successfully"),A("Video erfolgreich geladen")},me=t=>{const e=x.value.find(c=>c.id===t&&c.mediaType==="video");return e?{not_started:"â³ Wartend",processing_anonymization:"ðŸ”„ Verarbeitung",extracting_frames:"ðŸŽ¬ Frames",predicting_segments:"ðŸ¤– Segmente",done_processing_anonymization:"âœ… Anonymisiert",validated:"ðŸ›¡ï¸ Validiert",failed:"âŒ Fehler"}[e.anonymizationStatus]||e.anonymizationStatus:""},ve=t=>x.value.filter(e=>e.mediaType==="video"&&e.anonymizationStatus===t).length,Ze=t=>({not_started:"bg-secondary",processing_anonymization:"bg-warning",extracting_frames:"bg-info",predicting_segments:"bg-info",done_processing_anonymization:"bg-success",validated:"bg-primary",failed:"bg-danger"})[t]||"bg-secondary",Je=t=>({not_started:"Nicht gestartet",processing_anonymization:"Anonymisierung lÃ¤uft",extracting_frames:"Frames extrahieren",predicting_segments:"Segmente vorhersagen",done_processing_anonymization:"Fertig",validated:"Validiert",failed:"Fehlgeschlagen"})[t]||t;return(t,e)=>(l(),i("div",ut,[C.value?(l(),i("div",ct,[e[3]||(e[3]=n("i",{class:"material-icons me-2"},"error",-1)),e[4]||(e[4]=n("strong",null,"Fehler:",-1)),b(" "+o(C.value)+" ",1),n("button",{type:"button",class:"btn-close",onClick:Z,"aria-label":"Close"})])):d("",!0),B.value?(l(),i("div",mt,[e[5]||(e[5]=n("i",{class:"material-icons me-2"},"check_circle",-1)),e[6]||(e[6]=n("strong",null,"Erfolg:",-1)),b(" "+o(B.value)+" ",1),n("button",{type:"button",class:"btn-close",onClick:J,"aria-label":"Close"})])):d("",!0),e[39]||(e[39]=n("div",{class:"row"},[n("div",{class:"col-12"},[n("h1",null,"Video-Untersuchung Annotation"),n("p",null,"Annotieren Sie Untersuchungen wÃ¤hrend der Videobetrachtung")])],-1)),n("div",vt,[n("div",gt,[n("div",ft,[e[27]||(e[27]=n("div",{class:"card-header pb-0"},[n("h5",{class:"mb-0"},"Video Player")],-1)),n("div",bt,[n("div",pt,[e[11]||(e[11]=n("label",{class:"form-label"},"Video auswÃ¤hlen:",-1)),ge(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),onChange:ke,class:"form-select",disabled:!M.value},[n("option",ht,o(M.value?"Bitte Video auswÃ¤hlen...":"Keine Videos verfÃ¼gbar"),1),(l(!0),i(j,null,q(_.value,a=>(l(),i("option",{key:a.id,value:a.id}," ðŸ“¹ "+o(a.original_file_name||"Video Nr. "+a.id)+" "+o(me(a.id))+" | Center: "+o(a.centerName||"Unbekannt")+" | Processor: "+o(a.processorName||"Unbekannt"),9,_t))),128))],40,yt),[[fe,s.value,void 0,{number:!0}]]),M.value?d("",!0):(l(),i("small",St,o(re.value),1)),X.value.length>0?(l(),i("div",Vt,[n("div",wt,[e[10]||(e[10]=n("small",{class:"text-muted"},"Status-Ãœbersicht:",-1)),n("span",kt,[e[7]||(e[7]=n("i",{class:"fas fa-check me-1"},null,-1)),b(" "+o(ve("done_processing_anonymization"))+" Anonymisiert ",1)]),n("span",xt,[e[8]||(e[8]=n("i",{class:"fas fa-check-double me-1"},null,-1)),b(" "+o(ve("validated"))+" Validiert ",1)]),n("span",$t,[e[9]||(e[9]=n("i",{class:"fas fa-clock me-1"},null,-1)),b(" "+o(X.value.length-_.value.length)+" Ausstehend ",1)])])])):d("",!0)]),!S.value&&M.value?(l(),i("div",Tt,[e[14]||(e[14]=n("i",{class:"material-icons",style:{"font-size":"48px"}},"movie",-1)),e[15]||(e[15]=n("p",{class:"mt-2"},"Video auswÃ¤hlen, um mit der Betrachtung zu beginnen",-1)),s.value?(l(),i("div",Lt,[n("div",zt,[e[13]||(e[13]=n("i",{class:"fas fa-info-circle me-2"},null,-1)),n("div",Et,[n("strong",null,"Video "+o(s.value)+":",1),b(" "+o(me(s.value)),1),e[12]||(e[12]=n("br",null,null,-1)),n("small",Ct," Stream-URL: "+o(S.value||"Wird geladen..."),1)])])])):d("",!0)])):d("",!0),M.value?d("",!0):(l(),i("div",Mt,[e[16]||(e[16]=n("i",{class:"material-icons",style:{"font-size":"48px"}},"video_library",-1)),n("p",At,o(re.value),1),e[17]||(e[17]=n("small",null,"Videos kÃ¶nnen Ã¼ber den Ordner Raw Videos hochgeladen werden. Sie mÃ¼ssen erst anonymisiert werden, bevor sie hier angezeigt werden.",-1))])),S.value?(l(),i("div",Dt,[n("video",{ref_key:"videoRef",ref:m,"data-cy":"video-player",src:S.value,onTimeupdate:Ce,onLoadedmetadata:Ee,onError:Oe,onLoadstart:Xe,onCanplay:He,controls:"",class:"w-100",style:{"max-height":"400px"}}," Ihr Browser unterstÃ¼tzt das Video-Element nicht. ",40,Ut),s.value?(l(),i("div",Nt,[n("div",Pt,[n("div",It,[n("h6",Rt,[e[18]||(e[18]=n("i",{class:"fas fa-video me-2 text-primary"},null,-1)),b(" "+o(_.value.find(a=>a.id===s.value)?.original_file_name||`Video ${s.value}`),1)]),n("div",Bt,[n("span",{class:nt([Ze(u(x).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus||"not_started"),"badge"])},[e[19]||(e[19]=n("i",{class:"fas fa-shield-alt me-1"},null,-1)),b(" "+o(Je(u(x).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus||"not_started")),1)],2),L.value.length>0?(l(),i("span",Ft,[e[20]||(e[20]=n("i",{class:"fas fa-cut me-1"},null,-1)),b(" "+o(L.value.length)+" Segmente ",1)])):d("",!0),$.value.length>0?(l(),i("span",jt,[e[21]||(e[21]=n("i",{class:"fas fa-stethoscope me-1"},null,-1)),b(" "+o($.value.length)+" Untersuchungen ",1)])):d("",!0)])]),n("div",qt,[n("small",Kt,"Center: "+o(_.value.find(a=>a.id===s.value)?.centerName||"Unbekannt"),1),n("small",Wt,"Processor: "+o(_.value.find(a=>a.id===s.value)?.processorName||"Unbekannt"),1),n("small",Gt,"Dauer: "+o(u(v)(g.value)),1)])])])):d("",!0)])):d("",!0),S.value?d("",!0):(l(),i("div",Ot,[n("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=a=>u(r).deleteVideo(s.value)),disabled:!M.value}," Video lÃ¶schen? ",8,Xt)])),g.value>0?(l(),i("div",Ht,[ye(dt,{video:{duration:g.value},segments:L.value,labels:se.value,"current-time":V.value,"is-playing":U.value,"active-segment-id":le.value,"show-waveform":!1,"selection-mode":!0,fps:Ve.value,onSeek:Ae,onPlayPause:De,onSegmentSelect:Ue,onSegmentResize:Ne,onSegmentMove:Pe,onSegmentCreate:ce,onSegmentDelete:Re,onTimeSelection:Ie},null,8,["video","segments","labels","current-time","is-playing","active-segment-id","fps"]),n("div",{class:"simple-timeline-track mt-2",onClick:Me,ref_key:"timelineRef",ref:H},[n("div",{class:"progress-bar",style:be({width:`${V.value/g.value*100}%`})},null,4),(l(!0),i(j,null,q(E.value,a=>(l(),i("div",{key:a.id,class:"examination-marker",style:be({left:`${a.timestamp/g.value*100}%`}),title:`Untersuchung bei ${u(v)(a.timestamp)}`},null,12,Zt))),128))],512)])):d("",!0),g.value>0?(l(),i("div",Jt,[n("small",Qt," Timeline Debug: "+o(L.value.length)+" video-spezifische Segmente | "+o(u(R).length)+" total Segmente | Duration: "+o(u(v)(g.value))+" | Playing: "+o(U.value)+" | Store: "+o(Object.keys($e.value).length)+" Labels ",1)])):d("",!0),s.value?(l(),i("div",Yt,[n("div",en,[n("div",tn,[e[23]||(e[23]=n("label",{class:"form-label mb-0 me-2"},"Neues Label setzen:",-1)),ge(n("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),onChange:Be,class:"form-select form-select-sm control-select","data-cy":"label-select"},[e[22]||(e[22]=n("option",{value:""},"Label auswÃ¤hlen...",-1)),(l(!0),i(j,null,q(se.value,a=>(l(),i("option",{key:a.id,value:a.name},o(u(G)(a.name)),9,nn))),128))],544),[[fe,y.value]])]),n("div",an,[T.value?d("",!0):(l(),i("button",{key:0,onClick:Fe,class:"btn btn-success btn-sm control-button",disabled:!de.value,"data-cy":"start-label-button"},[...e[24]||(e[24]=[n("i",{class:"material-icons"},"label",-1),b(" Label-Start setzen ",-1)])],8,sn)),T.value?(l(),i("button",{key:1,onClick:je,class:"btn btn-warning btn-sm control-button","data-cy":"finish-label-button"},[...e[25]||(e[25]=[n("i",{class:"material-icons"},"stop",-1),b(" Label-Ende setzen ",-1)])])):d("",!0),T.value?(l(),i("button",{key:2,onClick:qe,class:"btn btn-outline-secondary btn-sm control-button"}," Abbrechen ")):d("",!0)]),n("span",on," Zeit: "+o(u(v)(V.value))+" / "+o(u(v)(g.value)),1)]),u(r).draftSegment?(l(),i("div",ln,[n("small",null,[e[26]||(e[26]=n("i",{class:"material-icons align-middle me-1",style:{"font-size":"16px"}},"info",-1)),b(' Label "'+o(u(G)(u(r).draftSegment.label))+'" ',1),u(r).draftSegment.end?(l(),i("span",rn," von "+o(u(v)(u(r).draftSegment.start))+" bis "+o(u(v)(u(r).draftSegment.end)),1)):(l(),i("span",dn," startet bei "+o(u(v)(u(r).draftSegment.start))+" - Ende beim nÃ¤chsten Klick ",1))])])):d("",!0)])):d("",!0)])]),s.value&&L.value.length>0?(l(),i("div",un,[u(x).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus==="validated"?(l(),i("div",cn,[e[29]||(e[29]=n("i",{class:"fas fa-check-circle fa-2x me-3 text-success"},null,-1)),n("div",null,[e[28]||(e[28]=n("h6",{class:"mb-1"},[n("i",{class:"fas fa-medal me-1"}),b(" Video bereits validiert ")],-1)),n("small",mn," Alle "+o(L.value.length)+" Segmente wurden Ã¼berprÃ¼ft und als validiert markiert. ",1)])])):(l(),i("button",{key:1,class:"btn btn-success btn-lg w-100 d-flex align-items-center justify-content-center gap-2",onClick:Ge,style:{"font-size":"1.1rem",padding:"15px"}},[e[30]||(e[30]=n("i",{class:"material-icons"},"check_circle",-1)),n("span",null,"Alle Segmente validieren ("+o(L.value.length)+")",1)])),u(x).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus!=="validated"?(l(),i("p",vn,[...e[31]||(e[31]=[n("i",{class:"material-icons",style:{"font-size":"16px","vertical-align":"middle"}},"info",-1),b(' Markiert alle Segmente als Ã¼berprÃ¼ft und setzt Video-Status auf "Validiert" ',-1)])])):d("",!0)])):d("",!0)]),n("div",gn,[n("div",fn,[n("div",bn,[e[34]||(e[34]=n("h5",{class:"mb-0"},[n("i",{class:"fas fa-clipboard-list me-2"}),b(" Anforderungsbasierte Annotation ")],-1)),N.value?(l(),i("small",pn," Zeitpunkt: "+o(u(v)(N.value.timestamp)),1)):d("",!0),s.value?(l(),i("div",yn,[n("div",hn,[e[32]||(e[32]=n("i",{class:"fas fa-info-circle me-1"},null,-1)),n("strong",null,"Video "+o(s.value)+":",1),e[33]||(e[33]=b(" Erweiterte Untersuchungsannotation mit Anforderungssets und Befunden ",-1))])])):d("",!0)]),n("div",_n,[xe.value?(l(),at(rt,{key:0,class:"requirement-generator-embedded","data-cy":"requirement-generator"})):(l(),i("div",Sn,[...e[35]||(e[35]=[n("i",{class:"fas fa-video fa-3x mb-3 text-muted"},null,-1),n("h6",null,"Video-Untersuchung",-1),n("p",{class:"mb-0"},"WÃ¤hlen Sie ein Video aus, um mit der erweiterten Annotation zu beginnen",-1),n("small",{class:"text-muted"}," Anforderungssets, Befunde und Klassifikationen werden automatisch geladen ",-1)])]))])]),$.value.length>0?(l(),i("div",Vn,[e[38]||(e[38]=n("div",{class:"card-header pb-0"},[n("h6",{class:"mb-0"},"Gespeicherte Untersuchungen")],-1)),n("div",wn,[n("div",kn,[(l(!0),i(j,null,q($.value,a=>(l(),i("div",{key:a.id,class:"list-group-item d-flex justify-content-between align-items-center px-0"},[n("div",null,[n("small",xn,o(u(v)(a.timestamp)),1),n("div",null,o(a.examination_type||"Untersuchung"),1)]),n("div",null,[n("button",{onClick:c=>Ke(a),class:"btn btn-sm btn-outline-primary me-2"},[...e[36]||(e[36]=[n("i",{class:"material-icons"},"play_arrow",-1)])],8,$n),n("button",{onClick:c=>We(a.id),class:"btn btn-sm btn-outline-danger"},[...e[37]||(e[37]=[n("i",{class:"material-icons"},"delete",-1)])],8,Tn)])]))),128))])])])):d("",!0)])])]))}}),zn=ot(Ln,[["__scopeId","data-v-1c1d0da7"]]),En={class:"container-fluid h-100 w-100 py-1 px-4"},Bn=pe({__name:"VideoExamination",setup(he){return(O,ee)=>(l(),i("div",En,[ye(zn)]))}});export{Bn as default};
