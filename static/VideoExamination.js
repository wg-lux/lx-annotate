import{d as be,u as et,s as J,e as h,f as tt,g as nt,h as g,w as F,i as at,c as i,j as d,a as n,k as f,t as l,l as me,v as ve,F as B,m as I,n as ge,p as u,b as ye,q as fe,x as st,y as ot,z as j,A as q,o,_ as lt}from"./main.js";import{u as it,f as b,g as K}from"./videoStore.js";import"./annotationStore.js";import{u as rt}from"./mediaTypeStore.js";import{R as dt}from"./RequirementGenerator.js";import{T as ut}from"./Timeline.js";import"./patientStore.js";import"./PatientAdder2.js";const ct={class:"container-fluid py-4"},mt={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},vt={key:1,class:"alert alert-success alert-dismissible fade show",role:"alert"},gt={class:"row"},ft={class:"col-lg-12"},bt={class:"card"},yt={class:"card-body"},ht={class:"mb-3"},pt=["disabled"],St={value:null},_t=["value"],Vt={key:0,class:"text-muted"},kt={key:1,class:"mt-2"},wt={class:"d-flex flex-wrap gap-2 align-items-center"},xt={class:"badge bg-success"},Tt={class:"badge bg-primary"},$t={class:"badge bg-secondary"},Lt={key:0,class:"text-center text-muted py-5"},zt={key:0,class:"alert alert-info mt-2"},Ct={class:"d-flex align-items-center justify-content-center"},Et={class:"text-start"},Mt={class:"text-muted"},At={key:1,class:"text-center text-muted py-5"},Dt={class:"mt-2"},Ut={key:2,class:"video-container"},Pt=["src"],Nt={key:0,class:"mt-3 p-3 rounded border video-status-card"},Rt={class:"row align-items-center"},Ft={class:"col-md-8"},Bt={class:"mb-1"},It={class:"status-badge-container mb-2"},jt={key:0,class:"badge bg-info"},qt={key:1,class:"badge bg-warning"},Kt={class:"col-md-4 text-md-end"},Wt={class:"text-muted d-block"},Gt={class:"text-muted d-block"},Ot={class:"text-muted d-block"},Xt={key:3,class:""},Ht=["disabled"],Zt={key:4,class:"timeline-wrapper mt-3"},Jt={key:0,class:"mt-3 d-flex gap-2"},Qt=["title"],Yt={key:1,class:"debug-info mt-2"},en={class:"text-muted"},tn={key:2,class:"timeline-controls mt-4"},nn={class:"d-flex align-items-center gap-3"},an={class:"d-flex align-items-center"},sn=["value"],on={class:"d-flex align-items-center gap-2"},ln=["disabled"],rn={class:"ms-3 text-muted"},dn={key:0,class:"alert alert-info mt-2 mb-0"},un={key:0},cn={key:1},mn={key:0,class:"mt-3"},vn={key:0,class:"alert alert-success d-flex align-items-center validation-status-alert"},gn={class:"text-muted"},fn={key:2,class:"text-muted text-center mt-2 mb-0",style:{"font-size":"0.9rem"}},bn={class:"col-lg-12"},yn={class:"card"},hn={class:"card-header pb-0"},pn={key:0,class:"text-muted"},Sn={key:1,class:"mt-2"},_n={class:"alert alert-info alert-sm mb-0"},Vn={class:"card-body p-0",style:{"max-height":"80vh","overflow-y":"auto"}},kn={key:1,class:"text-center text-muted py-5 px-3"},wn={key:0,class:"card mt-3"},xn={class:"card-body","data-cy":"saved-examinations"},Tn={class:"list-group list-group-flush"},$n={class:"text-muted"},Ln=["onClick"],zn=["onClick"],Cn=be({__name:"VideoExaminationAnnotation",setup(he){const W=et(),Q=ot(),pe=Number(W.query.video??"")||null,r=it(),Se=rt(),{videoList:Y,videoStreamUrl:ee,timelineSegments:An}=J(r),G=h(()=>Y.value.videos);tt();const{allSegments:N}=J(r),te=nt(),{overview:T}=J(te),ne=h(()=>[...r.labels||[]]);function ae(t){return T.value.find(a=>a.id===t&&a.mediaType==="video")?.anonymizationStatus==="done_processing_anonymization"}const s=g(pe),w=g(0),v=g(0),_e=g(50),A=g(!1),C=g([]),$=g([]),D=g(null),y=g(""),L=g(!1),Ve=g(0),se=g(null),U=g(null),P=g(null),E=g(""),R=g(""),c=g(null),O=g(null),ke=h(()=>N.value.some(t=>t.isDirty));async function oe(){if(s.value==null){r.clearVideo(),U.value=null,P.value=null;return}if(!ae(s.value)){x(`Video ${s.value} kann nicht annotiert werden, da es noch nicht anonymisiert wurde.`),s.value=null;return}X(),H();try{await r.loadVideo(s.value),await $e(s.value),await V(Le()),await V(ze()),await V(r.fetchAllSegments(s.value)),console.log("Video fully loaded:",s.value)}catch(t){console.error("loadSelectedVideo failed",t),await V(Promise.reject(t))}}function we(){oe(),Q.replace({query:{video:s.value}})}F(s,oe),F(()=>W.query.video,t=>{const e=Number(t??"")||null;e!==s.value&&(s.value=e)},{immediate:!0});const p=h(()=>Y.value.videos.filter(t=>ae(t.id))),xe=h(()=>s.value!==null&&S.value!==void 0),S=h(()=>s.value?`${window.location.origin}/api/media/videos/${s.value}/?type=processed`:void 0),M=h(()=>p.value&&p.value.length>0),le=h(()=>G.value.length===0?"Keine Videos verfÃ¼gbar. Bitte laden Sie zuerst Videos hoch.":p.value.length===0?"Keine anonymisierten Videos verfÃ¼gbar. Videos mÃ¼ssen erst anonymisiert werden.":""),_=h(()=>s.value?N.value.filter(t=>t.videoID===s.value):[]),Te=h(()=>r.segmentsByLabel),ie=h(()=>s.value&&(U.value?.video_url||S.value)&&y.value&&!L.value&&v.value>0);at(async()=>{console.log("ðŸš€ [VideoExamination] Component mounted - loading data in priority order...");try{await r.fetchLabels(),console.log(`âœ… [VideoExamination] Labels loaded: ${r.labels.length}`),await te.fetchOverview(),console.log(`âœ… [VideoExamination] Anonymization status loaded: ${T.value.length} items`),await r.fetchAllVideos(),console.log(`âœ… [VideoExamination] Videos loaded: ${r.videoList.videos.length}`),console.log(`âœ… [VideoExamination] Annotatable videos: ${p.value.length}`)}catch(t){console.error("âŒ [VideoExamination] Error during initial load:",t),x("Fehler beim Laden der Daten. Bitte Seite neu laden.")}});async function V(t){try{return await t}catch(e){const a=e?.response?.data?.detail||e?.response?.data?.error||e?.message||String(e);E.value=a;return}}F(ee,t=>{console.log("Video stream URL updated:",t)}),F(s,t=>{console.log("Selected video ID changed, setting store to:",t),typeof t=="number"?(r.setCurrentVideo(t),r.fetchVideoSegments(t)):E.value="Invalid video ID"});const X=()=>{E.value=""},H=()=>{R.value=""},z=t=>{R.value=t,setTimeout(()=>{H()},5e3)},x=t=>{E.value=t,setTimeout(()=>{X()},1e4)},$e=async t=>{if(t)try{console.log("Loading video detail for ID:",t);const e=await j.get(q(`media/videos/${t}/`));console.log("Video detail response:",e.data),U.value={video_url:e.data.video_url},P.value={duration:Number(e.data.duration??0),fps:Number(e.data.fps??25)};const a=p.value.find(m=>m.id===t);a&&(Se.setCurrentItem(a),console.log("MediaStore updated with video:",t)),P.value.duration>0&&(v.value=P.value.duration),console.log("Video detail loaded:",U.value),console.log("Video meta loaded:",P.value),console.log("Stream source will be:",S.value)}catch(e){console.error("Error loading video detail:",e),await V(Promise.reject(e))}},Le=async()=>{if(s.value!==null)try{const t=await j.get(q(`video/${s.value}/examinations/`));$.value=t.data,C.value=t.data.map(e=>({id:`exam-${e.id}`,timestamp:e.timestamp,examination_data:e.data}))}catch(t){console.error("Error loading saved examinations:",t);const e=t?.response?.data?.error||t?.response?.data?.detail||t?.message||t.toString();e.includes("darf nicht annotiert werden")||e.includes("anonymisierung")||e.includes("anonymization")?x(`Video ${s.value} darf nicht annotiert werden, solange die Anonymisierung nicht abgeschlossen ist.`):t?.response?.status!==404&&await V(Promise.reject(t)),$.value=[],C.value=[]}},ze=async()=>{c.value&&await new Promise(t=>{const e=c.value;e.readyState>=1?(v.value=e.duration,t()):e.addEventListener("loadedmetadata",()=>{v.value=e.duration,t()},{once:!0})})},re=async()=>{if(s.value!==null)try{await r.fetchAllSegments(s.value),console.log("Video segments loaded for video:",s.value),console.log("Timeline segments count:",N.value.length)}catch(t){console.error("Error loading video segments:",t)}},Ce=()=>{c.value&&(v.value=c.value.duration,c.value.addEventListener("play",()=>{A.value=!0}),c.value.addEventListener("pause",()=>{A.value=!1}),c.value.addEventListener("ended",()=>{A.value=!1}),console.log("ðŸŽ¥ Video loaded - Frontend"),console.log(`- Video source URL: ${S.value}`),console.log(`- Legacy stream URL: ${ee.value}`),console.log(`- Video detail URL: ${U.value?.video_url}`),console.log(`- Video readyState: ${c.value.readyState}`),console.log(`- Video networkState: ${c.value.networkState}`),c.value.videoWidth&&c.value.videoHeight&&console.log(`- Video dimensions: ${c.value.videoWidth}x${c.value.videoHeight}`),v.value<10?console.warn(`âš ï¸ WARNING: Video duration seems very short (${v.value}s)`):z(`Video geladen: ${Math.round(v.value)}s Dauer`))},Ee=()=>{c.value&&(w.value=c.value.currentTime)},Me=t=>{if(!O.value||v.value===0)return;const e=O.value.getBoundingClientRect(),k=(t.clientX-e.left)/e.width*v.value;Z(k)},Ae=(...t)=>{const[e]=t;Z(e)},De=(...t)=>{c.value&&(c.value.paused?c.value.play().catch(e=>{console.error("Error playing video:",e),x("Fehler beim Abspielen des Videos")}):c.value.pause())},Ue=(...t)=>{const[e]=t;se.value=e,console.log("Segment selected:",e)},Pe=(...t)=>{const[e,a,m,k,Dn]=t;if(!Number.isFinite(e)){console.warn("[VideoExamination] Invalid segment ID for resize:",e);return}e<0?r.patchDraftSegment(e,{startTime:a,endTime:m}):r.patchSegmentLocally(e,{startTime:a,endTime:m})},Ne=(...t)=>{const[e,a,m,k]=t;if(!Number.isFinite(e)){console.warn("[VideoExamination] Invalid segment ID for move:",e);return}e<0?r.patchDraftSegment(e,{startTime:a,endTime:m}):r.patchSegmentLocally(e,{startTime:a,endTime:m})},Re=(...t)=>{const[e]=t;y.value&&s.value?(console.log(`Creating segment from time selection: ${b(e.start)} - ${b(e.end)} with label: ${y.value}`),de({label:y.value,start:e.start,end:e.end})):(console.warn("Cannot create segment: no label selected or no video selected"),x("Bitte wÃ¤hlen Sie ein Label aus, bevor Sie ein Segment erstellen."))},de=(...t)=>{const[e]=t;return new Promise(async(a,m)=>{try{s.value&&(await r.createSegment?.(s.value,e.label,e.start,e.end),z(`Segment erstellt: ${K(e.label)}`)),a()}catch(k){await V(Promise.reject(k)),m(k)}})},Fe=(...t)=>{const[e]=t;return new Promise(async(a,m)=>{if(!e.id||typeof e.id!="number"){console.warn("Cannot delete draft or temporary segment:",e.id),a();return}try{r.removeSegment(e.id),await r.deleteSegment(e.id),z(`Segment gelÃ¶scht: ${K(e.label)}`),a()}catch(k){console.error("Segment konnte nicht gelÃ¶scht werden:",k),await V(Promise.reject(k)),m(k)}})},Z=t=>{c.value&&t>=0&&t<=v.value&&(c.value.currentTime=t,w.value=t)},Be=()=>{console.log("Label selected:",y.value)},Ie=()=>{ie.value&&(L.value=!0,Ve.value=w.value,r.startDraft(y.value,w.value),console.log(`Draft gestartet: ${y.value} bei ${b(w.value)}`))},je=async()=>{if(!(!L.value||!s.value))try{r.updateDraftEnd(w.value),await r.commitDraft(),L.value=!1,y.value="",await re(),console.log("Label-Markierung abgeschlossen")}catch(t){console.error("Error finishing label marking:",t)}},qe=()=>{r.cancelDraft(),L.value=!1,y.value="",console.log("Label-Markierung abgebrochen")},Ke=t=>{Z(t.timestamp),D.value=C.value.find(e=>e.id===`exam-${t.id}`)||null},We=async t=>{try{await j.delete(q(`examinations/${t}/`)),$.value=$.value.filter(e=>e.id!==t),C.value=C.value.filter(e=>e.id!==`exam-${t}`),D.value?.id===`exam-${t}`&&(D.value=null),z(`Untersuchung ${t} gelÃ¶scht`),console.log("Examination deleted:",t)}catch(e){console.error("Error deleting examination:",e),await V(Promise.reject(e))}},Ge=async()=>{if(!s.value){x("Kein Video ausgewÃ¤hlt");return}const t=_.value.length;if(t===0){x("Keine Segmente zum Validieren vorhanden");return}if(!confirm(`MÃ¶chten Sie alle ${t} Segmente von Video ${s.value} als validiert markieren? AuÃŸerhalb-Segmente werden danach gelÃ¶scht.`))return;const e=_.value.filter(a=>typeof a.id=="number").map(a=>({id:a.id,start_time:a.startTime,end_time:a.endTime}));console.log("ðŸ”„ Sending segments to backend:",e);try{console.log(`ðŸ” Validating all segments for video ${s.value}...`);const a=await j.post(q(`media/videos/${s.value}/segments/validate-bulk/`),{segmentIds:e.map(m=>m.id),segments:e,isValidated:!0,notes:`VollstÃ¤ndige Video-Review abgeschlossen am ${new Date().toLocaleString("de-DE")}`,informationSourceName:"manual_annotation"});console.log("âœ… Validation response:",a.data),z(`Erfolgreich! ${a.data.updatedCount} von ${a.data.totalSegments??a.data.requestedCount} Segmenten validiert.`),await re()}catch(a){console.error("âŒ Error validating video segments:",a);const m=a?.response?.data?.error||a?.message||"Unbekannter Fehler";x(`Validierung fehlgeschlagen: ${m}`)}},Oe=async()=>{try{await r.persistDirtySegments(),z("Segment-Ã„nderungen gespeichert")}catch(t){console.error("Fehler beim Speichern der Segment-Ã„nderungen:",t),await V(Promise.reject(t))}},Xe=()=>{s.value&&(r.fetchVideoSegments(s.value),z("Lokale Ã„nderungen verworfen"))},He=t=>{console.error("Video loading error:",t);const e=t.target;console.error("Video error details:",{error:e.error,networkState:e.networkState,readyState:e.readyState,currentSrc:e.currentSrc}),x("Fehler beim Laden des Videos. Bitte versuchen Sie es erneut.")},Ze=()=>{console.log("Video loading started for:",S.value)},Je=()=>{console.log("Video can play, loaded successfully"),z("Video erfolgreich geladen")},ue=t=>{const e=T.value.find(m=>m.id===t&&m.mediaType==="video");return e?{not_started:"â³ Wartend",processing_anonymization:"ðŸ”„ In Verarbeitung",extracting_frames:"ðŸŽ¬ Frames",done_processing_anonymization:"âœ… Anonymisiert - Validierung steht aus",validated:"ðŸ›¡ï¸ Validiert & Anonymisiert",failed:"âŒ Fehler"}[e.anonymizationStatus]||e.anonymizationStatus:""},ce=t=>T.value.filter(e=>e.mediaType==="video"&&e.anonymizationStatus===t).length,Qe=t=>({not_started:"bg-secondary",processing_anonymization:"bg-warning",extracting_frames:"bg-info",predicting_segments:"bg-info",done_processing_anonymization:"bg-success",validated:"bg-primary",failed:"bg-danger"})[t]||"bg-secondary",Ye=t=>({not_started:"Nicht gestartet",processing_anonymization:"Anonymisierung lÃ¤uft",extracting_frames:"Frames extrahieren",predicting_segments:"Segmente vorhersagen",done_processing_anonymization:"Fertig",validated:"Validiert",failed:"Fehlgeschlagen"})[t]||t;return(t,e)=>(o(),i("div",ct,[E.value?(o(),i("div",mt,[e[3]||(e[3]=n("i",{class:"material-icons me-2"},"error",-1)),e[4]||(e[4]=n("strong",null,"Fehler:",-1)),f(" "+l(E.value)+" ",1),n("button",{type:"button",class:"btn-close",onClick:X,"aria-label":"Close"})])):d("",!0),R.value?(o(),i("div",vt,[e[5]||(e[5]=n("i",{class:"material-icons me-2"},"check_circle",-1)),e[6]||(e[6]=n("strong",null,"Erfolg:",-1)),f(" "+l(R.value)+" ",1),n("button",{type:"button",class:"btn-close",onClick:H,"aria-label":"Close"})])):d("",!0),e[39]||(e[39]=n("div",{class:"row"},[n("div",{class:"col-12"},[n("h1",null,"Video-Untersuchung Annotation"),n("p",null,"Annotieren Sie Untersuchungen wÃ¤hrend der Videobetrachtung")])],-1)),n("div",gt,[n("div",ft,[n("div",bt,[e[31]||(e[31]=n("div",{class:"card-header pb-0"},[n("h5",{class:"mb-0"},"Video Player")],-1)),n("div",yt,[n("div",ht,[e[11]||(e[11]=n("label",{class:"form-label"},"Video auswÃ¤hlen:",-1)),me(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),onChange:we,class:"form-select",disabled:!M.value},[n("option",St,l(M.value?"Bitte Video auswÃ¤hlen...":"Keine Videos verfÃ¼gbar"),1),(o(!0),i(B,null,I(p.value,a=>(o(),i("option",{key:a.id,value:a.id}," ðŸ“¹ "+l(a.original_file_name||"Video Nr. "+a.id)+" "+l(ue(a.id))+" | Center: "+l(a.centerName||"Unbekannt")+" | Processor: "+l(a.processorName||"Unbekannt"),9,_t))),128))],40,pt),[[ve,s.value,void 0,{number:!0}]]),M.value?d("",!0):(o(),i("small",Vt,l(le.value),1)),G.value.length>0?(o(),i("div",kt,[n("div",wt,[e[10]||(e[10]=n("small",{class:"text-muted"},"Status-Ãœbersicht:",-1)),n("span",xt,[e[7]||(e[7]=n("i",{class:"fas fa-check me-1"},null,-1)),f(" "+l(ce("done_processing_anonymization"))+" Anonymisiert ",1)]),n("span",Tt,[e[8]||(e[8]=n("i",{class:"fas fa-check-double me-1"},null,-1)),f(" "+l(ce("validated"))+" Validiert ",1)]),n("span",$t,[e[9]||(e[9]=n("i",{class:"fas fa-clock me-1"},null,-1)),f(" "+l(G.value.length-p.value.length)+" Ausstehend ",1)])])])):d("",!0)]),!S.value&&M.value?(o(),i("div",Lt,[e[14]||(e[14]=n("i",{class:"material-icons",style:{"font-size":"48px"}},"movie",-1)),e[15]||(e[15]=n("p",{class:"mt-2"},"Video auswÃ¤hlen, um mit der Betrachtung zu beginnen",-1)),s.value?(o(),i("div",zt,[n("div",Ct,[e[13]||(e[13]=n("i",{class:"fas fa-info-circle me-2"},null,-1)),n("div",Et,[n("strong",null,"Video "+l(s.value)+":",1),f(" "+l(ue(s.value)),1),e[12]||(e[12]=n("br",null,null,-1)),n("small",Mt," Stream-URL: "+l(S.value||"Wird geladen..."),1)])])])):d("",!0)])):d("",!0),M.value?d("",!0):(o(),i("div",At,[e[16]||(e[16]=n("i",{class:"material-icons",style:{"font-size":"48px"}},"video_library",-1)),n("p",Dt,l(le.value),1),e[17]||(e[17]=n("small",null,"Videos kÃ¶nnen Ã¼ber den Ordner Raw Videos hochgeladen werden. Sie mÃ¼ssen erst anonymisiert werden, bevor sie hier angezeigt werden.",-1))])),S.value?(o(),i("div",Ut,[n("video",{ref_key:"videoRef",ref:c,"data-cy":"video-player",src:S.value,onTimeupdate:Ee,onLoadedmetadata:Ce,onError:He,onLoadstart:Ze,onCanplay:Je,controls:"",class:"w-100",style:{"max-height":"400px"}}," Ihr Browser unterstÃ¼tzt das Video-Element nicht. ",40,Pt),s.value?(o(),i("div",Nt,[n("div",Rt,[n("div",Ft,[n("h6",Bt,[e[18]||(e[18]=n("i",{class:"fas fa-video me-2 text-primary"},null,-1)),f(" "+l(p.value.find(a=>a.id===s.value)?.original_file_name||`Video ${s.value}`),1)]),n("div",It,[n("span",{class:ge([Qe(u(T).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus||"not_started"),"badge"])},[e[19]||(e[19]=n("i",{class:"fas fa-shield-alt me-1"},null,-1)),f(" "+l(Ye(u(T).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus||"not_started")),1)],2),_.value.length>0?(o(),i("span",jt,[e[20]||(e[20]=n("i",{class:"fas fa-cut me-1"},null,-1)),f(" "+l(_.value.length)+" Segmente ",1)])):d("",!0),$.value.length>0?(o(),i("span",qt,[e[21]||(e[21]=n("i",{class:"fas fa-stethoscope me-1"},null,-1)),f(" "+l($.value.length)+" Untersuchungen ",1)])):d("",!0)])]),n("div",Kt,[n("small",Wt,"Center: "+l(p.value.find(a=>a.id===s.value)?.centerName||"Unbekannt"),1),n("small",Gt,"Processor: "+l(p.value.find(a=>a.id===s.value)?.processorName||"Unbekannt"),1),n("small",Ot,"Dauer: "+l(u(b)(v.value)),1)])])])):d("",!0)])):d("",!0),S.value?d("",!0):(o(),i("div",Xt,[n("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=a=>u(r).deleteVideo(s.value)),disabled:!M.value}," Video lÃ¶schen? ",8,Ht)])),v.value>0?(o(),i("div",Zt,[ye(ut,{video:{duration:v.value},segments:_.value,labels:ne.value,currentTime:w.value,isPlaying:A.value,activeSegmentId:se.value,showWaveform:!1,selectionMode:!0,fps:_e.value,onSeek:Ae,onPlayPause:De,onSegmentSelect:Ue,onSegmentResize:Pe,onSegmentMove:Ne,onSegmentCreate:de,onSegmentDelete:Fe,onTimeSelection:Re},null,8,["video","segments","labels","currentTime","isPlaying","activeSegmentId","fps"]),s.value&&_.value.length>0?(o(),i("div",Jt,[n("button",{class:"btn btn-outline-secondary",onClick:Xe}," Ã„nderungen verwerfen "),n("button",{class:ge(["btn",ke.value?"btn-primary":"btn-outline-secondary"]),onClick:Oe}," SegmentÃ¤nderungen speichern ",2),n("div",{class:"simple-timeline-track mt-2",onClick:Me,ref_key:"timelineRef",ref:O},[n("div",{class:"progress-bar",style:fe({width:`${w.value/v.value*100}%`})},null,4),(o(!0),i(B,null,I(C.value,a=>(o(),i("div",{key:a.id,class:"examination-marker",style:fe({left:`${a.timestamp/v.value*100}%`}),title:`Untersuchung bei ${u(b)(a.timestamp)}`},null,12,Qt))),128))],512)])):d("",!0),v.value>0?(o(),i("div",Yt,[n("small",en," Timeline Debug: "+l(_.value.length)+" video-spezifische Segmente | "+l(u(N).length)+" total Segmente | Duration: "+l(u(b)(v.value))+" | Playing: "+l(A.value)+" | Store: "+l(Object.keys(Te.value).length)+" Labels ",1)])):d("",!0),s.value?(o(),i("div",tn,[n("div",nn,[n("div",an,[e[23]||(e[23]=n("label",{class:"form-label mb-0 me-2"},"Neues Label setzen:",-1)),me(n("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),onChange:Be,class:"form-select form-select-sm control-select","data-cy":"label-select"},[e[22]||(e[22]=n("option",{value:""},"Label auswÃ¤hlen...",-1)),(o(!0),i(B,null,I(ne.value,a=>(o(),i("option",{key:a.id,value:a.name},l(u(K)(a.name)),9,sn))),128))],544),[[ve,y.value]])]),n("div",on,[L.value?d("",!0):(o(),i("button",{key:0,onClick:Ie,class:"btn btn-success btn-sm control-button",disabled:!ie.value,"data-cy":"start-label-button"},[...e[24]||(e[24]=[n("i",{class:"material-icons"},"label",-1),f(" Label-Start setzen ",-1)])],8,ln)),L.value?(o(),i("button",{key:1,onClick:je,class:"btn btn-warning btn-sm control-button","data-cy":"finish-label-button"},[...e[25]||(e[25]=[n("i",{class:"material-icons"},"stop",-1),f(" Label-Ende setzen ",-1)])])):d("",!0),L.value?(o(),i("button",{key:2,onClick:qe,class:"btn btn-outline-secondary btn-sm control-button"}," Abbrechen ")):d("",!0)]),n("span",rn," Zeit: "+l(u(b)(w.value))+" / "+l(u(b)(v.value)),1)]),u(r).draftSegment?(o(),i("div",dn,[n("small",null,[e[26]||(e[26]=n("i",{class:"material-icons align-middle me-1",style:{"font-size":"16px"}},"info",-1)),f(' Label "'+l(u(K)(u(r).draftSegment.label))+'" ',1),u(r).draftSegment.endTime?(o(),i("span",un," von "+l(u(b)(u(r).draftSegment.startTime))+" bis "+l(u(b)(u(r).draftSegment.endTime)),1)):(o(),i("span",cn," startet bei "+l(u(b)(u(r).draftSegment.startTime))+" - Ende beim nÃ¤chsten Klick ",1))])])):d("",!0)])):d("",!0)])):d("",!0)]),s.value&&_.value.length>0?(o(),i("div",mn,[u(T).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus==="validated"?(o(),i("div",vn,[e[28]||(e[28]=n("i",{class:"fas fa-check-circle fa-2x me-3 text-success"},null,-1)),n("div",null,[e[27]||(e[27]=n("h6",{class:"mb-1"},[n("i",{class:"fas fa-medal me-1"}),f(" Video bereits validiert ")],-1)),n("small",gn," Alle "+l(_.value.length)+" Segmente wurden Ã¼berprÃ¼ft und als validiert markiert. ",1)])])):(o(),i("button",{key:1,class:"btn btn-success btn-lg w-100 d-flex align-items-center justify-content-center gap-2",onClick:Ge,style:{"font-size":"1.1rem",padding:"15px"}},[e[29]||(e[29]=n("i",{class:"material-icons"},"check_circle",-1)),n("span",null,"Alle Segmente validieren ("+l(_.value.length)+")",1)])),u(T).find(a=>a.id===s.value&&a.mediaType==="video")?.anonymizationStatus!=="validated"?(o(),i("p",fn,[...e[30]||(e[30]=[n("i",{class:"material-icons",style:{"font-size":"16px","vertical-align":"middle"}},"info",-1),f(' Markiert alle Segmente als Ã¼berprÃ¼ft und setzt Video-Status auf "Validiert" ',-1)])])):d("",!0)])):d("",!0)]),n("div",bn,[n("div",yn,[n("div",hn,[e[34]||(e[34]=n("h5",{class:"mb-0"},[n("i",{class:"fas fa-clipboard-list me-2"}),f(" Anforderungsbasierte Annotation ")],-1)),D.value?(o(),i("small",pn," Zeitpunkt: "+l(u(b)(D.value.timestamp)),1)):d("",!0),s.value?(o(),i("div",Sn,[n("div",_n,[e[32]||(e[32]=n("i",{class:"fas fa-info-circle me-1"},null,-1)),n("strong",null,"Video "+l(s.value)+":",1),e[33]||(e[33]=f(" Erweiterte Untersuchungsannotation mit Anforderungssets und Befunden ",-1))])])):d("",!0)]),n("div",Vn,[xe.value?(o(),st(dt,{key:0,class:"requirement-generator-embedded","data-cy":"requirement-generator"})):(o(),i("div",kn,[...e[35]||(e[35]=[n("i",{class:"fas fa-video fa-3x mb-3 text-muted"},null,-1),n("h6",null,"Video-Untersuchung",-1),n("p",{class:"mb-0"},"WÃ¤hlen Sie ein Video aus, um mit der erweiterten Annotation zu beginnen",-1),n("small",{class:"text-muted"}," Anforderungssets, Befunde und Klassifikationen werden automatisch geladen ",-1)])]))])]),$.value.length>0?(o(),i("div",wn,[e[38]||(e[38]=n("div",{class:"card-header pb-0"},[n("h6",{class:"mb-0"},"Gespeicherte Untersuchungen")],-1)),n("div",xn,[n("div",Tn,[(o(!0),i(B,null,I($.value,a=>(o(),i("div",{key:a.id,class:"list-group-item d-flex justify-content-between align-items-center px-0"},[n("div",null,[n("small",$n,l(u(b)(a.timestamp)),1),n("div",null,l(a.examination_type||"Untersuchung"),1)]),n("div",null,[n("button",{onClick:m=>Ke(a),class:"btn btn-sm btn-outline-primary me-2"},[...e[36]||(e[36]=[n("i",{class:"material-icons"},"play_arrow",-1)])],8,Ln),n("button",{onClick:m=>We(a.id),class:"btn btn-sm btn-outline-danger"},[...e[37]||(e[37]=[n("i",{class:"material-icons"},"delete",-1)])],8,zn)])]))),128))])])])):d("",!0)])])])]))}}),En=lt(Cn,[["__scopeId","data-v-3df015a9"]]),Mn={class:"container-fluid h-100 w-100 py-1 px-4"},qn=be({__name:"VideoExamination",setup(he){return(W,Q)=>(o(),i("div",Mn,[ye(En)]))}});export{qn as default};
