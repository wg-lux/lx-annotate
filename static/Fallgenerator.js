import{d as O,h as m,e as K,w as P,i as Z,c as o,o as r,a as e,k as p,t as i,j as _,C as b,l as f,G as k,v as W,z,A as B,_ as S,b as F,r as L}from"./main.js";const q={class:"report-viewer"},H={class:"report-header mb-4"},J={class:"d-flex justify-content-between align-items-center"},Q={class:"report-actions"},X=["disabled"],Y=["disabled"],ee={key:0,class:"text-center py-5"},te={key:1,class:"alert alert-danger",role:"alert"},se={class:"mb-0"},ae={key:2,class:"report-content"},le={class:"row"},ne={class:"col-lg-8"},ie={class:"card"},oe={class:"card-header"},re={key:0,class:"text-muted"},de={class:"card-body p-0"},ue={key:0,class:"pdf-container"},ce=["src"],ve={class:"p-3"},me=["href"],_e={key:1,class:"text-center py-5"},pe={key:2,class:"text-center py-5"},be={class:"col-lg-4"},fe={class:"card mb-3"},he={class:"card-body"},xe={class:"d-flex justify-content-between align-items-center"},ye={class:"card mb-3"},ge={class:"card-header d-flex justify-content-between align-items-center"},ke={key:0,class:"text-warning"},we={class:"card-body"},De={key:0,class:"edit-form"},Me={class:"mb-3"},Re={key:0,class:"invalid-feedback"},ze={class:"mb-3"},Ue={key:0,class:"invalid-feedback"},Ce={class:"mb-3"},Ve={class:"mb-3"},Be={key:0,class:"invalid-feedback"},Fe={class:"mb-3"},Le={key:0,class:"invalid-feedback"},Se={class:"d-flex gap-2"},Ie=["disabled"],Ge={key:1,class:"metadata-display"},$e={class:"mb-2"},Ee={class:"mb-1"},Te={class:"mb-2"},Ae={class:"mb-1"},Ne={class:"mb-2"},je={class:"mb-1"},Oe={class:"mb-2"},Ke={class:"mb-1"},Pe={class:"card mb-3"},Ze={class:"card-body"},We={key:0,class:"edit-form"},qe={key:0,class:"invalid-feedback"},He={class:"form-text text-muted"},Je={key:1,class:"anonymized-text"},Qe={class:"text-content"},Xe={class:"text-muted"},Ye={key:0,class:"card"},et={class:"card-body"},tt={class:"mb-2"},st={class:"mb-1"},at={class:"mb-2"},lt={class:"mb-1"},nt={class:"mb-2"},it={class:"mb-1"},ot={key:3,class:"text-center py-5"},rt=O({__name:"ReportViewer",props:{reportId:{}},emits:["reportLoaded","metadataUpdated","error"],setup(U,{emit:w}){const h=U,x=w,y=m(!1),c=m(""),s=m(null),u=m(!1),D=m(!1),n=m({}),v=m(""),l=m({}),C=K(()=>s.value?.secure_file_url?.expires_at?new Date>=new Date(s.value.secure_file_url.expires_at):!1);P(()=>h.reportId,a=>{a?g():s.value=null},{immediate:!0});async function g(){if(h.reportId){y.value=!0,c.value="";try{const a=await z.get(`/api/reports/${h.reportId}/with-secure-url/`);s.value=a.data,M(),x("reportLoaded",a.data)}catch(a){c.value=a.response?.data?.error||"Fehler beim Laden des Reports",x("error",c.value)}finally{y.value=!1}}}function I(){u.value=!u.value,u.value&&M(),l.value={}}function M(){s.value&&(n.value={...s.value.report_meta},v.value=s.value.anonymized_text,n.value.patient_dob&&(n.value.patient_dob=n.value.patient_dob.split("T")[0]),n.value.examination_date&&(n.value.examination_date=n.value.examination_date.split("T")[0]))}function G(){return l.value={},n.value.patient_first_name?.trim()||(l.value.patient_first_name="Vorname ist erforderlich"),n.value.patient_last_name?.trim()||(l.value.patient_last_name="Nachname ist erforderlich"),v.value?.trim()||(l.value.anonymized_text="Anonymisierter Text ist erforderlich"),v.value?.length>1e4&&(l.value.anonymized_text="Text ist zu lang (max. 10.000 Zeichen)"),Object.keys(l.value).length===0}async function $(){if(G()){D.value=!0;try{const a=await z.patch(B(`media/pdfs/${s.value.id}/sensitive-metadata/`),{...n.value}),t=await z.patch(B(`media/pdfs/${s.value.id}/sensitive-metadata/`),{anonymized_text:v.value});s.value.report_meta={...s.value.report_meta,...n.value},s.value.anonymized_text=v.value,u.value=!1,x("metadataUpdated",s.value),console.log("Metadaten erfolgreich gespeichert")}catch(a){c.value=a.response?.data?.error||"Fehler beim Speichern der Metadaten",x("error",c.value)}finally{D.value=!1}}}function E(){u.value=!1,M(),l.value={}}function R(a){if(!a)return"N/A";try{return new Date(a).toLocaleDateString("de-DE")}catch{return a}}function T(a){if(a===0)return"0 Bytes";const t=1024,d=["Bytes","KB","MB","GB"],V=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,V)).toFixed(2))+" "+d[V]}function A(a){switch(a){case"approved":return"success";case"rejected":return"danger";case"pending":return"warning";default:return"secondary"}}function N(a){switch(a){case"approved":return"Genehmigt";case"rejected":return"Abgelehnt";case"pending":return"Ausstehend";default:return"Unbekannt"}}function j(a){switch(a){case 1:return"Männlich";case 2:return"Weiblich";case 3:return"Divers";default:return"Unbekannt"}}return Z(()=>{h.reportId&&g()}),(a,t)=>(r(),o("div",q,[e("div",H,[e("div",J,[t[8]||(t[8]=e("h4",null,"Report Viewer",-1)),e("div",Q,[e("button",{class:"btn btn-primary btn-sm me-2",onClick:g,disabled:y.value},[...t[6]||(t[6]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),p(" Neu laden ",-1)])],8,X),e("button",{class:"btn btn-outline-secondary btn-sm",onClick:I,disabled:!s.value},[t[7]||(t[7]=e("i",{class:"bi bi-pencil"},null,-1)),p(" "+i(u.value?"Bearbeitung beenden":"Metadaten bearbeiten"),1)],8,Y)])])]),y.value?(r(),o("div",ee,[...t[9]||(t[9]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Lade...")],-1),e("p",{class:"mt-2"},"Lade Report-Daten...",-1)])])):c.value?(r(),o("div",te,[t[10]||(t[10]=e("h6",{class:"alert-heading"},"Fehler beim Laden",-1)),e("p",se,i(c.value),1),e("button",{class:"btn btn-outline-danger btn-sm mt-2",onClick:g}," Erneut versuchen ")])):s.value?(r(),o("div",ae,[e("div",le,[e("div",ne,[e("div",ie,[e("div",oe,[t[11]||(t[11]=e("h6",{class:"mb-0"},"Report Dokument",-1)),s.value.secure_file_url?(r(),o("small",re," URL gültig bis: "+i(R(s.value.secure_file_url.expires_at)),1)):_("",!0)]),e("div",de,[s.value.secure_file_url&&!C.value?(r(),o("div",ue,[e("iframe",{src:s.value.secure_file_url.url+"#toolbar=1&navpanes=0&scrollbar=1",width:"100%",height:"600px",frameborder:"0",class:"pdf-frame"},[e("p",ve,[t[12]||(t[12]=p(" Ihr Browser unterstützt keine eingebetteten PDFs. ",-1)),e("a",{href:s.value.secure_file_url.url,target:"_blank",rel:"noopener noreferrer"}," Datei in neuem Tab öffnen ",8,me)])],8,ce)])):C.value?(r(),o("div",_e,[t[13]||(t[13]=e("i",{class:"bi bi-clock-history display-1 text-warning"},null,-1)),t[14]||(t[14]=e("h6",{class:"mt-3"},"URL abgelaufen",-1)),t[15]||(t[15]=e("p",{class:"text-muted"},"Die sichere URL ist abgelaufen. Bitte laden Sie den Report neu.",-1)),e("button",{class:"btn btn-primary",onClick:g}," Report neu laden ")])):(r(),o("div",pe,[...t[16]||(t[16]=[e("i",{class:"bi bi-file-earmark-x display-1 text-muted"},null,-1),e("h6",{class:"mt-3"},"Keine Datei verfügbar",-1),e("p",{class:"text-muted"},"Für diesen Report ist keine Datei hinterlegt.",-1)])]))])])]),e("div",be,[e("div",fe,[t[18]||(t[18]=e("div",{class:"card-header"},[e("h6",{class:"mb-0"},"Status")],-1)),e("div",he,[e("div",xe,[t[17]||(t[17]=e("span",null,"Aktueller Status:",-1)),e("span",{class:b(`badge bg-${A(s.value.status)}`)},i(N(s.value.status)),3)])])]),e("div",ye,[e("div",ge,[t[20]||(t[20]=e("h6",{class:"mb-0"},"Patientendaten",-1)),u.value?(r(),o("small",ke,[...t[19]||(t[19]=[e("i",{class:"bi bi-pencil"},null,-1),p(" Bearbeitungsmodus ",-1)])])):_("",!0)]),e("div",we,[u.value?(r(),o("div",De,[e("div",Me,[t[21]||(t[21]=e("label",{class:"form-label"},"Vorname:",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>n.value.patient_first_name=d),type:"text",class:b(["form-control",{"is-invalid":l.value.patient_first_name}])},null,2),[[k,n.value.patient_first_name]]),l.value.patient_first_name?(r(),o("div",Re,i(l.value.patient_first_name),1)):_("",!0)]),e("div",ze,[t[22]||(t[22]=e("label",{class:"form-label"},"Nachname:",-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>n.value.patient_last_name=d),type:"text",class:b(["form-control",{"is-invalid":l.value.patient_last_name}])},null,2),[[k,n.value.patient_last_name]]),l.value.patient_last_name?(r(),o("div",Ue,i(l.value.patient_last_name),1)):_("",!0)]),e("div",Ce,[t[24]||(t[24]=e("label",{class:"form-label"},"Geschlecht:",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=d=>n.value.patient_gender=d),class:"form-select"},[...t[23]||(t[23]=[e("option",{value:1},"Männlich",-1),e("option",{value:2},"Weiblich",-1),e("option",{value:3},"Divers",-1)])],512),[[W,n.value.patient_gender,void 0,{number:!0}]])]),e("div",Ve,[t[25]||(t[25]=e("label",{class:"form-label"},"Geburtsdatum:",-1)),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=d=>n.value.patient_dob=d),type:"date",class:b(["form-control",{"is-invalid":l.value.patient_dob}])},null,2),[[k,n.value.patient_dob]]),l.value.patient_dob?(r(),o("div",Be,i(l.value.patient_dob),1)):_("",!0)]),e("div",Fe,[t[26]||(t[26]=e("label",{class:"form-label"},"Untersuchungsdatum:",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>n.value.examination_date=d),type:"date",class:b(["form-control",{"is-invalid":l.value.examination_date}])},null,2),[[k,n.value.examination_date]]),l.value.examination_date?(r(),o("div",Le,i(l.value.examination_date),1)):_("",!0)]),e("div",Se,[e("button",{class:"btn btn-success btn-sm",onClick:$,disabled:D.value},[t[27]||(t[27]=e("i",{class:"bi bi-check-lg"},null,-1)),p(" "+i(D.value?"Speichern...":"Speichern"),1)],8,Ie),e("button",{class:"btn btn-secondary btn-sm",onClick:E},[...t[28]||(t[28]=[e("i",{class:"bi bi-x-lg"},null,-1),p(" Abbrechen ",-1)])])])])):(r(),o("div",Ge,[e("div",$e,[t[29]||(t[29]=e("small",{class:"text-muted"},"Patient:",-1)),e("p",Ee,i(s.value.report_meta.patient_first_name)+" "+i(s.value.report_meta.patient_last_name),1)]),e("div",Te,[t[30]||(t[30]=e("small",{class:"text-muted"},"Geschlecht:",-1)),e("p",Ae,i(j(s.value.report_meta.patient_gender)),1)]),e("div",Ne,[t[31]||(t[31]=e("small",{class:"text-muted"},"Geburtsdatum:",-1)),e("p",je,i(R(s.value.report_meta.patient_dob)),1)]),e("div",Oe,[t[32]||(t[32]=e("small",{class:"text-muted"},"Untersuchungsdatum:",-1)),e("p",Ke,i(R(s.value.report_meta.examination_date)),1)])]))])]),e("div",Pe,[t[33]||(t[33]=e("div",{class:"card-header"},[e("h6",{class:"mb-0"},"Anonymisierter Text")],-1)),e("div",Ze,[u.value?(r(),o("div",We,[f(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=d=>v.value=d),class:b(["form-control",{"is-invalid":l.value.anonymized_text}]),rows:"10"},null,2),[[k,v.value]]),l.value.anonymized_text?(r(),o("div",qe,i(l.value.anonymized_text),1)):_("",!0),e("small",He,i(v.value.length)+" Zeichen ",1)])):(r(),o("div",Je,[e("div",Qe,i(s.value.anonymized_text),1),e("small",Xe,i(s.value.anonymized_text.length)+" Zeichen ",1)]))])]),s.value.secure_file_url?(r(),o("div",Ye,[t[37]||(t[37]=e("div",{class:"card-header"},[e("h6",{class:"mb-0"},"Datei-Informationen")],-1)),e("div",et,[e("div",tt,[t[34]||(t[34]=e("small",{class:"text-muted"},"Dateiname:",-1)),e("p",st,i(s.value.secure_file_url.original_filename),1)]),e("div",at,[t[35]||(t[35]=e("small",{class:"text-muted"},"Dateigröße:",-1)),e("p",lt,i(T(s.value.secure_file_url.file_size)),1)]),e("div",nt,[t[36]||(t[36]=e("small",{class:"text-muted"},"Dateityp:",-1)),e("p",it,i(s.value.file_type.toUpperCase()),1)])])])):_("",!0)])])])):(r(),o("div",ot,[...t[38]||(t[38]=[e("i",{class:"bi bi-file-earmark-text display-1 text-muted"},null,-1),e("h6",{class:"mt-3"},"Kein Report ausgewählt",-1),e("p",{class:"text-muted"},"Bitte geben Sie eine Report-ID an.",-1)])]))]))}}),dt=S(rt,[["__scopeId","data-v-a0ecbe77"]]),ut={name:"Fallgenerator",components:{ReportOverview:dt}},ct={class:"container-fluid py-4"};function vt(U,w,h,x,y,c){const s=L("ReportOverview"),u=L("CaseGenerator");return r(),o("div",ct,[w[0]||(w[0]=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h1",null,"Fallgenerator"),e("p",null,"Erstellen Sie hier Ihren eigenen Fall.")])],-1)),F(s),F(u)])}const _t=S(ut,[["render",vt]]);export{_t as default};
