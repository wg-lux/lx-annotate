import{_,o,c as d,a as s,l as v,i as p,t as h,F as g,h as u,w as f,m as N,n as y}from"./main.js";const b="http://127.0.0.1:8000/api",F={name:"UnifiedAnnotationComponent",data(){return{selectedGender:"",randomFirstNames:[],randomLastNames:[],randomFullNames:[],droppedNames:[],errorMessage:"",uploadedFile:null,processedImageUrl:null,originalImageUrl:null,showOriginal:!1,femaleFirstNames:[],femaleLastNames:[],maleFirstNames:[],maleLastNames:[]}},computed:{canSubmit(){return this.processedImageUrl&&this.droppedNames.length>0},displayedImageUrl(){return this.showOriginal?this.originalImageUrl:this.processedImageUrl}},methods:{async loadNames(){const r=async e=>{try{return(await(await fetch(e)).text()).replace(/\r\n/g,`
`).split(`
`).map(a=>a.trim()).filter(a=>a.length>0)}catch(l){throw console.error(`Error loading names from ${e}:`,l),l}};try{if(this.femaleFirstNames=await r("./assets/names-dictionary/first_names_female_ascii.txt"),this.femaleLastNames=await r("./assets/names-dictionary/last_names_female_ascii.txt"),this.maleFirstNames=await r("./assets/names-dictionary/first_names_male_ascii.txt"),this.maleLastNames=await r("./assets/names-dictionary/last_names_male_ascii.txt"),!this.femaleFirstNames.length||!this.femaleLastNames.length||!this.maleFirstNames.length||!this.maleLastNames.length)throw new Error("One or more name lists are empty");this.errorMessage=""}catch(e){this.errorMessage=`Failed to load names: ${e.message}`}},getRandomName(r){return r[Math.floor(Math.random()*r.length)]},handleAddRandomFirstName(){if(!this.selectedGender){this.errorMessage="Bitte wählen Sie ein Geschlecht aus.";return}const r=this.selectedGender==="male"?this.maleFirstNames:this.femaleFirstNames,e=this.getRandomName(r);this.randomFirstNames.push(e)},handleAddRandomLastName(){if(!this.selectedGender){this.errorMessage="Bitte wählen Sie ein Geschlecht aus.";return}const r=this.selectedGender==="male"?this.maleLastNames:this.femaleLastNames,e=this.getRandomName(r);this.randomLastNames.push(e)},handleAddRandomFullName(){if(!this.selectedGender){this.errorMessage="Bitte wählen Sie ein Geschlecht aus.";return}const r=this.selectedGender==="male"?this.maleFirstNames:this.femaleFirstNames,e=this.selectedGender==="male"?this.maleLastNames:this.femaleLastNames,l=this.getRandomName(r),i=this.getRandomName(e);this.randomFullNames.push(`${l} ${i}`)},removeName(r,e){switch(r){case"firstName":this.randomFirstNames.splice(e,1);break;case"lastName":this.randomLastNames.splice(e,1);break;case"fullName":this.randomFullNames.splice(e,1);break}},handleDragStart(r,e){e.dataTransfer.setData("text/plain",JSON.stringify(r))},handleDrop(r){const e=this.$refs.imageCard.getBoundingClientRect(),l=r.clientX-e.left,i=r.clientY-e.top,a=JSON.parse(r.dataTransfer.getData("text/plain"));this.droppedNames.push({...a,x:l,y:i,displayText:a.name})},toggleImage(){this.showOriginal=!this.showOriginal},async handleFileUpload(r){const e=r.target.files[0];if(!e)return;const l=new FormData;l.append("file",e),l.append("validation","true");try{const i=await fetch(`${b}/process-file/`,{method:"POST",body:l});if(!i.ok)throw new Error("Upload failed");const a=await i.json();this.processedImageUrl=a.processed_file_url,this.originalImageUrl=a.original_image_url,this.uploadedFile=e,a.gender_pars&&(this.selectedGender=a.gender_pars.toLowerCase()),this.errorMessage=""}catch(i){this.errorMessage=`Upload failed: ${i.message}`}},async saveAnnotation(){var e;if(!this.canSubmit)return;const r={image_name:(e=this.uploadedFile)==null?void 0:e.name,original_image_url:this.originalImageUrl,processed_image_url:this.processedImageUrl,dropped_names:this.droppedNames.map(({name:l,type:i,x:a,y:n})=>({name:l,type:i,x:a,y:n}))};try{const l=await fetch(`${b}/annotations/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCookie("csrftoken")},body:JSON.stringify(r)});if(!l.ok)throw new Error("Failed to save annotation");this.$emit("annotation-saved",await l.json()),this.resetForm()}catch(l){this.errorMessage=`Failed to save: ${l.message}`}},getCookie(r){const l=`; ${document.cookie}`.split(`; ${r}=`);if(l.length===2)return l.pop().split(";").shift()},resetForm(){this.randomFirstNames=[],this.randomLastNames=[],this.randomFullNames=[],this.droppedNames=[],this.uploadedFile=null,this.processedImageUrl=null,this.originalImageUrl=null,this.showOriginal=!1,this.errorMessage=""}},async created(){await this.loadNames()}},w={class:"container-fluid py-4"},k={class:"card"},D={class:"card-body"},L={class:"row mb-4"},U={class:"col-12"},C={class:"form-group"},I={class:"row mb-4"},S={class:"col-12"},A=["src"],G={key:1,class:"position-absolute top-0 end-0 m-2"},x=["onDragstart"],R={class:"row mb-4"},M={class:"col-12"},O={class:"card bg-light"},B={class:"card-body"},T={class:"mb-3"},V={class:"form-check form-check-inline"},E={class:"form-check form-check-inline"},j={class:"mb-3"},J=["disabled"],P=["disabled"],X=["disabled"],z={class:"name-lists mt-4"},W={class:"name-list mb-3"},Y=["onDragstart"],q=["onClick"],H={class:"name-list mb-3"},K=["onDragstart"],Q=["onClick"],Z={class:"name-list"},$=["onDragstart"],ee=["onClick"],se={class:"row"},te={class:"col-12"},ae=["disabled"],re={key:0,class:"alert alert-danger mt-3",role:"alert"};function ne(r,e,l,i,a,n){return o(),d("div",w,[s("div",k,[e[18]||(e[18]=s("div",{class:"card-header pb-0"},[s("h4",{class:"mb-0"},"Annotationen für Frames der Endoskopie")],-1)),s("div",D,[s("div",L,[s("div",U,[s("div",C,[e[10]||(e[10]=s("label",{class:"form-control-label"},"Bild hochladen",-1)),s("input",{type:"file",class:"form-control",onChange:e[0]||(e[0]=(...t)=>n.handleFileUpload&&n.handleFileUpload(...t)),accept:"image/*"},null,32)])])]),s("div",I,[s("div",S,[s("div",{class:"card mb-4 position-relative",onDrop:e[2]||(e[2]=(...t)=>n.handleDrop&&n.handleDrop(...t)),onDragover:e[3]||(e[3]=v(()=>{},["prevent"])),ref:"imageCard"},[n.displayedImageUrl?(o(),d("img",{key:0,src:n.displayedImageUrl,class:"img-fluid",alt:"Displayed Image"},null,8,A)):p("",!0),a.originalImageUrl?(o(),d("div",G,[s("button",{class:"btn btn-info btn-sm",onClick:e[1]||(e[1]=(...t)=>n.toggleImage&&n.toggleImage(...t))},h(a.showOriginal?"Show Processed":"Show Original"),1)])):p("",!0),(o(!0),d(g,null,u(a.droppedNames,(t,m)=>(o(),d("div",{key:m,style:y({top:t.y+"px",left:t.x+"px",position:"absolute",cursor:"move"}),class:"dropped-name",draggable:"true",onDragstart:c=>n.handleDragStart(t,c)},h(t.displayText),45,x))),128))],544)])]),s("div",R,[s("div",M,[s("div",O,[s("div",B,[e[17]||(e[17]=s("h5",{class:"card-title"},"Namensgenerator",-1)),s("div",T,[e[13]||(e[13]=s("label",{class:"form-label"},"Geschlecht:",-1)),s("div",V,[f(s("input",{class:"form-check-input",type:"radio",id:"male",value:"male","onUpdate:modelValue":e[4]||(e[4]=t=>a.selectedGender=t)},null,512),[[N,a.selectedGender]]),e[11]||(e[11]=s("label",{class:"form-check-label",for:"male"},"Männlich",-1))]),s("div",E,[f(s("input",{class:"form-check-input",type:"radio",id:"female",value:"female","onUpdate:modelValue":e[5]||(e[5]=t=>a.selectedGender=t)},null,512),[[N,a.selectedGender]]),e[12]||(e[12]=s("label",{class:"form-check-label",for:"female"},"Weiblich",-1))])]),s("div",j,[s("button",{onClick:e[6]||(e[6]=(...t)=>n.handleAddRandomFirstName&&n.handleAddRandomFirstName(...t)),class:"btn btn-info me-2",disabled:!a.selectedGender}," Vorname generieren ",8,J),s("button",{onClick:e[7]||(e[7]=(...t)=>n.handleAddRandomLastName&&n.handleAddRandomLastName(...t)),class:"btn btn-info me-2",disabled:!a.selectedGender}," Nachname generieren ",8,P),s("button",{onClick:e[8]||(e[8]=(...t)=>n.handleAddRandomFullName&&n.handleAddRandomFullName(...t)),class:"btn btn-info",disabled:!a.selectedGender}," Vollständigen Namen generieren ",8,X)]),s("div",z,[s("div",W,[e[14]||(e[14]=s("h6",null,"Vornamen",-1)),(o(!0),d(g,null,u(a.randomFirstNames,(t,m)=>(o(),d("div",{key:"first-"+m,class:"name-item card p-3 d-flex flex-row align-items-center mb-2",draggable:"true",onDragstart:c=>n.handleDragStart({type:"firstName",name:t},c)},[s("div",null,h(t),1),s("button",{class:"btn btn-danger btn-sm ms-auto",onClick:c=>n.removeName("firstName",m)}," Löschen ",8,q)],40,Y))),128))]),s("div",H,[e[15]||(e[15]=s("h6",null,"Nachnamen",-1)),(o(!0),d(g,null,u(a.randomLastNames,(t,m)=>(o(),d("div",{key:"last-"+m,class:"name-item card p-3 d-flex flex-row align-items-center mb-2",draggable:"true",onDragstart:c=>n.handleDragStart({type:"lastName",name:t},c)},[s("div",null,h(t),1),s("button",{class:"btn btn-danger btn-sm ms-auto",onClick:c=>n.removeName("lastName",m)}," Löschen ",8,Q)],40,K))),128))]),s("div",Z,[e[16]||(e[16]=s("h6",null,"Vollständige Namen",-1)),(o(!0),d(g,null,u(a.randomFullNames,(t,m)=>(o(),d("div",{key:"full-"+m,class:"name-item card p-3 d-flex flex-row align-items-center mb-2",draggable:"true",onDragstart:c=>n.handleDragStart({type:"fullName",name:t},c)},[s("div",null,h(t),1),s("button",{class:"btn btn-danger btn-sm ms-auto",onClick:c=>n.removeName("fullName",m)}," Löschen ",8,ee)],40,$))),128))])])])])])]),s("div",se,[s("div",te,[s("button",{onClick:e[9]||(e[9]=(...t)=>n.saveAnnotation&&n.saveAnnotation(...t)),class:"btn btn-primary",disabled:!n.canSubmit}," Annotation speichern ",8,ae)])]),a.errorMessage?(o(),d("div",re,h(a.errorMessage),1)):p("",!0)])])])}const ie=_(F,[["render",ne],["__scopeId","data-v-0bda7d78"]]);export{ie as A};
